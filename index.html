<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Murphy's Curves | FLNG Engineering Suite</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Orbitron:wght@500;700&family=Rajdhani:wght@500;600;700&display=swap"
        rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script
        src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- Outseta Integration Script -->
    <script>
        var o_options = {
            domain: 'murphycurves.outseta.com',
            load: 'auth,customForm,emailList,leadCapture,nocode,profile,support'
        };
    </script>
    <script src="https://cdn.outseta.com/outseta.min.js" data-options="o_options">
    </script>

    <style>
        :root {
            --primary: #0c2d48;
            --secondary: #145da0;
            --accent: #2e8bc0;
            --highlight: #b1d4e0;
            --light: #f5f9fc;
            --dark: #051923;
            --gold: #FFD700;
            --platinum: #e5e4e2;
            --steel: #b0c4de;
            --bg: #0b0f19;
            --panel: #12182a;
            --muted: #9fb0c3;
            --text: #e9eef5;
            --accent2: #a3ffb0;
            --warn: #ffd166;
            --danger: #ff6b6b;
            --divider: #1e2a44;
            --chip: #1a2238;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, var(--dark), var(--primary));
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(46, 139, 192, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(177, 212, 224, 0.1) 0%, transparent 20%);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: rgba(5, 25, 35, 0.92);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--accent);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
        }

        .logo {
            display: flex;
            align-items: center;
        }

        .logo-icon {
            font-size: 2.8rem;
            color: var(--gold);
            margin-right: 12px;
        }

        .logo-text {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            font-size: 1.7rem;
            color: var(--platinum);
            text-transform: uppercase;
            letter-spacing: 1.5px;
            line-height: 1.2;
        }

        .logo-text span {
            display: block;
            font-size: 1.1rem;
            color: var(--steel);
            letter-spacing: 3px;
            margin-top: 3px;
        }

        .nav-links {
            display: flex;
            list-style: none;
        }

        .nav-links li {
            margin-left: 35px;
        }

        .nav-links a {
            color: var(--light);
            text-decoration: none;
            font-weight: 500;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            position: relative;
            padding-bottom: 5px;
            font-family: 'Rajdhani', sans-serif;
        }

        .nav-links a:hover {
            color: var(--highlight);
        }

        .nav-links a::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 0;
            left: 0;
            background: var(--gold);
            transition: width 0.3s ease;
        }

        .nav-links a:hover::after {
            width: 100%;
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 12px 30px;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 0.95rem;
            font-family: 'Rajdhani', sans-serif;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--gold);
            color: var(--gold);
        }

        .btn-outline:hover {
            background: rgba(255, 215, 0, 0.1);
            color: var(--light);
            transform: translateY(-2px);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gold), #daa520);
            color: var(--dark);
            font-weight: 700;
            letter-spacing: 2px;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #daa520, var(--gold));
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            font-weight: 700;
            letter-spacing: 2px;
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
            border: 2px solid #dc3545;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #c82333, #dc3545);
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 20px rgba(220, 53, 69, 0.4);
            color: white;
        }

        /* Header Disclaimer Banner */
        .header-disclaimer-banner {
            background: linear-gradient(135deg, #dc3545, #c82333);
            border-bottom: 2px solid #dc3545;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
            position: fixed;
            width: 100%;
            top: 80px;
            z-index: 1001;
            /* Higher than header to be clickable */
            animation: slideDown 0.5s ease-out;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .disclaimer-content {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 15px 0;
            flex-wrap: wrap;
        }

        .disclaimer-icon {
            font-size: 1.5rem;
            color: #fff;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        .disclaimer-text {
            flex: 1;
            color: #fff;
            font-weight: 600;
            font-size: 0.95rem;
            line-height: 1.4;
        }

        .disclaimer-link {
            background: none;
            border: none;
            color: #fff;
            text-decoration: underline;
            cursor: pointer;
            font-weight: 700;
            font-size: inherit;
            padding: 0;
            margin: 0 5px;
        }

        .disclaimer-link:hover {
            color: var(--gold);
        }

        .disclaimer-actions {
            display: flex;
            align-items: center;
        }

        .disclaimer-checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fff;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
        }

        .disclaimer-checkbox {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkmark {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid #fff;
            border-radius: 3px;
            position: relative;
            cursor: pointer;
        }

        .disclaimer-checkbox:checked+.checkmark {
            background: var(--gold);
            border-color: var(--gold);
        }

        .disclaimer-checkbox:checked+.checkmark::after {
            content: '';
            position: absolute;
            left: 5px;
            top: 2px;
            width: 6px;
            height: 10px;
            border: solid var(--dark);
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        /* Adjust hero section to account for disclaimer banner */
        .hero {
            padding-top: 140px;
            /* Increased to account for header + disclaimer banner */
        }

        .hero {
            height: 100vh;
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
            padding-top: 90px;
        }

        .hero-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://images.unsplash.com/photo-1560448204-603b3fc33ddc?auto=format&fit=crop&w=2070&q=80') no-repeat center/cover;
            opacity: 0.15;
            z-index: -1;
        }

        .hero-content {
            max-width: 800px;
            position: relative;
            z-index: 2;
        }

        .hero h1 {
            font-family: 'Rajdhani', sans-serif;
            font-size: 4.2rem;
            font-weight: 700;
            margin-bottom: 25px;
            line-height: 1.15;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .hero h1 span {
            color: var(--gold);
            display: block;
            font-size: 3.5rem;
        }

        .hero p {
            font-size: 1.3rem;
            margin-bottom: 40px;
            line-height: 1.7;
            max-width: 700px;
            color: var(--highlight);
        }

        .hero-stats {
            display: flex;
            gap: 50px;
            margin-top: 50px;
        }

        .stat-item {
            text-align: center;
            position: relative;
        }

        .stat-item:not(:last-child)::after {
            content: '';
            position: absolute;
            right: -25px;
            top: 50%;
            transform: translateY(-50%);
            width: 1px;
            height: 50px;
            background: rgba(177, 212, 224, 0.3);
        }

        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.8rem;
            font-weight: 700;
            color: var(--gold);
            margin-bottom: 5px;
        }

        .stat-label {
            text-transform: uppercase;
            font-size: 0.95rem;
            letter-spacing: 1.5px;
            opacity: 0.9;
            font-family: 'Rajdhani', sans-serif;
        }

        .section-title {
            text-align: center;
            margin-bottom: 80px;
            position: relative;
        }

        .section-title h2 {
            font-family: 'Rajdhani', sans-serif;
            font-size: 2.8rem;
            text-transform: uppercase;
            margin-bottom: 20px;
            color: var(--gold);
            letter-spacing: 2px;
        }

        .section-title p {
            max-width: 800px;
            margin: 0 auto;
            font-size: 1.2rem;
            opacity: 0.9;
            color: var(--highlight);
            line-height: 1.7;
        }

        .section-title::after {
            content: '';
            position: absolute;
            width: 120px;
            height: 4px;
            background: var(--gold);
            bottom: -30px;
            left: 50%;
            transform: translateX(-50%);
        }

        .features {
            padding: 120px 0;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 40px;
            margin-top: 50px;
        }

        .feature-card {
            background: rgba(12, 45, 72, 0.6);
            border: 1px solid rgba(46, 139, 192, 0.3);
            border-radius: 8px;
            padding: 35px 30px;
            transition: all 0.4s ease;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 0;
            background: var(--gold);
            transition: all 0.4s ease;
        }

        .feature-card:hover::before {
            height: 100%;
        }

        .feature-card:hover {
            transform: translateY(-15px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
            border-color: var(--gold);
        }

        .feature-icon {
            font-size: 2.8rem;
            color: var(--gold);
            margin-bottom: 25px;
        }

        .feature-card h3 {
            font-size: 1.6rem;
            margin-bottom: 20px;
            color: var(--platinum);
            font-family: 'Rajdhani', sans-serif;
            letter-spacing: 1px;
        }

        .feature-card p {
            line-height: 1.7;
            opacity: 0.9;
            font-size: 1.05rem;
        }

        .calculations {
            padding: 120px 0 100px;
            background: rgba(5, 25, 35, 0.6);
            position: relative;
            overflow: hidden;
        }

        .calculations::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://images.unsplash.com/photo-1581091226033-d5c48150dbaa?auto=format&fit=crop&w=2070&q=80') no-repeat center/cover;
            opacity: 0.1;
            z-index: -1;
        }

        /* Pump Sizing Styles */
        .pump-container {
            max-width: 1400px;
            margin: 0 auto;
            background-color: rgba(22, 27, 34, 0.8);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            border: 1px solid rgba(48, 54, 61, 0.5);
        }

        .pump-tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(48, 54, 61, 0.5);
        }

        .pump-tab {
            padding: 12px 25px;
            background-color: rgba(33, 38, 45, 0.8);
            border: 1px solid rgba(48, 54, 61, 0.5);
            border-bottom: none;
            cursor: pointer;
            color: var(--highlight);
            font-weight: bold;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            transition: background-color 0.3s, color 0.3s;
        }

        .pump-tab.active {
            background-color: var(--gold);
            color: var(--dark);
            border-color: var(--gold);
        }

        .pump-tab-content {
            display: none;
        }

        .pump-tab-content.active {
            display: block;
        }

        .pump-input-section,
        .pump-output-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid rgba(48, 54, 61, 0.5);
            border-radius: 8px;
            background-color: rgba(13, 17, 23, 0.6);
        }

        .pump-input-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .pump-output-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }

        .pump-warning-section {
            margin-top: 20px;
            padding: 20px;
            background-color: rgba(33, 28, 29, 0.8);
            border: 1px solid rgba(74, 44, 45, 0.5);
            border-radius: 8px;
        }

        .pump-warning-section .warning-title {
            font-weight: bold;
            color: #ffb8b8;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .pump-warning-section .warning-item {
            margin-bottom: 10px;
            padding: 12px;
            background-color: rgba(22, 27, 34, 0.8);
            border-left: 4px solid #ffb8b8;
            border-radius: 6px;
            color: #ffb8b8;
        }

        .pump-warning-section .warning-item.critical {
            border-left-color: #e5534b;
            background-color: rgba(31, 18, 20, 0.8);
        }

        .pump-warning-section .warning-item.no-warnings {
            color: var(--gold);
            border-left-color: var(--gold);
        }

        .pump-new-performance-section {
            margin-top: 20px;
            padding: 20px;
            background-color: rgba(22, 27, 34, 0.8);
            border: 1px solid rgba(48, 54, 61, 0.5);
            border-radius: 8px;
        }

        .pump-new-performance-section .new-performance-title {
            font-weight: bold;
            color: #FFA500;
            margin-bottom: 15px;
            font-size: 1.4em;
        }

        .pump-chart-container {
            height: 500px;
            margin-top: 30px;
            background-color: rgba(13, 17, 23, 0.8);
            border-radius: 8px;
            padding: 15px;
        }

        .pump-data-table-container {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            border: 1px solid rgba(48, 54, 61, 0.5);
            border-radius: 8px;
        }

        .formula-explanation {
            background-color: rgba(22, 27, 34, 0.8);
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid var(--gold);
        }

        .formula-explanation .formula-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--platinum);
            font-size: 1.2em;
        }

        .formula-explanation p {
            margin: 5px 0;
            color: var(--highlight);
        }

        #pump-calculate-btn {
            margin-top: 20px;
            padding: 12px 25px;
            background: linear-gradient(135deg, var(--gold), #b8860b);
            color: var(--dark);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }

        #pump-calculate-btn:hover {
            background: linear-gradient(135deg, #b8860b, var(--gold));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
        }

        #pump-calculate-btn:disabled {
            background: rgba(139, 148, 158, 0.3);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .calc-tabs {
            padding: 16px 35px;
            background: rgba(12, 45, 72, 0.8);
            border: 1px solid rgba(46, 139, 192, 0.3);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-family: 'Rajdhani', sans-serif;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-size: 1.05rem;
        }

        .calc-tab.active,
        .calc-tab:hover {
            background: var(--gold);
            border-color: var(--gold);
            color: var(--dark);
        }

        .calc-content {
            background: rgba(12, 45, 72, 0.8);
            border: 1px solid rgba(46, 139, 192, 0.3);
            border-radius: 8px;
            padding: 45px;
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
        }

        .calc-form {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 30px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.95rem;
            letter-spacing: 1.5px;
            color: var(--gold);
            font-family: 'Rajdhani', sans-serif;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 16px 20px;
            background: rgba(5, 25, 35, 0.7);
            border: 1px solid rgba(46, 139, 192, 0.3);
            border-radius: 4px;
            color: var(--light);
            font-size: 1.05rem;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
        }

        .calc-result {
            background: rgba(5, 25, 35, 0.8);
            padding: 30px;
            border-radius: 8px;
            margin-top: 40px;
            border-left: 4px solid var(--gold);
        }

        .calc-result h3 {
            margin-bottom: 20px;
            color: var(--platinum);
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.5rem;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .result-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.2rem;
            color: var(--gold);
            margin-top: 10px;
        }

        .result-row {
            display: flex;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(177, 212, 224, 0.2);
        }

        .result-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .result-label {
            min-width: 220px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 1.05rem;
            color: var(--highlight);
        }

        .offloading {
            padding: 100px 0;
            background: rgba(12, 45, 72, 0.4);
            position: relative;
        }

        .offloading::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('https://images.unsplash.com/photo-1566576721346-d4a3b4eaeb55?auto=format&fit=crop&w=2070&q=80') no-repeat center/cover;
            opacity: 0.1;
            z-index: -1;
        }

        .offloading-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 50px;
        }

        @media (max-width: 992px) {
            .offloading-container {
                grid-template-columns: 1fr;
            }
        }

        .offloading-input,
        .offloading-results {
            background: rgba(12, 45, 72, 0.6);
            border: 1px solid rgba(46, 139, 192, 0.3);
            border-radius: 8px;
            padding: 35px 30px;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .offloading-input::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 0;
            background: var(--accent);
            transition: all 0.4s ease;
        }

        .offloading-input:hover::before {
            height: 100%;
        }

        .offloading-results::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 0;
            background: var(--gold);
            transition: all 0.4s ease;
        }

        .offloading-results:hover::before {
            height: 100%;
        }

        .result-card {
            background: rgba(5, 25, 35, 0.7);
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 3px solid var(--gold);
        }

        .offloading-result-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(177, 212, 224, 0.2);
        }

        .offloading-result-row:last-child {
            border-bottom: none;
        }

        .offloading-result-label {
            font-weight: 600;
            color: var(--highlight);
        }

        .offloading-result-value {
            font-family: 'Orbitron', sans-serif;
            color: var(--gold);
            font-size: 1.1rem;
        }

        .chart-container {
            margin-top: 30px;
            background: rgba(5, 25, 35, 0.7);
            border-radius: 8px;
            padding: 20px;
            height: 300px;
        }

        .table-container {
            margin-top: 30px;
            overflow-x: auto;
        }

        .results-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(5, 25, 35, 0.7);
        }

        .results-table th {
            background: rgba(12, 45, 72, 0.8);
            padding: 15px;
            text-align: left;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--gold);
            font-family: 'Rajdhani', sans-serif;
            border-bottom: 2px solid var(--gold);
        }

        .results-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(177, 212, 224, 0.2);
        }

        .results-table tr:last-child td {
            border-bottom: none;
        }

        .results-table tr:hover {
            background: rgba(46, 139, 192, 0.1);
        }

        .loading-indicator {
            color: var(--accent);
            font-style: italic;
            animation: pulse 1.5s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from {
                opacity: 0.6;
            }

            to {
                opacity: 1;
            }
        }

        footer {
            background: var(--dark);
            padding: 80px 0 40px;
            border-top: 1px solid rgba(46, 139, 192, 0.3);
            position: relative;
        }

        footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
        }

        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 50px;
            margin-bottom: 50px;
        }

        .footer-col h3 {
            font-size: 1.4rem;
            margin-bottom: 25px;
            color: var(--gold);
            position: relative;
            padding-bottom: 15px;
            font-family: 'Rajdhani', sans-serif;
            letter-spacing: 1.5px;
            text-transform: uppercase;
        }

        .footer-col h3::after {
            content: '';
            position: absolute;
            width: 50px;
            height: 3px;
            background: var(--gold);
            bottom: 0;
            left: 0;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 15px;
        }

        .footer-links a {
            color: var(--light);
            text-decoration: none;
            transition: all 0.3s ease;
            opacity: 0.8;
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer-links a i {
            color: var(--gold);
            font-size: 0.8rem;
        }

        .footer-links a:hover {
            opacity: 1;
            color: var(--gold);
            transform: translateX(5px);
        }

        .copyright {
            text-align: center;
            padding-top: 40px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 1rem;
            opacity: 0.7;
            letter-spacing: 1px;
            font-family: 'Rajdhani', sans-serif;
        }

        /* Sub-tab navigation styles */
        .sub-tabs {
            display: none;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
            justify-content: center;
        }

        .sub-tab {
            padding: 12px 25px;
            background: rgba(5, 25, 35, 0.8);
            border: 1px solid rgba(46, 139, 192, 0.3);
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-family: 'Rajdhani', sans-serif;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-size: 0.95rem;
            color: var(--light);
        }

        .sub-tab:hover {
            background: var(--accent);
            border-color: var(--accent);
            color: var(--dark);
        }

        .sub-tab.active {
            background: var(--gold);
            border-color: var(--gold);
            color: var(--dark);
        }

        /* Individual page view styles */
        .sub-page {
            display: none;
            background: rgba(12, 45, 72, 0.8);
            border: 1px solid rgba(46, 139, 192, 0.3);
            border-radius: 8px;
            padding: 40px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
            min-height: 400px;
        }

        .sub-page h2 {
            color: var(--gold);
            font-family: 'Rajdhani', sans-serif;
            font-size: 2.2rem;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .sub-page-content {
            line-height: 1.7;
            font-size: 1.1rem;
            color: var(--light);
        }

        .return-btn {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: var(--light);
            border: none;
            padding: 12px 30px;
            border-radius: 4px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
            font-family: 'Rajdhani', sans-serif;
        }

        .return-btn:hover {
            background: linear-gradient(135deg, #c82333, #dc3545);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        /* Feature card clickable styles */
        .feature-card {
            cursor: pointer;
        }

        .feature-card:hover h3 {
            color: var(--gold);
        }

        /* Hide main content when viewing sub-pages */
        .main-content.hidden {
            display: none;
        }

        .sub-content {
            display: none;
        }

        .sub-content.active {
            display: block;
        }

        /* Hide Engineering Calculations sections when viewing subtabs */
        .sub-content.active~.calculations,
        .sub-content.active~.offloading {
            display: none;
        }

        /* Improved hiding of calculations and offloading when in subtab mode */
        body.subtab-mode .calculations,
        body.subtab-mode .offloading {
            display: none !important;
        }

        /* Disclaimer System Styles */
        .disclaimer-banner {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            padding: 12px 20px;
            margin: 20px 0;
            border-radius: 6px;
            border-left: 5px solid #fff;
            font-size: 0.95rem;
            line-height: 1.4;
            box-shadow: 0 3px 10px rgba(220, 53, 69, 0.3);
        }

        .disclaimer-banner strong {
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .disclaimer-btn {
            background: linear-gradient(135deg, #6c757d, #545b62);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .disclaimer-btn:hover {
            background: linear-gradient(135deg, #545b62, #6c757d);
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(108, 117, 125, 0.3);
        }

        .acknowledge-container {
            background: rgba(220, 53, 69, 0.1);
            border: 2px solid #dc3545;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }

        .acknowledge-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            margin-bottom: 15px;
        }

        .acknowledge-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            cursor: pointer;
        }

        .acknowledge-checkbox label {
            color: var(--light);
            line-height: 1.5;
            cursor: pointer;
            font-size: 0.95rem;
        }

        .acknowledge-checkbox label strong {
            color: #dc3545;
            font-weight: 700;
        }

        .calculation-disabled {
            opacity: 0.5;
            pointer-events: none;
            position: relative;
        }

        .calculation-disabled::after {
            content: 'ðŸ”’ Accept disclaimer to enable calculations';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(220, 53, 69, 0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            white-space: nowrap;
            z-index: 10;
        }

        /* Modal Styles */
        .disclaimer-modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
        }

        .disclaimer-modal-content {
            background: linear-gradient(135deg, var(--dark), var(--primary));
            margin: 5% auto;
            padding: 0;
            border: 2px solid var(--gold);
            border-radius: 10px;
            width: 90%;
            max-width: 900px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
        }

        .disclaimer-modal-header {
            background: linear-gradient(135deg, var(--gold), #daa520);
            color: var(--dark);
            padding: 20px 30px;
            border-bottom: 1px solid var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .disclaimer-modal-header h2 {
            margin: 0;
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .disclaimer-modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--dark);
            font-weight: bold;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .disclaimer-modal-close:hover {
            background: rgba(5, 25, 35, 0.2);
            transform: scale(1.1);
        }

        .disclaimer-modal-body {
            padding: 30px;
            max-height: calc(80vh - 200px);
            overflow-y: auto;
            color: var(--light);
            line-height: 1.6;
        }

        .disclaimer-modal-body h3 {
            color: var(--gold);
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.3rem;
            margin: 25px 0 15px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .disclaimer-modal-body h3:first-child {
            margin-top: 0;
        }

        .disclaimer-modal-body p {
            margin-bottom: 15px;
        }

        .disclaimer-modal-body ul {
            margin: 10px 0 15px 20px;
        }

        .disclaimer-modal-body li {
            margin-bottom: 8px;
        }

        .disclaimer-modal-body strong {
            color: var(--gold);
            font-weight: 700;
        }

        .disclaimer-modal-footer {
            background: rgba(5, 25, 35, 0.8);
            padding: 20px 30px;
            border-top: 1px solid var(--accent);
            text-align: center;
        }

        .disclaimer-modal-footer button {
            background: linear-gradient(135deg, var(--gold), #daa520);
            color: var(--dark);
            border: none;
            padding: 12px 30px;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            transition: all 0.3s ease;
        }

        .disclaimer-modal-footer button:hover {
            background: linear-gradient(135deg, #daa520, var(--gold));
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        /* FLNG Electrical Estimator Styles */
        .flng-estimator-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .flng-grid {
            display: grid;
            gap: 20px;
            grid-template-columns: 1.1fr 1fr;
            margin-bottom: 20px;
        }

        .flng-panel {
            background: linear-gradient(180deg, rgba(26, 34, 56, .6), rgba(18, 24, 42, .8));
            border: 1px solid var(--divider, rgba(46, 139, 192, 0.3));
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 6px 22px rgba(0, 0, 0, .25);
        }

        .flng-panel h3,
        .flng-panel h4 {
            margin-top: 2px;
            color: var(--gold);
            font-family: 'Rajdhani', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .flng-full-width {
            grid-column: span 2;
        }

        .flng-inputs {
            display: grid;
            grid-template-columns: repeat(6, minmax(0, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .flng-inputs .form-group {
            display: flex;
            flex-direction: column;
        }

        .flng-inputs label {
            font-size: 12px;
            color: var(--muted, #9fb0c3);
            margin-bottom: 6px;
            font-weight: 600;
        }

        .flng-inputs input,
        .flng-inputs select {
            width: 100%;
            padding: 10px 12px;
            border-radius: 10px;
            background: rgba(15, 20, 36, 0.8);
            color: var(--text, #e9eef5);
            border: 1px solid var(--divider, rgba(46, 139, 192, 0.3));
            outline: none;
            font-size: 0.9rem;
        }

        .flng-inputs input:focus,
        .flng-inputs select:focus {
            border-color: var(--gold);
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
        }

        .flng-coefficients {
            margin: 20px 0;
        }

        .flng-chips {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .flng-chip {
            padding: 6px 10px;
            border-radius: 999px;
            background: rgba(26, 34, 56, 0.8);
            border: 1px solid var(--divider, rgba(46, 139, 192, 0.3));
            color: var(--muted, #9fb0c3);
            font-size: 12px;
        }

        .flng-kpis {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .flng-kpi {
            padding: 15px;
            border-radius: 12px;
            background: rgba(15, 20, 36, 0.8);
            border: 1px solid var(--divider, rgba(46, 139, 192, 0.3));
            text-align: center;
        }

        .kpi-label {
            font-size: 0.9rem;
            color: var(--muted, #9fb0c3);
            margin-bottom: 8px;
        }

        .kpi-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text, #e9eef5);
            font-family: 'Orbitron', sans-serif;
        }

        .kpi-unit {
            font-size: 0.8rem;
            color: var(--muted, #9fb0c3);
            margin-top: 4px;
        }

        .flng-legend {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin: 10px 0;
            font-size: 12px;
        }

        .flng-legend span {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: var(--muted, #9fb0c3);
        }

        .legend-box {
            width: 10px;
            height: 10px;
            border-radius: 2px;
            display: inline-block;
        }

        .flng-chart-container {
            height: 360px;
            background: rgba(15, 20, 36, 0.6);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .flng-note {
            color: var(--muted, #9fb0c3);
            font-size: 12px;
            margin-top: 8px;
        }

        .flng-note-warn {
            color: var(--warn, #ffd166);
            font-size: 13px;
            margin-top: 6px;
            font-weight: 700;
        }

        .flng-generator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .flng-generator-option h4 {
            margin-bottom: 15px;
            color: var(--gold);
            font-family: 'Rajdhani', sans-serif;
        }

        .flng-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid var(--divider, rgba(46, 139, 192, 0.3));
            border-radius: 12px;
            overflow: hidden;
            background: rgba(15, 20, 36, 0.6);
        }

        .flng-table th,
        .flng-table td {
            text-align: left;
            padding: 10px 12px;
            border-bottom: 1px solid var(--divider, rgba(46, 139, 192, 0.3));
            font-size: 14px;
        }

        .flng-table th {
            background: rgba(13, 19, 36, 0.8);
            color: var(--muted, #9fb0c3);
            font-weight: 600;
        }

        .flng-table td {
            color: var(--text, #e9eef5);
        }

        .flng-table tr:last-child th,
        .flng-table tr:last-child td {
            border-bottom: none;
        }

        #flng-calculate-btn {
            margin-top: 20px;
            padding: 12px 25px;
            background: linear-gradient(135deg, var(--gold), #b8860b);
            color: var(--dark);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
            font-family: 'Rajdhani', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        #flng-calculate-btn:hover {
            background: linear-gradient(135deg, #b8860b, var(--gold));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
        }

        #flng-calculate-btn:disabled {
            background: rgba(139, 148, 158, 0.3);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        @media (max-width: 980px) {
            .flng-grid {
                grid-template-columns: 1fr;
            }

            .flng-inputs {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }

            .flng-chart-container {
                height: 320px;
            }

            .flng-full-width {
                grid-column: span 1;
            }
        }

        @media (max-width: 576px) {
            .flng-inputs {
                grid-template-columns: 1fr;
            }

            .flng-kpis {
                grid-template-columns: 1fr;
            }

            .flng-generator-grid {
                grid-template-columns: 1fr;
            }
        }

        /* FLNG Process Sizing Styles */
        .flng-process-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .flng-process-grid {
            display: grid;
            grid-template-columns: 1.3fr 1.7fr;
            gap: 16px;
            margin-bottom: 20px;
        }

        .flng-process-panel {
            background: linear-gradient(180deg, rgba(17, 26, 46, .8), rgba(11, 18, 32, .9));
            border: 1px solid var(--divider);
            border-radius: 16px;
            padding: 16px;
            box-shadow: 0 6px 22px rgba(0, 0, 0, .25);
        }

        .flng-process-panel h3 {
            margin-top: 2px;
            color: var(--gold);
            font-family: 'Rajdhani', sans-serif;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .flng-process-panel.chart-section {
            grid-column: span 2;
        }

        .flng-process-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }

        .flng-process-row label {
            display: block;
            font-size: 12px;
            opacity: .9;
            margin: 10px 0 4px;
            color: var(--muted);
        }

        .flng-process-row input,
        .flng-process-row select {
            width: 100%;
            background: rgba(11, 18, 32, 0.8);
            color: var(--text);
            border: 1px solid var(--divider);
            border-radius: 10px;
            padding: 10px;
            font-size: 0.9rem;
        }

        .flng-process-row input:focus,
        .flng-process-row select:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
        }

        .flng-process-capacity {
            margin: 20px 0;
        }

        .flng-process-capacity .biglabel {
            font-size: 16px;
            font-weight: 700;
            color: var(--gold);
            display: block;
            margin-bottom: 10px;
        }

        .flng-process-capacity input[type=range] {
            width: 100%;
            margin: 10px 0;
        }

        .flng-advanced {
            margin-top: 20px;
        }

        .flng-advanced summary {
            cursor: pointer;
            color: var(--gold);
            font-weight: 600;
            margin-bottom: 15px;
        }

        .flng-advanced h4 {
            color: var(--gold);
            font-family: 'Rajdhani', sans-serif;
            margin: 20px 0 10px 0;
            font-size: 14px;
        }

        .flng-composition-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 10px 0;
        }

        .flng-composition-grid div {
            display: flex;
            flex-direction: column;
        }

        .flng-composition-grid label {
            font-size: 11px;
            margin-bottom: 4px;
        }

        .flng-composition-grid input {
            padding: 8px;
            font-size: 0.85rem;
        }

        .flng-comp-total {
            margin-top: 6px;
            font-size: 12px;
            color: var(--muted);
        }

        .flng-results-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background: rgba(15, 20, 36, 0.6);
            border-radius: 8px;
            overflow: hidden;
        }

        .flng-results-table th,
        .flng-results-table td {
            border-bottom: 1px solid var(--divider);
            padding: 8px 6px;
            text-align: right;
            font-size: 13px;
        }

        .flng-results-table th:first-child,
        .flng-results-table td:first-child {
            text-align: left;
        }

        .flng-results-table th {
            color: var(--gold);
            background: rgba(13, 19, 36, 0.8);
            font-weight: 600;
        }

        .flng-results-table td {
            color: var(--text);
        }

        .flng-section-title {
            font-weight: 700;
            margin: 16px 0 8px 0;
            color: var(--gold);
            font-size: 14px;
        }

        .flng-process-chart-container {
            height: 360px;
            background: rgba(15, 20, 36, 0.6);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .flng-note {
            color: var(--muted);
            font-size: 12px;
            margin-top: 8px;
        }

        #flng-process-calculate-btn {
            margin-top: 20px;
            padding: 12px 25px;
            background: linear-gradient(135deg, var(--gold), #b8860b);
            color: var(--dark);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
            font-family: 'Rajdhani', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
            width: 100%;
        }

        #flng-process-calculate-btn:hover {
            background: linear-gradient(135deg, #b8860b, var(--gold));
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
        }

        #flng-process-calculate-btn:disabled {
            background: rgba(139, 148, 158, 0.3);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        @media (max-width: 980px) {
            .flng-process-grid {
                grid-template-columns: 1fr;
            }

            .flng-process-panel.chart-section {
                grid-column: span 1;
            }

            .flng-composition-grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        @media (max-width: 576px) {
            .flng-process-row {
                grid-template-columns: 1fr;
            }

            .flng-composition-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 1200px) {
            .hero h1 {
                font-size: 3.5rem;
            }

            .hero h1 span {
                font-size: 3rem;
            }
        }

        @media (max-width: 992px) {
            .hero h1 {
                font-size: 3rem;
            }

            .hero h1 span {
                font-size: 2.5rem;
            }

            .calc-form {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .hero h1 {
                font-size: 2.6rem;
            }

            .hero h1 span {
                font-size: 2.2rem;
            }

            .hero-stats {
                flex-wrap: wrap;
                gap: 30px;
            }

            .stat-item {
                flex: 1 0 45%;
            }

            .stat-item:not(:last-child)::after {
                display: none;
            }

            .feature-card {
                padding: 30px 25px;
            }
        }

        @media (max-width: 576px) {
            .hero h1 {
                font-size: 2.2rem;
            }

            .hero h1 span {
                font-size: 1.8rem;
            }

            .hero p {
                font-size: 1.1rem;
            }

            .section-title h2 {
                font-size: 2.2rem;
            }

            .logo-text {
                font-size: 1.4rem;
            }

            .logo-text span {
                font-size: 0.9rem;
            }
        }
    </style>
</head>

<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <div class="logo">
                <div class="logo-icon"><i class="fas fa-chart-line"></i></div>
                <div class="logo-text">MURPHY'S CURVES<span>FLNG ENGINEERING SUITE</span></div>
            </div>
            <ul class="nav-links">
                <li><a href="#features">Capabilities</a></li>
                <li><a href="#calculations">Calculations</a></li>
                <li><a href="#offloading">Offloading</a></li>
                <li><a href="#about">About</a></li>
            </ul>
            <div class="auth-buttons">
                <button class="btn btn-outline" id="loginBtn">Login</button>
                <button class="btn btn-primary" id="registerBtn">Register</button>
                <button class="btn btn-danger" id="logoutBtn" style="display: none;">Logout</button>
                <button class="disclaimer-btn" id="disclaimerBtn">Disclaimer</button>
            </div>
        </div>
    </header>

    <!-- Website Disclaimer Banner - Prominent Header Position -->
    <div class="header-disclaimer-banner">
        <div class="container">
            <div class="disclaimer-content">
                <i class="fas fa-exclamation-triangle disclaimer-icon"></i>
                <div class="disclaimer-text">
                    <strong>IMPORTANT DISCLAIMER:</strong>
                    By proceeding, I confirm I have read and accept the
                    <button id="disclaimerLinkBtn" class="disclaimer-link">Website Disclaimer</button>,
                    understand that outputs are illustrative only, and will obtain independent professional verification
                    and supervisor approval before any design, procurement, or operational use.
                </div>
                <div class="disclaimer-actions">
                    <label class="disclaimer-checkbox-label">
                        <input type="checkbox" id="acknowledgeDisclaimer" class="disclaimer-checkbox">
                        <span class="checkmark"></span>
                        I acknowledge and accept
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-bg"></div>
        <div class="container">
            <div class="hero-content">
                <h1>PRECISION ENGINEERING <span>FOR FLNG EXCELLENCE</span></h1>
                <p>Murphy's Curves provides the industry's most advanced engineering calculation suite for Floating
                    Liquefied Natural Gas operations. Developed by experts, trusted by worldwide engineers.</p>
                <div class="auth-buttons">
                    <button class="btn btn-primary" id="heroRegisterBtn">Request Access</button>
                    <button class="btn btn-outline">Explore Modules</button>
                </div>
                <div class="hero-stats">
                    <div class="stat-item">
                        <div class="stat-value">28+</div>
                        <div class="stat-label">Engineering Modules</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">99.2%</div>
                        <div class="stat-label">Accuracy Rate</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">1.8k+</div>
                        <div class="stat-label">Industry Users</div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Main Content Wrapper -->
    <div class="main-content" id="mainContent">
        <!-- Features Section -->
        <section class="features" id="features">
            <div class="container">
                <div class="section-title">
                    <h2>Engineering Capabilities</h2>
                    <p>Murphy's Curves offers the most comprehensive set of FLNG engineering calculations in the market,
                        trusted by top operators worldwide.</p>
                </div>
                <div class="features-grid">
                    <div class="feature-card" data-tab="mechanical">
                        <div class="feature-icon"><i class="fas fa-cogs"></i></div>
                        <h3>Mechanical Analysis</h3>
                        <p>Advanced mechanical system analysis including rotating equipment, vibration, and mechanical
                            integrity assessments.</p>
                    </div>
                    <div class="feature-card" data-tab="process">
                        <div class="feature-icon"><i class="fas fa-industry"></i></div>
                        <h3>Process Analysis</h3>
                        <p>Comprehensive process flow analysis, optimization tools, and performance evaluation for LNG
                            operations.</p>
                    </div>
                    <div class="feature-card" data-tab="piping">
                        <div class="feature-icon"><i class="fas fa-project-diagram"></i></div>
                        <h3>Piping Analysis</h3>
                        <p>Detailed piping system design, stress analysis, and flow calculations for cryogenic
                            applications.</p>
                    </div>
                    <div class="feature-card" data-tab="structural">
                        <div class="feature-icon"><i class="fas fa-cubes"></i></div>
                        <h3>Structural Analysis</h3>
                        <p>Comprehensive structural analysis for hull, turret, and mooring systems under various load
                            cases.</p>
                    </div>
                    <div class="feature-card" data-tab="power">
                        <div class="feature-icon"><i class="fas fa-bolt"></i></div>
                        <h3>Power Analysis</h3>
                        <p>Integrated electrical load analysis, power generation optimization, and energy management
                            systems.</p>
                    </div>
                    <div class="feature-card" data-tab="project">
                        <div class="feature-icon"><i class="fas fa-tasks"></i></div>
                        <h3>Project Management</h3>
                        <p>Comprehensive project planning, scheduling, resource management, and progress tracking tools.
                        </p>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <!-- End Main Content Wrapper -->

    <!-- Sub-tabs and Individual Pages Section -->
    <section class="sub-content" id="subContent">
        <div class="container">
            <!-- Main Tab Title -->
            <div class="main-tab-title" id="mainTabTitle"
                style="text-align: center; margin-bottom: 30px; display: none;">
                <div
                    style="display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 10px;">
                    <h2
                        style="color: var(--gold); font-family: 'Rajdhani', sans-serif; font-size: 2.5rem; text-transform: uppercase; letter-spacing: 2px; margin: 0;">
                    </h2>
                    <button class="btn btn-outline" onclick="returnToMain()"
                        style="padding: 10px 20px; font-size: 0.9rem; border-color: #dc3545; color: #dc3545;"
                        onmouseover="this.style.backgroundColor='rgba(220, 53, 69, 0.1)'; this.style.transform='translateY(-2px)'"
                        onmouseout="this.style.backgroundColor='transparent'; this.style.transform='translateY(0)'">
                        Back to Engineering Capabilities
                    </button>
                </div>
                <p style="color: var(--highlight); font-size: 1.1rem; opacity: 0.9;"></p>
            </div>

            <!-- Sub-tab Navigation -->
            <div class="sub-tabs" id="subTabs">
                <!-- Sub-tabs will be dynamically generated based on selected main tab -->
            </div>

            <!-- Individual Sub-pages for each main tab -->
            <!-- Mechanical Analysis Sub-pages -->
            <div class="sub-page" id="mechanical-1" data-main="mechanical">
                <h2>AI Elec Motor Centrifugal Compressor Analyzer (TBE & TCs)</h2>
                <div class="sub-page-content">
                    <p>Advanced AI-powered equipment sizing and analysis tool for electric motors, centrifugal
                        compressors, TBE (Turbo-Blowers & Expanders) and TCs (Turbo-Compressors).</p>
                    <div
                        style="width: 100%; min-height: 600px; border: 1px solid var(--accent); border-radius: 8px; overflow: hidden; background: rgba(5, 25, 35, 0.7); padding: 30px;">
                        <div
                            style="background: rgba(20, 40, 60, 0.9); padding: 30px; border-radius: 8px; margin-bottom: 30px; text-align: center;">
                            <h3 style="color: var(--gold); margin-bottom: 20px; font-size: 1.5rem;">
                                <i class="fas fa-robot" style="margin-right: 10px;"></i>Access AI Elec Motor Centrifugal
                                Compressor Analyzer
                            </h3>
                            <p
                                style="color: var(--highlight); margin-bottom: 25px; line-height: 1.6; font-size: 1.1rem;">
                                Launch the advanced AI-powered equipment analyzer in a new window for optimal
                                performance.
                            </p>
                            <a href="https://murphys-curves-api-kbadnfjsu8wn4yvmswb6mw.streamlit.app/" target="_blank"
                                rel="noopener noreferrer" class="btn btn-primary"
                                style="display: inline-flex; align-items: center; gap: 10px; text-decoration: none; font-size: 1.1rem; padding: 18px 40px;">
                                <i class="fas fa-external-link-alt"></i>
                                Launch AI Equipment Analyzer
                            </a>
                        </div>
                        <div
                            style="background: rgba(12, 45, 72, 0.6); padding: 30px; border-radius: 8px; border-left: 4px solid var(--gold);">
                            <h4 style="color: var(--platinum); margin-bottom: 20px; font-size: 1.3rem;">
                                <i class="fas fa-info-circle" style="margin-right: 10px; color: var(--gold);"></i>Key
                                Features:
                            </h4>
                            <ul style="color: var(--light); line-height: 2.2; list-style: none; padding: 0;">
                                <li style="margin-bottom: 12px;"><i class="fas fa-check-circle"
                                        style="color: var(--gold); margin-right: 15px;"></i>Insert Word or PDF files for
                                    AI Analysing</li>
                                <li style="margin-bottom: 12px;"><i class="fas fa-check-circle"
                                        style="color: var(--gold); margin-right: 15px;"></i>Remove those performance
                                    curves, GA and PIDs within content of vendor proposal before uploading. This will
                                    promote the accuracy of AI analysing task</li>
                                <li style="margin-bottom: 12px;"><i class="fas fa-check-circle"
                                        style="color: var(--gold); margin-right: 15px;"></i>AI will create a TBE and TCs
                                    as required</li>
                                <li style="margin-bottom: 12px;"><i class="fas fa-check-circle"
                                        style="color: var(--gold); margin-right: 15px;"></i>Download the TBE and TCs
                                    once analysing is done</li>
                                <li style="margin-bottom: 12px;"><i class="fas fa-check-circle"
                                        style="color: var(--gold); margin-right: 15px;"></i>Tune the TBE and TCs content
                                    as necessary</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="mechanical-2" data-main="mechanical">
                <h2 id="gt-chartTitle">GT RATING ESTIMATOR</h2>
                <div class="sub-page-content">
                    <!-- GT Rating Model Estimator will be loaded here -->
                    <div id="gt-rating-content"></div>
                    <div
                        style="position: relative; height: 500px; margin-top: 30px; background: rgba(5, 25, 35, 0.7); border-radius: 8px; padding: 20px;">
                        <canvas id="gtPowerChart"></canvas>
                    </div>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="mechanical-3" data-main="mechanical">
                <h2>Mechanical Integrity</h2>
                <div class="sub-page-content">
                    <p>Fatigue analysis, crack propagation studies, and remaining useful life calculations for critical
                        mechanical components.</p>
                    <div class="table-container">
                        <table class="results-table">
                            <thead>
                                <tr>
                                    <th>Component</th>
                                    <th>Stress Level</th>
                                    <th>Remaining Life</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Main Shaft</td>
                                    <td>Medium</td>
                                    <td>15 years</td>
                                    <td>Good</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="mechanical-4" data-main="mechanical">
                <h2>Centrifugal Pump - Centrifugal Pump Sizing & Analysis</h2>
                <div class="sub-page-content">
                    <div class="pump-container">
                        <div class="pump-tabs">
                            <div class="pump-tab active" data-tab="input-output">Input/Output</div>
                            <div class="pump-tab" data-tab="performance-curve">Performance Curve</div>
                            <div class="pump-tab" data-tab="viscous-correction">Viscous Correction</div>
                        </div>

                        <div class="pump-tab-content active" id="pump-input-output">
                            <div class="pump-input-section">
                                <h3>Input Parameters</h3>
                                <div class="pump-input-grid">
                                    <div class="form-group">
                                        <label for="pump-n">Speed (N, rpm)</label>
                                        <input type="number" id="pump-n" value="1500" step="100">
                                    </div>
                                    <div class="form-group">
                                        <label for="pump-q">Flow Rate (Q, mÂ³/hr)</label>
                                        <input type="number" id="pump-q" value="500" step="10">
                                    </div>
                                    <div class="form-group">
                                        <label for="pump-tdhm">Total Dynamic Head (TDHm, meters)</label>
                                        <input type="number" id="pump-tdhm" value="195" step="5">
                                    </div>
                                    <div class="form-group">
                                        <label for="pump-npsha">NPSHA (meters)</label>
                                        <input type="number" id="pump-npsha" value="3" step="0.1">
                                    </div>
                                    <div class="form-group">
                                        <label for="pump-suctype">Suction Type</label>
                                        <select id="pump-suctype">
                                            <option value="1">Single Suction</option>
                                            <option value="2" selected>Double Suction</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="pump-sg">Specific Gravity (SG)</label>
                                        <input type="number" id="pump-sg" value="1" step="0.1">
                                    </div>
                                    <div class="form-group">
                                        <label for="pump-num_impellers">Number of Impellers</label>
                                        <input type="number" id="pump-num_impellers" value="2" min="1">
                                    </div>
                                    <div class="form-group">
                                        <label for="pump-viscosity">Viscosity (centistoke)</label>
                                        <input type="number" id="pump-viscosity" value="1" step="0.1">
                                    </div>
                                </div>
                                <button id="pump-calculate-btn" class="btn btn-primary">Calculate Pump
                                    Performance</button>
                            </div>

                            <div class="pump-output-section">
                                <h3>Output Results</h3>
                                <div class="pump-output-grid">
                                    <div class="output-item">
                                        <div class="output-label">Efficiency (%)</div>
                                        <div class="output-value" id="pump-efficiency">-</div>
                                    </div>
                                    <div class="output-item">
                                        <div class="output-label">Universal Specific Speed (Uns)</div>
                                        <div class="output-value" id="pump-uns">-</div>
                                    </div>
                                    <div class="output-item">
                                        <div class="output-label">Specific Speed (Ns)</div>
                                        <div class="output-value" id="pump-ns">-</div>
                                    </div>
                                    <div class="output-item">
                                        <div class="output-label">Universal Suction Specific Speed (UNss)</div>
                                        <div class="output-value" id="pump-unss">-</div>
                                    </div>
                                    <div class="output-item">
                                        <div class="output-label">Suction Specific Speed (Nss)</div>
                                        <div class="output-value" id="pump-nss">-</div>
                                    </div>
                                    <div class="output-item">
                                        <div class="output-label">Head Coefficient (Phi)</div>
                                        <div class="output-value" id="pump-phi">-</div>
                                    </div>
                                    <div class="output-item">
                                        <div class="output-label">Angular Velocity (rad/s)</div>
                                        <div class="output-value" id="pump-angvel">-</div>
                                    </div>
                                    <div class="output-item">
                                        <div class="output-label">Tip Speed U2 (m/s)</div>
                                        <div class="output-value" id="pump-tipspeed">-</div>
                                    </div>
                                    <div class="output-item">
                                        <div class="output-label">Impeller Diameter (mm)</div>
                                        <div class="output-value" id="pump-impdia">-</div>
                                    </div>
                                    <div class="output-item">
                                        <div class="output-label">Head per Stage (m)</div>
                                        <div class="output-value" id="pump-headstage">-</div>
                                    </div>
                                    <div class="output-item">
                                        <div class="output-label">Hydraulic Power (kW)</div>
                                        <div class="output-value" id="pump-hydpower">-</div>
                                    </div>
                                    <div class="output-item">
                                        <div class="output-label">Reynolds Number (Re)</div>
                                        <div class="output-value" id="pump-reynolds">-</div>
                                    </div>
                                    <div class="output-item">
                                        <div class="output-label">Ns Status</div>
                                        <div class="output-value" id="pump-nstatus">-</div>
                                    </div>
                                </div>

                                <div class="pump-warning-section">
                                    <div class="warning-title">System Warnings & Remarks</div>
                                    <div id="pump-warnings-container">
                                        <div class="warning-item no-warnings">Run calculation to see warnings...</div>
                                    </div>
                                </div>

                                <div class="pump-new-performance-section" id="pump-new-performance-section"
                                    style="display: none;">
                                    <div class="new-performance-title">New Pump Performance (Low Ns - Consider Rotary
                                        Pump)</div>
                                    <table class="results-table">
                                        <thead>
                                            <tr>
                                                <th>Parameter</th>
                                                <th>Value</th>
                                                <th>Unit</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td>Flow Rate (Q)</td>
                                                <td id="pump-np-flow">-</td>
                                                <td>mÂ³/hr</td>
                                            </tr>
                                            <tr>
                                                <td>Total Dynamic Head (TDHm)</td>
                                                <td id="pump-np-head">-</td>
                                                <td>m</td>
                                            </tr>
                                            <tr>
                                                <td>Specific Speed (Ns)</td>
                                                <td id="pump-np-ns">-</td>
                                                <td>-</td>
                                            </tr>
                                            <tr>
                                                <td>Impeller Diameter</td>
                                                <td id="pump-np-impdia">-</td>
                                                <td>mm</td>
                                            </tr>
                                            <tr>
                                                <td>NPSHr</td>
                                                <td id="pump-np-npsh">-</td>
                                                <td>m</td>
                                            </tr>
                                            <tr>
                                                <td>Speed (N)</td>
                                                <td id="pump-np-speed">-</td>
                                                <td>rpm</td>
                                            </tr>
                                            <tr>
                                                <td>New Efficiency</td>
                                                <td id="pump-np-efficiency">-</td>
                                                <td>%</td>
                                            </tr>
                                            <tr>
                                                <td>New Hydraulic Power</td>
                                                <td id="pump-np-hydpower">-</td>
                                                <td>kW</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div class="pump-tab-content" id="pump-performance-curve">
                            <h3>Performance Curve</h3>
                            <div class="formula-explanation">
                                <div class="formula-title">Motor Sizing Guidelines:</div>
                                <p>1. If pump shaft power is &lt; 22 kW, motor nameplate rating shall be 125% at least
                                </p>
                                <p>2. If pump shaft power is 22 to 55kW, motor nameplate rating shall be 115% at least
                                </p>
                                <p>3. If pump shaft power is &gt; 55kW, motor nameplate rating shall be 110% at least
                                </p>
                                <p>4. For open valve startup scenario, motor rating shall be sized for EOC (end of curve
                                    power) i.e. 1.3 x pump shaft power at least</p>
                            </div>
                            <div class="pump-chart-container">
                                <canvas id="pump-performanceChart"></canvas>
                            </div>
                            <h4>Performance Data Table</h4>
                            <div class="pump-data-table-container">
                                <table class="results-table" id="pump-performanceTable">
                                    <thead>
                                        <tr>
                                            <th>Flow (mÂ³/hr)</th>
                                            <th>Head (m)</th>
                                            <th>Efficiency (%)</th>
                                            <th>NPSH (m)</th>
                                            <th>Power (kW)</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>

                        <div class="pump-tab-content" id="pump-viscous-correction">
                            <h3>Viscous Correction Factors</h3>
                            <div class="pump-output-grid">
                                <div class="output-item">
                                    <div class="output-label">CQ (Flow Correction)</div>
                                    <div class="output-value" id="pump-cq">-</div>
                                </div>
                                <div class="output-item">
                                    <div class="output-label">CH (Head Correction)</div>
                                    <div class="output-value" id="pump-ch">-</div>
                                </div>
                                <div class="output-item">
                                    <div class="output-label">CE (Efficiency Correction)</div>
                                    <div class="output-value" id="pump-ce">-</div>
                                </div>
                            </div>
                            <div class="pump-chart-container">
                                <canvas id="pump-viscousChart"></canvas>
                            </div>
                            <h4>Corrected Viscous Performance Data</h4>
                            <div class="pump-data-table-container">
                                <table class="results-table" id="pump-viscousCorrectedTable">
                                    <thead>
                                        <tr>
                                            <th>Flow (mÂ³/hr)</th>
                                            <th>Corrected Head (m)</th>
                                            <th>Corrected Efficiency (%)</th>
                                            <th>Corrected Power (kW)</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="mechanical-5" data-main="mechanical">
                <h2>Maintenance Planning</h2>
                <div class="sub-page-content">
                    <p>Predictive maintenance strategies, reliability analysis, and optimization of maintenance
                        schedules for mechanical systems.</p>
                    <div class="result-card">
                        <h3>Maintenance Schedule</h3>
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">Next Maintenance</div>
                            <div class="offloading-result-value">30 Days</div>
                        </div>
                    </div>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <!-- Process Analysis Sub-pages -->
            <div class="sub-page" id="process-1" data-main="process">
                <h2>FLNG Process Sizing Trend Analysis</h2>
                <div class="sub-page-content">
                    <!-- FLNG Process Sizing Tool -->
                    <div class="flng-process-container">
                        <div class="flng-process-grid">
                            <!-- Inputs Section -->
                            <div class="flng-process-panel inputs">
                                <h3>Inputs & Assumptions</h3>

                                <div class="flng-process-row">
                                    <div>
                                        <label>Load Data basis</label>
                                        <select id="flng-basis">
                                            <option value="custom">Custom</option>
                                            <option value="onefive">X MTPA</option>
                                            <option value="twofour">XX MTPA</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label>Liquefaction scheme</label>
                                        <select id="flng-scheme">
                                            <option value="SMR">SMR (single mixed refrigerant)</option>
                                            <option value="C3MR">C3MR / Cascade</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="flng-process-capacity">
                                    <label class="biglabel">Annual LNG target (MTPA): <span class="mono"
                                            id="flng-capVal">2.0</span></label>
                                    <input id="flng-cap" type="range" min="0.5" max="10.0" step="0.1" value="2.0" />
                                </div>

                                <div class="flng-process-row">
                                    <div>
                                        <label>Availability (%)</label>
                                        <input id="flng-AVAIL" type="number" step="0.01" value="92" />
                                    </div>
                                    <div>
                                        <label>Operating fraction (turndown) (%)</label>
                                        <input id="flng-OP_FRAC" type="number" step="1" value="100" />
                                    </div>
                                </div>

                                <div class="flng-process-row">
                                    <div>
                                        <label>Air temp (Â°C)</label>
                                        <input id="flng-T_AIR" type="number" step="0.5" value="32" />
                                    </div>
                                    <div>
                                        <label>Seawater temp (Â°C)</label>
                                        <input id="flng-T_SW" type="number" step="0.5" value="28" />
                                    </div>
                                </div>

                                <div class="flng-process-row">
                                    <div>
                                        <label>Liquid yield (LNG/feed) â€” blank=auto from composition</label>
                                        <input id="flng-Y_L" type="number" step="0.01" placeholder="auto" />
                                    </div>
                                    <div>
                                        <label>BOG (% of LNG)</label>
                                        <input id="flng-f_BOG" type="number" step="0.01" value="0.12" />
                                        <label style="margin-top:8px">BOG scenario</label>
                                        <select id="flng-bog_scn">
                                            <option value="base">Base</option>
                                            <option value="hot">Hot season</option>
                                            <option value="loading">Loading / cooldown</option>
                                            <option value="holding">Holding / degas</option>
                                        </select>
                                    </div>
                                </div>

                                <div class="flng-process-row">
                                    <div>
                                        <label>MR circ (kg/kg LNG) SMR / C3MR</label>
                                        <input id="flng-r_MR_SMR" type="number" step="0.1" value="1.7" />
                                        <input id="flng-r_MR_C3MR" type="number" step="0.1" value="1.2" />
                                    </div>
                                    <div>
                                        <label>Propane circ (kg/kg LNG) (C3MR)</label>
                                        <input id="flng-r_C3" type="number" step="0.05" value="0.30" />
                                    </div>
                                </div>

                                <div class="flng-process-row">
                                    <div>
                                        <label>Specific power (kWh per ton LNG) â€” SMR / C3MR</label>
                                        <input id="flng-SP_LNG_SMR" type="number" step="1" value="280" />
                                        <input id="flng-SP_LNG_C3MR" type="number" step="1" value="240" />
                                        <div class="flng-explanation-text"
                                            style="margin-top: 8px; font-size: 0.9em; color: var(--muted); font-style: italic;">
                                            "Specific power" = total refrigeration driver power per LNG production rate
                                            at base conditions. Use vendor/licensor values when available
                                        </div>
                                    </div>
                                    <div>
                                        <label>Margins (flow / power)</label>
                                        <input id="flng-M_flow" type="number" step="0.01" value="1.10" />
                                        <input id="flng-M_power" type="number" step="0.01" value="1.10" />
                                    </div>
                                </div>

                                <!-- Collapsible Advanced Settings -->
                                <details class="flng-advanced">
                                    <summary>Advanced Process Parameters</summary>

                                    <h4>MR / C3 Pressures (bar abs)</h4>
                                    <div class="flng-process-row">
                                        <div>
                                            <label>MR LP P1/P2</label>
                                            <input id="flng-P1_MR_LP" type="number" step="0.1" value="3.0" />
                                            <input id="flng-P2_MR_LP" type="number" step="0.1" value="9.0" />
                                        </div>
                                        <div>
                                            <label>MR HP P1/P2</label>
                                            <input id="flng-P1_MR_HP" type="number" step="0.1" value="9.0" />
                                            <input id="flng-P2_MR_HP" type="number" step="0.1" value="29.0" />
                                        </div>
                                    </div>

                                    <div class="flng-process-row">
                                        <div>
                                            <label>C3 LP P1/P2</label>
                                            <input id="flng-P1_C3_LP" type="number" step="0.1" value="2.5" />
                                            <input id="flng-P2_C3_LP" type="number" step="0.1" value="10.0" />
                                        </div>
                                        <div>
                                            <label>C3 HP P1/P2</label>
                                            <input id="flng-P1_C3_HP" type="number" step="0.1" value="10.0" />
                                            <input id="flng-P2_C3_HP" type="number" step="0.1" value="20.0" />
                                        </div>
                                    </div>

                                    <h4>Feed & BOG Compressors</h4>
                                    <div class="flng-process-row">
                                        <div>
                                            <label>FG P1 / T1 (Â°C) / P2</label>
                                            <input id="flng-P1_FG" type="number" step="0.1" value="39.418" />
                                            <input id="flng-T1_FG" type="number" step="0.1" value="41.0" />
                                            <input id="flng-P2_FG" type="number" step="0.1" value="85.667" />
                                        </div>
                                        <div class="flng-process-row">
                                            <div>
                                                <label>BOG P1 / T1 (Â°C) / P2</label>
                                                <input id="flng-P1_BOG" type="number" step="0.01" value="1.118" />
                                                <input id="flng-T1_BOG" type="number" step="0.1" value="-130.0" />
                                                <input id="flng-P2_BOG" type="number" step="0.1" value="40.004" />
                                            </div>
                                            <div>
                                                <label>Polytropic Î· (FG / BOG)</label>
                                                <input id="flng-etaP_FG" type="number" step="0.01" value="0.86" />
                                                <input id="flng-etaP_BOG" type="number" step="0.01" value="0.75" />
                                            </div>
                                        </div>

                                        <div class="flng-process-row">
                                            <div>
                                                <label>FG gas props (k, Z, MW, Î·<sub>p</sub>)</label>
                                                <select id="flng-prop_basis">
                                                    <option value="auto">Auto from composition</option>
                                                    <option value="vendor_15">Vendor X MTPA</option>
                                                    <option value="vendor_24">Vendor XX MTPA</option>
                                                </select>
                                            </div>
                                            <div>
                                                <label>Current props used (read-only)</label>
                                                <input id="flng-show_props" type="text" readonly
                                                    value="k=?, Z=?, MW=?, Î·p=?" />
                                            </div>
                                        </div>

                                        <div class="flng-process-row">
                                            <div>
                                                <label>Stage head limit (kJ/kg)</label>
                                                <input id="flng-H_stage" type="number" step="10" value="200" />
                                            </div>
                                            <div></div>
                                        </div>

                                        <h4>Feed Gas Composition (vol%)</h4>
                                        <div class="flng-composition-grid">
                                            <div><label>CHâ‚„</label><input id="flng-x_CH4" type="number" step="0.1"
                                                    value="90"></div>
                                            <div><label>Câ‚‚Hâ‚†</label><input id="flng-x_C2" type="number" step="0.1"
                                                    value="5"></div>
                                            <div><label>Câ‚ƒHâ‚ˆ</label><input id="flng-x_C3" type="number" step="0.1"
                                                    value="2"></div>
                                            <div><label>nCâ‚„+iCâ‚„</label><input id="flng-x_C4" type="number" step="0.1"
                                                    value="1"></div>
                                            <div><label>Câ‚…âº</label><input id="flng-x_C5p" type="number" step="0.1"
                                                    value="0.5"></div>
                                            <div><label>Nâ‚‚</label><input id="flng-x_N2" type="number" step="0.1"
                                                    value="1.2"></div>
                                            <div><label>COâ‚‚</label><input id="flng-x_CO2" type="number" step="0.1"
                                                    value="0.3"></div>
                                        </div>
                                        <div class="flng-comp-total">
                                            <b>Total:</b> <span id="flng-comp_total" class="mono">100.0</span> %
                                            <span style="color:#ef4444; margin-left:8px"><b>Note:</b> total gas
                                                composition shall not be more than 100%</span>
                                        </div>

                                        <h4>Utility scalers</h4>
                                        <div class="flng-process-row">
                                            <div>
                                                <label>CW mÂ³/h per MW_th (MCHE)</label>
                                                <input id="flng-CW_m3h_per_MWth" type="number" step="1" value="60" />
                                            </div>
                                            <div>
                                                <label>Hot oil kW per t/h LNG (overall)</label>
                                                <input id="flng-HO_kW_per_tph" type="number" step="1" value="15" />
                                            </div>
                                        </div>
                                        <div class="flng-process-row">
                                            <div>
                                                <label>Inst. air NmÂ³/h per MW_e (per driver)</label>
                                                <input id="flng-IA_Nm3h_per_MWe" type="number" step="1" value="8" />
                                            </div>
                                            <div>
                                                <label>Nâ‚‚ NmÂ³/h per t/h LNG (overall)</label>
                                                <input id="flng-N2_Nm3h_per_tph" type="number" step="0.1" value="2" />
                                            </div>
                                        </div>
                                        <div class="flng-process-row">
                                            <div>
                                                <label>Flare purge (% of Feed mass)</label>
                                                <input id="flng-Flare_pct" type="number" step="0.01" value="0.10" />
                                            </div>
                                            <div></div>
                                        </div>

                                        <h4>NGL product recovery (fractions of component mass)</h4>
                                        <div class="flng-process-row">
                                            <div>
                                                <label>C3 â†’ LPG recovery (%)</label>
                                                <input id="flng-R_C3_LPG" type="number" step="1" value="85" />
                                            </div>
                                            <div>
                                                <label>C4 â†’ LPG recovery (%)</label>
                                                <input id="flng-R_C4_LPG" type="number" step="1" value="95" />
                                            </div>
                                        </div>
                                        <div class="flng-process-row">
                                            <div>
                                                <label>C5âº â†’ Condensate recovery (%)</label>
                                                <input id="flng-R_C5_COND" type="number" step="1" value="95" />
                                            </div>
                                            <div></div>
                                        </div>


                                </details>

                                <button id="flng-process-calculate-btn" class="btn btn-primary">Calculate Process
                                    Sizing</button>

                                <!-- Configurations (rules used) -->
                                <div class="flng-configurations-rules"
                                    style="margin-top: 25px; padding: 20px; background: rgba(5, 25, 35, 0.6); border-radius: 8px; border-left: 4px solid var(--gold);">
                                    <h4 style="color: var(--gold); margin-bottom: 15px; font-size: 1.1em;">
                                        Configurations (rules used)</h4>
                                    <div style="color: var(--highlight); line-height: 1.6; font-size: 0.95em;">
                                        <div style="margin-bottom: 10px;">â€¢ <strong>Stages:</strong> from polytropic
                                            head with a stage head limit (default 200 kJ/kg; adjustable).</div>
                                        <div style="margin-bottom: 10px;">â€¢ <strong>Trains:</strong> ruleâ€‘ofâ€‘thumb by
                                            flow (FG > 500 t/h â†’ 2 trains).</div>
                                        <div style="margin-bottom: 10px;">â€¢ <strong>MCHE count:</strong> 1 unit < 3
                                                MTPA; 2 units for 3â€“6; 2â€“3 units> 6 (guideline).</div>
                                        <div style="margin-bottom: 10px;">â€¢ <strong>C3MR:</strong> shows separate C3
                                            compressor + MR compressor notation and power split.</div>
                                        <div style="font-style: italic; color: var(--muted); margin-top: 15px;">
                                            <strong>Note:</strong> When trains > 1, Cold duty, Refrigeration power,
                                            MR/C3 power split, FG and BOG compressor powers are divided per train
                                            accordingly (numbers in parentheses show perâ€‘train values).
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Results Section -->
                            <div class="flng-process-panel results">
                                <h3>Headline Results (at capacity)</h3>

                                <div class="flng-section-title">Production</div>
                                <table class="flng-results-table">
                                    <tr>
                                        <th>Metric</th>
                                        <th>Value</th>
                                    </tr>
                                    <tr>
                                        <td>LNG mass flow</td>
                                        <td><span id="flng-v_lng" class="mono">-</span> t/h</td>
                                    </tr>
                                    <tr>
                                        <td>Feed gas mass flow</td>
                                        <td><span id="flng-v_fg" class="mono">-</span> t/h</td>
                                    </tr>
                                    <tr>
                                        <td>LPG production</td>
                                        <td><span id="flng-v_lpg" class="mono">-</span> t/h</td>
                                    </tr>
                                    <tr>
                                        <td>Condensate production</td>
                                        <td><span id="flng-v_cond" class="mono">-</span> t/h</td>
                                    </tr>
                                    <tr>
                                        <td>BOG mass flow</td>
                                        <td><span id="flng-v_bog" class="mono">-</span> t/h</td>
                                    </tr>
                                    <tr>
                                        <td>Cold duty</td>
                                        <td><span id="flng-v_q" class="mono">-</span> MW</td>
                                    </tr>
                                    <tr>
                                        <td>Refrigeration power</td>
                                        <td><span id="flng-v_pref" class="mono">-</span> MW<sub>e</sub></td>
                                    </tr>
                                    <tr>
                                        <td>MR / C3 power split</td>
                                        <td><span id="flng-v_split" class="mono">-</span></td>
                                    </tr>
                                </table>

                                <div class="flng-section-title">Driver Powers</div>
                                <table class="flng-results-table">
                                    <tr>
                                        <th>Driver</th>
                                        <th>Power</th>
                                    </tr>
                                    <tr>
                                        <td>FG compressor</td>
                                        <td><span id="flng-v_pfg" class="mono">-</span> MW<sub>e</sub></td>
                                    </tr>
                                    <tr>
                                        <td>BOG compressor</td>
                                        <td><span id="flng-v_pbog" class="mono">-</span> MW<sub>e</sub></td>
                                    </tr>
                                </table>

                                <div class="flng-section-title">Configurations</div>
                                <table class="flng-results-table">
                                    <tr>
                                        <th>System</th>
                                        <th>Config</th>
                                    </tr>
                                    <tr>
                                        <td>MR casings</td>
                                        <td><span id="flng-v_conf_mr" class="mono">-</span></td>
                                    </tr>
                                    <tr>
                                        <td>C3 casings</td>
                                        <td><span id="flng-v_conf_c3" class="mono">-</span></td>
                                    </tr>
                                    <tr>
                                        <td>FG compressor</td>
                                        <td><span id="flng-v_conf_fg" class="mono">-</span></td>
                                    </tr>
                                    <tr>
                                        <td>BOG compressor</td>
                                        <td><span id="flng-v_conf_bog" class="mono">-</span></td>
                                    </tr>
                                    <tr>
                                        <td>Cold box / MCHE</td>
                                        <td><span id="flng-v_conf_mche" class="mono">-</span></td>
                                    </tr>
                                </table>

                                <div class="flng-section-title">Utilities</div>
                                <table class="flng-results-table">
                                    <tr>
                                        <th>Utility</th>
                                        <th>Value</th>
                                    </tr>
                                    <tr>
                                        <td>CW flow (MCHE)</td>
                                        <td><span id="flng-v_cw" class="mono">-</span> mÂ³/h</td>
                                    </tr>
                                    <tr>
                                        <td>Hot oil duty (overall)</td>
                                        <td><span id="flng-v_ho" class="mono">-</span> MW</td>
                                    </tr>
                                    <tr>
                                        <td>Inst. Air â€” MR/C3</td>
                                        <td><span id="flng-v_ia_mr" class="mono">-</span> NmÂ³/h</td>
                                    </tr>
                                    <tr>
                                        <td>Inst. Air â€” FG</td>
                                        <td><span id="flng-v_ia_fg" class="mono">-</span> NmÂ³/h</td>
                                    </tr>
                                    <tr>
                                        <td>Inst. Air â€” BOG</td>
                                        <td><span id="flng-v_ia_bog" class="mono">-</span> NmÂ³/h</td>
                                    </tr>
                                    <tr>
                                        <td>Nâ‚‚ consumption (overall)</td>
                                        <td><span id="flng-v_n2" class="mono">-</span> NmÂ³/h</td>
                                    </tr>
                                    <tr>
                                        <td>Flare (design purge)</td>
                                        <td><span id="flng-v_flare" class="mono">-</span> t/h</td>
                                    </tr>
                                </table>
                            </div>
                        </div>

                        <!-- Chart Section -->
                        <div class="flng-process-panel chart-section">
                            <h3>Trends vs Capacity</h3>
                            <div class="flng-process-chart-container">
                                <canvas id="flng-process-trend" height="240"></canvas>
                            </div>
                            <div class="flng-note" style="margin-top: 18px; color:var(--gold); font-weight:600;">
                                For each compressor sizing and its rating details, please use the respective
                                <u>compressor sizing</u> application in this website modules.
                            </div>
                        </div>
                    </div>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="process-2" data-main="process">
                <h2>LNG Storage Process</h2>
                <div class="sub-page-content">
                    <p>Analysis of LNG storage processes including cryogenic storage, vaporization, and re-liquefaction.
                    </p>
                    <div class="form-group">
                        <label>Storage Temperature (Â°C):</label>
                        <input type="number" placeholder="-162">
                    </div>
                    <div class="form-group">
                        <label>Vaporization Rate (mÂ³/h):</label>
                        <input type="number" placeholder="500">
                    </div>
                    <button class="btn btn-primary">Analyze Storage</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="process-3" data-main="process">
                <h2>LNG Offloading Process</h2>
                <div class="sub-page-content">
                    <p>Analysis of LNG offloading processes including ship-to-shore transfer, loading/unloading
                        operations, and safety protocols.</p>
                    <div class="form-group">
                        <label>Transfer Rate (mÂ³/h):</label>
                        <input type="number" placeholder="1000">
                    </div>
                    <div class="form-group">
                        <label>Offloading Duration (hours):</label>
                        <input type="number" placeholder="24">
                    </div>
                    <button class="btn btn-primary">Analyze Offloading</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="process-4" data-main="process">
                <h2>LNG Quality Control</h2>
                <div class="sub-page-content">
                    <p>Quality control processes for LNG including composition analysis, purity testing, and compliance
                        checks.</p>
                    <div class="form-group">
                        <label>Methane Content (%):</label>
                        <input type="number" step="0.1" placeholder="97">
                    </div>
                    <div class="form-group">
                        <label>Impurities (%):</label>
                        <input type="number" step="0.01" placeholder="0.03">
                    </div>
                    <button class="btn btn-primary">Check Quality</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="process-5" data-main="process">
                <h2>LNG Safety Management</h2>
                <div class="sub-page-content">
                    <p>Safety management processes for LNG including hazard identification, risk assessment, and
                        emergency response planning.</p>
                    <div class="result-card">
                        <h3>Safety Status</h3>
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">Hazard Level</div>
                            <div class="offloading-result-value">Low</div>
                        </div>
                    </div>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <!-- Piping Analysis Sub-pages -->
            <div class="sub-page" id="piping-1" data-main="piping">
                <h2>Piping Design</h2>
                <div class="sub-page-content">
                    <p>Design and analysis of piping systems including material selection, pressure ratings, and thermal
                        expansion considerations.</p>
                    <div class="form-group">
                        <label>Pipe Material:</label>
                        <select>
                            <option>Carbon Steel</option>
                            <option>Stainless Steel</option>
                            <option>Aluminum</option>
                            <option>Copper</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Pressure Rating (bar):</label>
                        <input type="number" placeholder="200">
                    </div>
                    <button class="btn btn-primary">Design Piping</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="piping-2" data-main="piping">
                <h2>Stress Analysis</h2>
                <div class="sub-page-content">
                    <p>Stress analysis of piping systems under various operating conditions including internal pressure,
                        external loads, and thermal stresses.</p>
                    <div class="form-group">
                        <label>Internal Pressure (bar):</label>
                        <input type="number" placeholder="150">
                    </div>
                    <div class="form-group">
                        <label>External Load (kN):</label>
                        <input type="number" placeholder="100">
                    </div>
                    <button class="btn btn-primary">Analyze Stress</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="piping-3" data-main="piping">
                <h2>Flow Calculations</h2>
                <div class="sub-page-content">
                    <p>Flow calculations for piping systems including pressure drop, velocity, and flow rate
                        determination.</p>
                    <div class="form-group">
                        <label>Flow Rate (mÂ³/h):</label>
                        <input type="number" placeholder="1000">
                    </div>
                    <div class="form-group">
                        <label>Pressure Drop (bar):</label>
                        <input type="number" step="0.1" placeholder="2.5">
                    </div>
                    <button class="btn btn-primary">Calculate Flow</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="piping-4" data-main="piping">
                <h2>Insulation Design</h2>
                <div class="sub-page-content">
                    <p>Insulation design for cryogenic piping systems including thermal insulation, vapor barriers, and
                        heat tracing.</p>
                    <div class="form-group">
                        <label>Insulation Material:</label>
                        <select>
                            <option>Mineral Wool</option>
                            <option>Polystyrene</option>
                            <option>Polyurethane</option>
                            <option>Cellulose</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Insulation Thickness (mm):</label>
                        <input type="number" placeholder="50">
                    </div>
                    <button class="btn btn-primary">Design Insulation</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="piping-5" data-main="piping">
                <h2>Corrosion Protection</h2>
                <div class="sub-page-content">
                    <p>Corrosion protection strategies for piping systems including coating, cathodic protection, and
                        material selection.</p>
                    <div class="result-card">
                        <h3>Corrosion Status</h3>
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">Corrosion Level</div>
                            <div class="offloading-result-value">Low</div>
                        </div>
                    </div>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <!-- Structural Analysis Sub-pages -->
            <div class="sub-page" id="structural-1" data-main="structural">
                <h2>Hull Analysis</h2>
                <div class="sub-page-content">
                    <p>Structural analysis of the hull including stress distribution, fatigue life, and buckling
                        assessment.</p>
                    <div class="form-group">
                        <label>Hull Material:</label>
                        <select>
                            <option>Steel</option>
                            <option>Aluminum</option>
                            <option>Composite</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Hull Length (m):</label>
                        <input type="number" placeholder="250">
                    </div>
                    <button class="btn btn-primary">Analyze Hull</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="structural-2" data-main="structural">
                <h2>Turret Analysis</h2>
                <div class="sub-page-content">
                    <p>Structural analysis of the turret including stress distribution, fatigue life, and buckling
                        assessment.</p>
                    <div class="form-group">
                        <label>Turret Material:</label>
                        <select>
                            <option>Steel</option>
                            <option>Aluminum</option>
                            <option>Composite</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Turret Diameter (m):</label>
                        <input type="number" placeholder="10">
                    </div>
                    <button class="btn btn-primary">Analyze Turret</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="structural-3" data-main="structural">
                <h2>Mooring Analysis</h2>
                <div class="sub-page-content">
                    <p>Structural analysis of mooring systems including stress distribution, fatigue life, and buckling
                        assessment.</p>
                    <div class="form-group">
                        <label>Mooring Material:</label>
                        <select>
                            <option>Steel Chain</option>
                            <option>Steel Wire Rope</option>
                            <option>Fiber Optic</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Mooring Length (m):</label>
                        <input type="number" placeholder="1000">
                    </div>
                    <button class="btn btn-primary">Analyze Mooring</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="structural-4" data-main="structural">
                <h2>Deck Analysis</h2>
                <div class="sub-page-content">
                    <p>Structural analysis of the deck including stress distribution, fatigue life, and buckling
                        assessment.</p>
                    <div class="form-group">
                        <label>Deck Material:</label>
                        <select>
                            <option>Steel</option>
                            <option>Aluminum</option>
                            <option>Composite</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Deck Area (mÂ²):</label>
                        <input type="number" placeholder="1000">
                    </div>
                    <button class="btn btn-primary">Analyze Deck</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="structural-5" data-main="structural">
                <h2>Foundation Analysis</h2>
                <div class="sub-page-content">
                    <p>Structural analysis of the foundation including stress distribution, fatigue life, and buckling
                        assessment.</p>
                    <div class="form-group">
                        <label>Foundation Material:</label>
                        <select>
                            <option>Concrete</option>
                            <option>Steel</option>
                            <option>Composite</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Foundation Depth (m):</label>
                        <input type="number" placeholder="10">
                    </div>
                    <button class="btn btn-primary">Analyze Foundation</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <!-- Power Analysis Sub-pages -->
            <div class="sub-page" id="power-1" data-main="power">
                <h2>FLNG Electrical Load Estimator</h2>
                <div class="sub-page-content">
                    <!-- FLNG Electrical Load Estimator UI -->
                    <div class="flng-estimator-container">
                        <div class="flng-grid">
                            <!-- Inputs Section -->
                            <div class="flng-panel">
                                <h3>Inputs</h3>
                                <div class="flng-inputs">
                                    <div class="form-group">
                                        <label for="flng-mtpa">Design Capacity (MTPA)</label>
                                        <input id="flng-mtpa" type="number" min="0.5" max="10" step="0.1" value="2.4" />
                                    </div>
                                    <div class="form-group">
                                        <label for="flng-pf">Power Factor (PF)</label>
                                        <input id="flng-pf" type="number" min="0.50" max="1.00" step="0.001"
                                            value="0.895" />
                                    </div>
                                    <div class="form-group">
                                        <label for="flng-scenario">Scenario</label>
                                        <select id="flng-scenario">
                                            <option>Normal</option>
                                            <option>Normal+Offloading</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="flng-driver">Driver Type</label>
                                        <select id="flng-driver">
                                            <option>Aux-Only</option>
                                            <option>E-Drive</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="flng-growth">Future Growth (%)</label>
                                        <input id="flng-growth" type="number" min="0" max="50" step="1" value="15" />
                                    </div>
                                    <div class="form-group">
                                        <label for="flng-reserve">Spinning Reserve (%)</label>
                                        <input id="flng-reserve" type="number" min="0" max="50" step="1" value="10" />
                                    </div>
                                    <div class="form-group">
                                        <label for="flng-nplus1">N+1 Redundancy</label>
                                        <input id="flng-nplus1" type="checkbox" checked />
                                    </div>
                                    <div class="form-group">
                                        <label for="flng-plotMetric">Plot Metric</label>
                                        <select id="flng-plotMetric">
                                            <option>kW</option>
                                            <option>kVA</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="flng-mtpaMin">MTPA Min (Trend)</label>
                                        <input id="flng-mtpaMin" type="number" min="0" max="10" step="0.1"
                                            value="1.0" />
                                    </div>
                                    <div class="form-group">
                                        <label for="flng-mtpaMax">MTPA Max (Trend)</label>
                                        <input id="flng-mtpaMax" type="number" min="0.1" max="10" step="0.1"
                                            value="3.0" />
                                    </div>
                                    <div class="form-group">
                                        <label for="flng-unitA">Option A Unit kWe (LM2500-class)</label>
                                        <input id="flng-unitA" type="number" min="1000" step="1" value="19007" />
                                    </div>
                                    <div class="form-group">
                                        <label for="flng-unitB">Option B Unit kWe (Titan 250)</label>
                                        <input id="flng-unitB" type="number" min="1000" step="1" value="18211" />
                                    </div>
                                    <div class="form-group">
                                        <label for="flng-unitC">Option C Unit kWe (LM6000PF)</label>
                                        <input id="flng-unitC" type="number" min="1000" step="1" value="35104" />
                                    </div>
                                    <div class="form-group">
                                        <label for="flng-unitD">Option D Unit kWe (SGT-750)</label>
                                        <input id="flng-unitD" type="number" min="1000" step="1" value="34873" />
                                    </div>
                                    <div class="form-group">
                                        <label for="flng-unitE">Option E Unit kWe (Titan 350)</label>
                                        <input id="flng-unitE" type="number" min="1000" step="1" value="31671" />
                                    </div>
                                </div>

                                <div class="flng-coefficients">
                                    <h4>Model Coefficients (from your load analyses)</h4>
                                    <div class="flng-chips">
                                        <span class="flng-chip">Aux Normal: kW = <span id="flng-coefANa">-</span> +
                                            <span id="flng-coefANb">-</span> Ã— MTPA</span>
                                        <span class="flng-chip">Aux Offload: kW = <span id="flng-coefAOa">-</span> +
                                            <span id="flng-coefAOb">-</span> Ã— MTPA</span>
                                        <span class="flng-chip">E-Drive Normal: <span id="flng-coefEN">-</span>
                                            kW/MTPA</span>
                                        <span class="flng-chip">E-Drive Offload: <span id="flng-coefEO">-</span>
                                            kW/MTPA</span>
                                    </div>
                                </div>

                                <div class="flng-kpis">
                                    <div class="flng-kpi">
                                        <div class="kpi-label">Base Running Load</div>
                                        <div class="kpi-value" id="flng-kWbase">â€“</div>
                                        <div class="kpi-unit">kW (before margins)</div>
                                    </div>
                                    <div class="flng-kpi">
                                        <div class="kpi-label">Required Capacity</div>
                                        <div class="kpi-value" id="flng-kVAreq">â€“</div>
                                        <div class="kpi-unit">kVA (with margins)</div>
                                    </div>
                                    <div class="flng-kpi">
                                        <div class="kpi-label">PF / Margins</div>
                                        <div class="kpi-value" id="flng-pfmarg">â€“</div>
                                        <div class="kpi-unit">PF | Growth% | Reserve%</div>
                                    </div>
                                </div>

                                <button id="flng-calculate-btn" class="btn btn-primary">Calculate Electrical
                                    Load</button>
                            </div>

                            <!-- Chart Section -->
                            <div class="flng-panel">
                                <h3>Trend: Estimated Electrical Load vs MTPA</h3>
                                <div class="flng-legend">
                                    <span><span class="legend-box" style="background:#5ac8fa"></span> Aux-Only â€”
                                        Normal</span>
                                    <span><span class="legend-box" style="background:#a3ffb0"></span> Aux-Only â€”
                                        Normal+Offloading</span>
                                    <span><span class="legend-box" style="background:#ffd166"></span> E-Drive â€”
                                        Normal</span>
                                    <span><span class="legend-box" style="background:#ff6b6b"></span> E-Drive â€”
                                        Normal+Offloading</span>
                                    <span><span class="legend-box" style="background:#cccccc"></span> Your Design
                                        Point</span>
                                </div>
                                <div class="flng-chart-container">
                                    <canvas id="flng-trend"></canvas>
                                </div>
                                <div class="flng-note">Plot switches between <b>kW</b> and <b>kVA</b>. Changing PF
                                    affects kVA lines immediately.</div>
                                <div class="flng-note-warn">MRC electrical rating is not included as it is GT driven.
                                </div>
                            </div>
                        </div>

                        <!-- Generator Sizing Section -->
                        <div class="flng-panel flng-full-width">
                            <h3>Generator Sizing (with margins & N+1)</h3>
                            <div class="flng-note-warn">Note: ratings assume <b>30Â°C</b> ambient. Use <b>turbine sizing
                                    analysis</b> for other ambients.</div>

                            <div class="flng-generator-grid">
                                <div class="flng-generator-option">
                                    <h4>Option A â€” LM2500-class</h4>
                                    <table class="flng-table">
                                        <tbody>
                                            <tr>
                                                <th>Unit kWe</th>
                                                <td id="flng-A_unit">â€“</td>
                                            </tr>
                                            <tr>
                                                <th>Running Sets</th>
                                                <td id="flng-A_run">â€“</td>
                                            </tr>
                                            <tr>
                                                <th>Total Sets (N+1)</th>
                                                <td id="flng-A_total">â€“</td>
                                            </tr>
                                            <tr>
                                                <th>Loading per Running Set</th>
                                                <td id="flng-A_load">â€“</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="flng-generator-option">
                                    <h4>Option B â€” Titan 250</h4>
                                    <table class="flng-table">
                                        <tbody>
                                            <tr>
                                                <th>Unit kWe</th>
                                                <td id="flng-B_unit">â€“</td>
                                            </tr>
                                            <tr>
                                                <th>Running Sets</th>
                                                <td id="flng-B_run">â€“</td>
                                            </tr>
                                            <tr>
                                                <th>Total Sets (N+1)</th>
                                                <td id="flng-B_total">â€“</td>
                                            </tr>
                                            <tr>
                                                <th>Loading per Running Set</th>
                                                <td id="flng-B_load">â€“</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="flng-generator-option">
                                    <h4>Option C â€” LM6000PF</h4>
                                    <table class="flng-table">
                                        <tbody>
                                            <tr>
                                                <th>Unit kWe</th>
                                                <td id="flng-C_unit">â€“</td>
                                            </tr>
                                            <tr>
                                                <th>Running Sets</th>
                                                <td id="flng-C_run">â€“</td>
                                            </tr>
                                            <tr>
                                                <th>Total Sets (N+1)</th>
                                                <td id="flng-C_total">â€“</td>
                                            </tr>
                                            <tr>
                                                <th>Loading per Running Set</th>
                                                <td id="flng-C_load">â€“</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="flng-generator-option">
                                    <h4>Option D â€” SGT-750</h4>
                                    <table class="flng-table">
                                        <tbody>
                                            <tr>
                                                <th>Unit kWe</th>
                                                <td id="flng-D_unit">â€“</td>
                                            </tr>
                                            <tr>
                                                <th>Running Sets</th>
                                                <td id="flng-D_run">â€“</td>
                                            </tr>
                                            <tr>
                                                <th>Total Sets (N+1)</th>
                                                <td id="flng-D_total">â€“</td>
                                            </tr>
                                            <tr>
                                                <th>Loading per Running Set</th>
                                                <td id="flng-D_load">â€“</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="flng-generator-option">
                                    <h4>Option E â€” Titan 350</h4>
                                    <table class="flng-table">
                                        <tbody>
                                            <tr>
                                                <th>Unit kWe</th>
                                                <td id="flng-E_unit">â€“</td>
                                            </tr>
                                            <tr>
                                                <th>Running Sets</th>
                                                <td id="flng-E_run">â€“</td>
                                            </tr>
                                            <tr>
                                                <th>Total Sets (N+1)</th>
                                                <td id="flng-E_total">â€“</td>
                                            </tr>
                                            <tr>
                                                <th>Loading per Running Set</th>
                                                <td id="flng-E_load">â€“</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="power-2" data-main="power">
                <h2>Power Generation Optimization</h2>
                <div class="sub-page-content">
                    <p>Optimization of power generation systems including turbine selection, generator sizing, and
                        efficiency improvement.</p>
                    <div class="form-group">
                        <label>Turbine Type:</label>
                        <select>
                            <option>Gas Turbine</option>
                            <option>Steam Turbine</option>
                            <option>Combined Cycle</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Generator Capacity (kW):</label>
                        <input type="number" placeholder="2000">
                    </div>
                    <button class="btn btn-primary">Optimize Generation</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="power-3" data-main="power">
                <h2>Energy Management Systems</h2>
                <div class="sub-page-content">
                    <p>Design and analysis of energy management systems including power distribution, energy storage,
                        and demand response.</p>
                    <div class="form-group">
                        <label>Energy Storage Capacity (kWh):</label>
                        <input type="number" placeholder="1000">
                    </div>
                    <div class="form-group">
                        <label>Power Distribution (kW):</label>
                        <input type="number" placeholder="1500">
                    </div>
                    <button class="btn btn-primary">Design Energy Management</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="power-4" data-main="power">
                <h2>Power Quality Improvement</h2>
                <div class="sub-page-content">
                    <p>Improvement of power quality including harmonic reduction, voltage regulation, and power factor
                        correction.</p>
                    <div class="form-group">
                        <label>Harmonic Content (%):</label>
                        <input type="number" step="0.1" placeholder="5">
                    </div>
                    <div class="form-group">
                        <label>Power Factor:</label>
                        <input type="number" step="0.01" placeholder="0.95">
                    </div>
                    <button class="btn btn-primary">Improve Power Quality</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="power-5" data-main="power">
                <h2>Power System Reliability</h2>
                <div class="sub-page-content">
                    <p>Analysis of power system reliability including fault analysis, redundancy design, and maintenance
                        planning.</p>
                    <div class="result-card">
                        <h3>Reliability Status</h3>
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">Reliability Level</div>
                            <div class="offloading-result-value">High</div>
                        </div>
                    </div>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <!-- Project Management Sub-pages -->
            <div class="sub-page" id="project-1" data-main="project">
                <h2>Project Planning</h2>
                <div class="sub-page-content">
                    <p>Comprehensive project planning including scope definition, schedule development, and resource
                        allocation.</p>
                    <div class="form-group">
                        <label>Project Scope:</label>
                        <textarea placeholder="Enter project scope details"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Project Duration (months):</label>
                        <input type="number" placeholder="12">
                    </div>
                    <button class="btn btn-primary">Plan Project</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="project-2" data-main="project">
                <h2>Project Scheduling</h2>
                <div class="sub-page-content">
                    <p>Project scheduling including critical path analysis, resource leveling, and risk management.</p>
                    <div class="form-group">
                        <label>Start Date:</label>
                        <input type="date">
                    </div>
                    <div class="form-group">
                        <label>End Date:</label>
                        <input type="date">
                    </div>
                    <button class="btn btn-primary">Schedule Project</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="project-3" data-main="project">
                <h2>Resource Management</h2>
                <div class="sub-page-content">
                    <p>Resource management including labor allocation, equipment scheduling, and material procurement.
                    </p>
                    <div class="form-group">
                        <label>Number of Workers:</label>
                        <input type="number" placeholder="50">
                    </div>
                    <div class="form-group">
                        <label>Equipment List:</label>
                        <textarea placeholder="Enter equipment list"></textarea>
                    </div>
                    <button class="btn btn-primary">Manage Resources</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="project-4" data-main="project">
                <h2>Progress Tracking</h2>
                <div class="sub-page-content">
                    <p>Progress tracking including milestone achievement, cost control, and schedule adherence.</p>
                    <div class="form-group">
                        <label>Current Milestone:</label>
                        <input type="text" placeholder="Milestone 1">
                    </div>
                    <div class="form-group">
                        <label>Cost Spent (USD):</label>
                        <input type="number" placeholder="100000">
                    </div>
                    <button class="btn btn-primary">Track Progress</button>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <div class="sub-page" id="project-5" data-main="project">
                <h2>Quality Assurance</h2>
                <div class="sub-page-content">
                    <p>Quality assurance processes including inspection, testing, and documentation.</p>
                    <div class="result-card">
                        <h3>Quality Status</h3>
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">Quality Level</div>
                            <div class="offloading-result-value">High</div>
                        </div>
                    </div>
                </div>
                <button class="return-btn" onclick="returnToMain()">Return to Murphy's Curves Main Page</button>
            </div>

            <!-- Continue with all other sub-pages for process, piping, structural, power, and project tabs -->
            <!-- Each following the same pattern: <main-tab>-<number> for the ID -->

        </div>
    </section>

    <!-- Calculations Section -->
    <section class="calculations" id="calculations">
        <div class="container">

            <div class="section-title">
                <h2>Engineering Calculations</h2>
                <p>Experience the precision of Murphy's Curves with our industry-leading calculation modules</p>
            </div>
            <div class="calc-tabs">
                <div class="calc-tab active">Mooring Analysis</div>
                <div class="calc-tab">LNG Boil-off</div>
                <div class="calc-tab">Tank Sloshing</div>
                <div class="calc-tab">Process Cooling</div>
                <div class="calc-tab">Structural Stress</div>
            </div>
            <div class="calc-content">
                <div class="mooring-grid"
                    style="display: grid; grid-template-columns: repeat(3, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div class="mooring-card"
                        style="background: rgba(5, 25, 35, 0.7); border: 1px solid rgba(46, 139, 192, 0.3); border-radius: 8px; padding: 25px; border-left: 4px solid var(--gold);">
                        <h3
                            style="color: var(--gold); margin-bottom: 20px; font-family: 'Rajdhani', sans-serif; text-transform: uppercase; letter-spacing: 1px;">
                            Environment & Vessel</h3>
                        <div class="form-group">
                            <label for="depth">Water depth, h (m)</label>
                            <input type="number" id="depth" step="1" value="1500">
                        </div>
                        <div class="form-group">
                            <label for="disp">Vessel displacement, Î” (tonnes)</label>
                            <input type="number" id="disp" step="1000" value="285000">
                        </div>
                        <div class="form-group">
                            <label for="loa">Length overall, LOA (m)</label>
                            <input type="number" id="loa" step="0.1" value="380">
                        </div>
                        <div class="form-group">
                            <label for="beam">Beam, B (m)</label>
                            <input type="number" id="beam" step="0.1" value="65">
                        </div>
                        <div class="form-group">
                            <label for="draft">Draft, T (m)</label>
                            <input type="number" id="draft" step="0.1" value="14.5">
                        </div>
                        <div class="form-group">
                            <label for="current">Current speed, U (knots)</label>
                            <input type="number" id="current" step="0.1" value="3.2">
                        </div>
                        <div class="form-group">
                            <label for="hs">Significant wave height, Hs (m)</label>
                            <input type="number" id="hs" step="0.1" value="5.8">
                        </div>
                        <div class="form-group">
                            <label for="tp">Peak period, Tp (s)</label>
                            <input type="number" id="tp" step="0.1" value="12">
                        </div>
                        <div class="form-group">
                            <label for="wind">10-m wind speed, Vw (m/s) <small style="opacity: 0.7;">(0 to
                                    ignore)</small></label>
                            <input type="number" id="wind" step="0.1" value="25">
                        </div>
                        <div class="form-group">
                            <label for="awind">Windage area above water, Awind (mÂ²) <small style="opacity: 0.7;">(blank
                                    = auto)</small></label>
                            <input type="number" id="awind" step="1" placeholder="auto">
                        </div>
                    </div>

                    <div class="mooring-card"
                        style="background: rgba(5, 25, 35, 0.7); border: 1px solid rgba(46, 139, 192, 0.3); border-radius: 8px; padding: 25px; border-left: 4px solid var(--gold);">
                        <h3
                            style="color: var(--gold); margin-bottom: 20px; font-family: 'Rajdhani', sans-serif; text-transform: uppercase; letter-spacing: 1px;">
                            Mooring Layout & Line</h3>
                        <div class="form-group">
                            <label for="system">Mooring system</label>
                            <select id="system">
                                <option>Turret Mooring</option>
                                <option>Spread Mooring</option>
                                <option>Internal Turret</option>
                                <option>External Turret</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="nlines">Total number of lines, N</label>
                            <input type="number" id="nlines" step="1" value="12">
                        </div>
                        <div class="form-group">
                            <label for="sf">Safety factor on line tension, SF</label>
                            <input type="number" id="sf" step="0.05" value="1.75">
                        </div>
                        <div class="form-group">
                            <label for="material">Line material</label>
                            <select id="material">
                                <option>Chain</option>
                                <option>Wire Rope</option>
                                <option>Synthetic Fiber</option>
                                <option>Hybrid</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="diam">Line diameter (mm)</label>
                            <input type="number" id="diam" step="1" value="120">
                        </div>
                        <div class="form-group">
                            <label for="lineLen">Line length per leg, L (m)</label>
                            <input type="number" id="lineLen" step="1" value="1800">
                        </div>
                        <div class="form-group">
                            <label for="pret">Pretension per line, Pâ‚€ (kN)</label>
                            <input type="number" id="pret" step="1" value="400">
                        </div>
                        <div class="form-group">
                            <label for="theta">Fairlead horizontal angle, Î¸ (deg) <small style="opacity: 0.7;">(to
                                    seabed)</small></label>
                            <input type="number" id="theta" step="0.1" value="10">
                        </div>
                    </div>

                    <div class="mooring-card"
                        style="background: rgba(5, 25, 35, 0.7); border: 1px solid rgba(46, 139, 192, 0.3); border-radius: 8px; padding: 25px; border-left: 4px solid var(--gold);">
                        <h3
                            style="color: var(--gold); margin-bottom: 20px; font-family: 'Rajdhani', sans-serif; text-transform: uppercase; letter-spacing: 1px;">
                            Motion Inputs (Design Sea State)</h3>
                        <small style="opacity: 0.8; display: block; margin-bottom: 15px;">Peak/significant motions used
                            to estimate dynamic increment on top of static environmental load.</small>
                        <div class="form-group">
                            <label for="surge">Surge amplitude, x<sub>surge</sub> (m)</label>
                            <input type="number" id="surge" step="0.1" value="8">
                        </div>
                        <div class="form-group">
                            <label for="sway">Sway amplitude, y<sub>sway</sub> (m)</label>
                            <input type="number" id="sway" step="0.1" value="4">
                        </div>
                        <div class="form-group">
                            <label for="yaw">Yaw amplitude, Ïˆ (deg)</label>
                            <input type="number" id="yaw" step="0.1" value="5">
                        </div>
                        <div class="form-group">
                            <label for="yawArm">Yaw lever arm to line, R<sub>yaw</sub> (m) <small
                                    style="opacity: 0.7;">(~B/2 spread; turret radius for turret)</small></label>
                            <input type="number" id="yawArm" step="0.1" value="32.5">
                        </div>
                        <div class="form-group">
                            <label for="daf">Dynamic amplification factor (DAF) <small style="opacity: 0.7;">(peak/rms;
                                    1.3â€“1.8 typical)</small></label>
                            <input type="number" id="daf" step="0.05" value="1.5">
                        </div>
                    </div>
                </div>

                <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap; margin-bottom: 20px;">
                    <button class="btn btn-primary" id="btnCalc"
                        style="padding: 18px 30px; font-size: 1.1rem;">Calculate Mooring Loads</button>
                    <button class="btn btn-outline" id="btnTests" style="padding: 18px 30px; font-size: 1.1rem;">Run
                        Quick Tests</button>
                    <small style="opacity: 0.7;">Concept/FEED screening only. Adjust coefficients below to match house
                        rules / class guidance.</small>
                </div>

                <div
                    style="display: grid; grid-template-columns: repeat(2, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div class="calc-result">
                        <h3>Mooring Analysis Results</h3>
                        <div id="out"
                            style="font-family: ui-monospace, Consolas, monospace; white-space: pre-wrap; background: rgba(5, 25, 35, 0.8); border-radius: 8px; padding: 20px; font-size: 0.9rem;">
                            â€”</div>
                    </div>
                    <div class="calc-result">
                        <h3>Recommendation</h3>
                        <div id="rec"
                            style="font-family: ui-monospace, Consolas, monospace; white-space: pre-wrap; background: rgba(5, 25, 35, 0.8); border-radius: 8px; padding: 20px; font-size: 0.9rem;">
                            â€”</div>
                    </div>
                </div>

                <div class="calc-result" style="margin-bottom: 30px;">
                    <h3>Whatâ€‘if Panel (Quick Sensitivity)</h3>
                    <small style="opacity: 0.8; display: block; margin-bottom: 15px;">Adjust d, N, SF and see peak
                        utilization & recommendation without changing the main inputs. Click "Apply" to push them into
                        the inputs.</small>
                    <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                        <div style="flex: 1;">
                            <label style="display: block; margin-bottom: 8px;">Line diameter d (mm)</label>
                            <input id="wi_diam" type="range" min="60" max="200" step="2" value="120"
                                style="width: 100%;">
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; margin-bottom: 8px;">Lines N</label>
                            <input id="wi_lines" type="range" min="6" max="24" step="1" value="12" style="width: 100%;">
                        </div>
                        <div style="flex: 1;">
                            <label style="display: block; margin-bottom: 8px;">Safety factor SF</label>
                            <input id="wi_sf" type="range" min="1.20" max="2.20" step="0.05" value="1.75"
                                style="width: 100%;">
                        </div>
                    </div>
                    <div id="wi_out"
                        style="font-family: ui-monospace, Consolas, monospace; white-space: pre-wrap; background: rgba(5, 25, 35, 0.8); border-radius: 8px; padding: 15px; margin-bottom: 15px; font-size: 0.9rem;">
                        Move the slidersâ€¦</div>
                    <div style="display: flex; gap: 15px;">
                        <button class="btn btn-primary" id="btnApplyWI">Apply these to inputs</button>
                        <button class="btn btn-outline" id="btnResetWI">Reset to inputs</button>
                    </div>
                </div>

                <div class="calc-result" style="margin-bottom: 30px;">
                    <h3>Diagnostics / Tests</h3>
                    <div id="tests"
                        style="font-family: ui-monospace, Consolas, monospace; white-space: pre-wrap; background: rgba(5, 25, 35, 0.8); border-radius: 8px; padding: 15px; font-size: 0.9rem;">
                        Click "Run Quick Tests".</div>
                </div>

                <div class="calc-result">
                    <h3>About This Calculator</h3>
                    <small style="line-height: 1.6;">
                        This is a professional mooring analysis calculator utilizing proprietary algorithms.<br>
                        All calculations are performed server-side using Murphy's Curves proprietary formulas.<br>
                        <b>Security Notice</b>: No calculation formulas are exposed in the frontend for IP
                        protection.<br>
                        Results include environmental loads, mooring distribution, static vs peak analysis,<br>
                        utilization factors, offset calculations, and fatigue assessment.<br>
                        All calculations comply with industry standards including API RP 2SK and ISO 19901-7.
                    </small>
                </div>
            </div>
        </div>
    </section>

    <!-- Offloading Section -->
    <section class="offloading" id="offloading">
        <div class="container">

            <div class="section-title">
                <h2>FLNG Offloading Calculations</h2>
                <p>Precision calculations for LNG transfer operations based on Murphy's Curves proprietary algorithms
                </p>
            </div>

            <!-- Acknowledge Disclaimer Checkbox -->
            <div class="acknowledge-container">
                <div class="acknowledge-checkbox">
                    <input type="checkbox" id="acknowledgeDisclaimer" name="acknowledgeDisclaimer">
                    <label for="acknowledgeDisclaimer">
                        By proceeding, I confirm I have read and accept the <strong>Website Disclaimer</strong>,
                        understand that outputs are illustrative only, and will obtain independent professional
                        verification and supervisor approval before any design, procurement, or operational use.
                    </label>
                </div>
            </div>
            <div class="offloading-container">
                <div class="offloading-input">
                    <h2
                        style="color: var(--gold); font-family: 'Rajdhani'; margin-bottom: 30px; text-transform: uppercase; letter-spacing: 1.5px;">
                        <i class="fas fa-sliders-h"></i> Input Parameters
                    </h2>
                    <div class="form-group"><label for="target">Target Production (mmtpa)</label><input type="number"
                            id="target" value="2.7" step="0.1"></div>
                    <div class="form-group"><label for="availability">Availability Factor</label><input type="number"
                            id="availability" value="0.92" step="0.01" min="0.8" max="1"></div>
                    <div class="form-group"><label for="tankSize">Total LNG Cargo Tank Size (mÂ³)</label><input
                            type="number" id="tankSize" value="225000"></div>
                    <div class="form-group"><label for="numTanks">Number of Tanks</label><input type="number"
                            id="numTanks" value="5"></div>
                    <div class="form-group"><label for="lngDensity">LNG Density (kg/mÂ³)</label><input type="number"
                            id="lngDensity" value="443"></div>
                    <div class="form-group"><label for="offloadingRate">Offloading Rate (mÂ³/hr)</label><input
                            type="number" id="offloadingRate" value="12000"></div>
                    <div class="form-group"><label for="pumpsPerTank">Number of Pumps per Tank</label><input
                            type="number" id="pumpsPerTank" value="2"></div>
                    <button class="btn btn-primary" id="calculateBtn"
                        style="width: 100%; padding: 16px; margin-top: 20px;">Calculate Offloading Parameters</button>
                    <button class="btn" id="debugBtn"
                        style="width: 100%; padding: 8px; margin-top: 15px; font-size: 0.8rem; background: #6c757d; color: white;">Calculate
                        Offloading Time Analysis</button>
                </div>
                <div class="offloading-results">
                    <h2
                        style="color: var(--gold); font-family: 'Rajdhani'; margin-bottom: 30px; text-transform: uppercase; letter-spacing: 1.5px;">
                        <i class="fas fa-chart-bar"></i> Calculation Results
                    </h2>
                    <div class="result-card">
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">Annual Operating Days</div>
                            <div class="offloading-result-value" id="annualDays">â€”</div>
                        </div>
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">Annual LNG Production (Tonnes)</div>
                            <div class="offloading-result-value" id="annualProduction">â€”</div>
                        </div>
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">LNG Volume per Year (mÂ³)</div>
                            <div class="offloading-result-value" id="lngVolume">â€”</div>
                        </div>
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">Inventory Turns per Year</div>
                            <div class="offloading-result-value" id="inventoryTurns">â€”</div>
                        </div>
                    </div>
                    <div class="result-card">
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">Tank Pumping Rate (mÂ³/hr)</div>
                            <div class="offloading-result-value" id="tankPumpRate">â€”</div>
                        </div>
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">Pump Rate per Tank (mÂ³/hr)</div>
                            <div class="offloading-result-value" id="pumpRate">â€”</div>
                        </div>
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">Pump Rate per Tank (mÂ³/day)</div>
                            <div class="offloading-result-value" id="pumpRateDay">â€”</div>
                        </div>
                    </div>
                    <div class="result-card">
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">Feed Gas Flowrate (SmÂ³/hr)</div>
                            <div class="offloading-result-value" id="feedGasFlowrate">â€”</div>
                        </div>
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">Feed Gas Flowrate (mmscfd)</div>
                            <div class="offloading-result-value" id="feedGasFlowratemmscfd">â€”</div>
                        </div>
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">LNG Production Rate (mÂ³/day)</div>
                            <div class="offloading-result-value" id="lngProductionRate">â€”</div>
                        </div>
                        <div class="offloading-result-row">
                            <div class="offloading-result-label">LNG Production Rate (kg/day)</div>
                            <div class="offloading-result-value" id="lngProductionRateKg">â€”</div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="offloadingChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <h2
                    style="color: var(--gold); font-family: 'Rajdhani'; margin: 50px 0 20px; text-transform: uppercase; letter-spacing: 1.5px;">
                    <i class="fas fa-table"></i> Offloading Time Analysis
                </h2>
                <table class="results-table">
                    <thead>
                        <tr>
                            <th>Carrier Size (mÂ³)</th>
                            <th>Full Operation (hr)</th>
                            <th>1 Pump Failure (hr)</th>
                            <th>2 Pump Failure (hr)</th>
                        </tr>
                    </thead>
                    <tbody id="offloadingTableBody">
                        <tr>
                            <td>180,000</td>
                            <td><span class="loading-indicator">Calculating...</span></td>
                            <td><span class="loading-indicator">Calculating...</span></td>
                            <td><span class="loading-indicator">Calculating...</span></td>
                        </tr>
                        <tr>
                            <td>225,000</td>
                            <td><span class="loading-indicator">Calculating...</span></td>
                            <td><span class="loading-indicator">Calculating...</span></td>
                            <td><span class="loading-indicator">Calculating...</span></td>
                        </tr>
                        <tr>
                            <td>265,000</td>
                            <td><span class="loading-indicator">Calculating...</span></td>
                            <td><span class="loading-indicator">Calculating...</span></td>
                            <td><span class="loading-indicator">Calculating...</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <div class="logo" style="margin-bottom: 25px;">
                        <div class="logo-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="logo-text">MURPHY'S CURVES<span>FLNG ENGINEERING SUITE</span></div>
                    </div>
                    <p>Premium engineering solutions for the global FLNG industry. Precision calculations for demanding
                        offshore environments.</p>
                </div>
                <div class="footer-col">
                    <h3>Calculations</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-chevron-right"></i>Hydrodynamics</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i>Structural Analysis</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i>Offloading Systems</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i>Process Systems</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i>Safety Systems</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Resources</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-chevron-right"></i>Documentation</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i>API Integration</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i>Training Programs</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i>Industry Reports</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i>Technical Support</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h3>Enterprise</h3>
                    <ul class="footer-links">
                        <li><a href="#"><i class="fas fa-chevron-right"></i>Corporate Solutions</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i>Consulting Services</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i>Custom Development</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i>Security</a></li>
                        <li><a href="#"><i class="fas fa-chevron-right"></i>Compliance</a></li>
                    </ul>
                </div>
            </div>
            <div class="copyright">
                &copy; 2025 Murphy's Curves FLNG Engineering Suite. All rights reserved. | Premium Engineering Solutions
            </div>
        </div>
    </footer>

    <!-- Auth Modal (unchanged UI placeholder) -->
    <div class="modal" id="authModal" style="display:none"></div>

    <!-- Disclaimer Modal -->
    <div class="disclaimer-modal" id="disclaimerModal">
        <div class="disclaimer-modal-content">
            <div class="disclaimer-modal-header">
                <h2>ðŸ“œ Website Disclaimer</h2>
                <button class="disclaimer-modal-close" id="disclaimerModalClose">&times;</button>
            </div>
            <div class="disclaimer-modal-body">
                <p><strong>Website:</strong> murphycurves.com ("Website")<br>
                    <strong>Owner/Operator:</strong> Murphycurves ("we," "us," or "our")<br>
                    <strong>Last updated:</strong> September 20, 2025
                </p>

                <h3>1) Purpose: Informational & Promotional Only</h3>
                <p>The Website and its contentâ€”including text, charts, calculators, tools, examples, downloadable
                    materials, and any generated outputs (collectively, "Content")â€”are provided solely for general
                    informational and promotional purposes to assist engineers and small EPC companies in understanding
                    concepts relevant to the conceptual and FEED stages of projects.</p>
                <p><strong>The Content is not professional engineering, legal, financial, safety, or other professional
                        advice, and must not be relied upon as such.</strong></p>

                <h3>2) No Professional Relationship or Engineering Services</h3>
                <p>Your use of the Website does not create a client, consulting, fiduciary, or professional relationship
                    with us. We do not offer, and the Website does not provide, licensed professional engineering
                    services, design approvals, safety certifications, or professional "seals"/stamps.</p>

                <h3>3) User Responsibilities & Mandatory Independent Verification</h3>
                <p>You acknowledge and agree that:</p>
                <ul>
                    <li>All results, calculations, and interpretations must be independently reviewed and verified by
                        you and approved by your supervisors and/or other qualified professionals with authority over
                        your project.</li>
                    <li>You are solely responsible for ensuring compliance with all applicable laws, regulations, codes,
                        and industry standards (for example, project specifications, class society rules, and relevant
                        API/ISO/IEC standards where applicable).</li>
                    <li>The Website is not a substitute for project-specific engineering design, peer review, risk
                        assessments, HAZOP/HAZID, or due diligence.</li>
                </ul>

                <h3>4) Assumptions, Sample Data & Technical Limitations</h3>
                <p>Calculators, examples, and tools may incorporate assumptions, simplifications, default values, or
                    sample data that do not reflect your specific operating conditions, safety factors, or equipment
                    tolerances. Outputs are illustrative only and may be incomplete, approximate, or unsuitable for your
                    use case.</p>

                <h3>5) Accuracy, Completeness & Timeliness Not Guaranteed</h3>
                <p>While reasonable efforts may be made to maintain the Content, we make no representations or
                    warranties that the Content or outputs are accurate, complete, current, reliable, or suitable for
                    any particular purpose or project. Results may change as inputs, assumptions, standards, or
                    underlying methods evolve.</p>

                <h3>6) Third-Party Links & Materials</h3>
                <p>The Website may reference or link to third-party resources. We do not control and are not responsible
                    for third-party content, practices, or policies. Use of third-party materials is at your own risk.
                </p>

                <h3>7) "AS IS" / "AS AVAILABLE" Warranty Disclaimer</h3>
                <p><strong>TO THE MAXIMUM EXTENT PERMITTED BY LAW, THE WEBSITE AND ALL CONTENT ARE PROVIDED "AS IS" AND
                        "AS AVAILABLE", WITHOUT WARRANTIES OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO
                        WARRANTIES OF ACCURACY, COMPLETENESS, MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, TITLE,
                        AND NON-INFRINGEMENT. WE DO NOT WARRANT THAT THE WEBSITE WILL BE UNINTERRUPTED, ERROR-FREE,
                        SECURE, OR FREE OF HARMFUL COMPONENTS.</strong></p>

                <h3>8) Limitation of Liability</h3>
                <p><strong>TO THE MAXIMUM EXTENT PERMITTED BY LAW, WE SHALL NOT BE LIABLE FOR ANY INDIRECT, INCIDENTAL,
                        SPECIAL, CONSEQUENTIAL, EXEMPLARY, OR PUNITIVE DAMAGES, OR FOR LOSS OF PROFITS, REVENUE, DATA,
                        GOODWILL, PRODUCTION, BUSINESS INTERRUPTION, OR REPUTATION, ARISING OUT OF OR RELATED TO YOUR
                        USE OF THE WEBSITE OR CONTENT, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</strong></p>
                <p><strong>IN NO EVENT SHALL OUR TOTAL AGGREGATE LIABILITY FOR ANY CLAIMS ARISING FROM OR RELATING TO
                        THE WEBSITE OR CONTENT EXCEED THE GREATER OF (A) THE AMOUNT YOU PAID US (IF ANY) FOR ACCESS TO
                        THE CONTENT DURING THE TWELVE (12) MONTHS PRECEDING THE EVENT GIVING RISE TO LIABILITY, OR (B)
                        USD $100.</strong></p>

                <h3>9) Indemnification</h3>
                <p>You agree to defend, indemnify, and hold harmless us and our officers, directors, employees, and
                    agents from and against any claims, liabilities, damages, losses, and expenses (including reasonable
                    attorneys' fees) arising out of or related to: (a) your use of the Website or Content; (b) your
                    violation of this Disclaimer or any applicable law, regulation, code, or standard; or (c) your
                    infringement or misappropriation of any third-party right.</p>

                <h3>10) Intellectual Property & Use Restrictions</h3>
                <p>Unless otherwise indicated, the Website and Content are owned by us or our licensors and protected by
                    intellectual property laws. You are granted a limited, revocable license to access and view the
                    Website for its intended informational purpose. Any reproduction, redistribution, scraping, reverse
                    engineering, or commercial exploitation of the Website or Content is prohibited without our prior
                    written consent.</p>

                <h3>11) No Confidential or Safety-Critical Submissions</h3>
                <p>Do not upload or submit confidential, proprietary, personal, or safety-critical information to the
                    Website. We do not undertake any duty to maintain confidentiality for unsolicited submissions.</p>

                <h3>12) Regional Availability; Export/Compliance</h3>
                <p>We do not represent that the Website or Content are appropriate or available for use in any
                    particular jurisdiction. You are responsible for compliance with local laws where you access the
                    Website and for any applicable export controls.</p>

                <h3>13) Changes, Availability & Termination</h3>
                <p>We may modify, suspend, or discontinue any part of the Website or Content at any time without notice
                    and without liability. We may update this Disclaimer by posting a revised version with a new "Last
                    updated" date.</p>

                <h3>14) Governing Law & Dispute Resolution</h3>
                <p>This Disclaimer and any dispute or claim arising out of or relating to the Website or Content
                    (including non-contractual disputes or claims) shall be governed by the laws of Singapore, excluding
                    its conflict-of-laws rules. Any dispute shall be finally resolved by arbitration administered by the
                    Singapore International Arbitration Centre (SIAC) under the SIAC Rules, which rules are deemed
                    incorporated by reference into this clause.</p>
                <ul>
                    <li><strong>Seat of arbitration:</strong> Singapore</li>
                    <li><strong>Governing law of the arbitration agreement:</strong> Singapore law</li>
                    <li><strong>Number of arbitrators:</strong> One (or three, if the amount in dispute exceeds USD
                        1,000,000)</li>
                    <li><strong>Language:</strong> English</li>
                    <li><strong>Confidentiality:</strong> The existence of the proceedings and all filings, evidence,
                        and awards shall be confidential to the maximum extent permitted by law.</li>
                </ul>
                <p><strong>Injunctive relief:</strong> Notwithstanding the foregoing, either party may seek temporary or
                    injunctive relief related to intellectual property or misuse of the Website in any court of
                    competent jurisdiction.</p>

                <h3>15) Severability & Entire Agreement</h3>
                <p>If any provision of this Disclaimer is found unenforceable, it shall be enforced to the maximum
                    extent permissible, and the remainder will remain in full force. This Disclaimer constitutes the
                    entire agreement regarding its subject matter and supersedes any prior or contemporaneous
                    understandings.</p>

                <h3>16) Contact</h3>
                <p>For questions about this Disclaimer, contact: <strong>enquiry@murphycurves.com</strong></p>
            </div>
            <div class="disclaimer-modal-footer">
                <button id="disclaimerModalOk">I Understand</button>
            </div>
        </div>
    </div>

    <script>
        // Client-side interface for server-side mooring calculations
        function readMooringInputs() {
            return {
                depth_m: parseFloat(document.getElementById('depth').value),
                disp_t: parseFloat(document.getElementById('disp').value),
                loa_m: parseFloat(document.getElementById('loa').value),
                beam_m: parseFloat(document.getElementById('beam').value),
                draft_m: parseFloat(document.getElementById('draft').value),
                current_kn: parseFloat(document.getElementById('current').value),
                hs_m: parseFloat(document.getElementById('hs').value),
                tp_s: parseFloat(document.getElementById('tp').value),
                wind_ms: parseFloat(document.getElementById('wind').value),
                awind_m2: parseFloat(document.getElementById('awind').value),
                system: document.getElementById('system').value,
                nlines: parseInt(document.getElementById('nlines').value, 10),
                sf: parseFloat(document.getElementById('sf').value),
                material: document.getElementById('material').value,
                diameter_mm: parseFloat(document.getElementById('diam').value),
                lineLen_m: parseFloat(document.getElementById('lineLen').value),
                pret_kN: parseFloat(document.getElementById('pret').value),
                theta_deg: parseFloat(document.getElementById('theta').value),
                surge_m: parseFloat(document.getElementById('surge').value),
                sway_m: parseFloat(document.getElementById('sway').value),
                yaw_deg: parseFloat(document.getElementById('yaw').value),
                yawArm_m: parseFloat(document.getElementById('yawArm').value),
                daf: parseFloat(document.getElementById('daf').value)
            };
        }

        async function onCalculateMooring() {
            // Check authentication first
            if (!requireAuthentication()) {
                return;
            }

            // ALL MOORING CALCULATIONS ARE PROTECTED IN BACKEND - NO FRONTEND FORMULAS
            console.log('Attempting mooring calculation...');
            try {
                const payload = readMooringInputs();
                console.log('Mooring payload:', payload);

                const res = await fetch('/.netlify/functions/mooring', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                console.log('Mooring response status:', res.status);
                const data = await res.json();
                console.log('Mooring response data:', data);

                if (!res.ok) {
                    console.error('Mooring calculation error:', data);
                    alert(data.error || 'Mooring calculation failed');
                    return;
                }

                displayMooringResults(data);

            } catch (error) {
                console.error('Mooring Network error:', error);
                alert('Failed to connect to mooring calculation service. Server required for calculations.');

                // Show message instead of demo calculations - NO FORMULAS EXPOSED
                const outEl = document.getElementById('out');
                const recEl = document.getElementById('rec');

                if (outEl) outEl.textContent = 'Server connection required for mooring calculations. No formulas available in frontend.';
                if (recEl) recEl.textContent = 'Server-side calculations protect proprietary formulas.';
            }
        }

        function displayMooringResults(data) {
            const payload = readMooringInputs();

            // Display main results
            const txt = [
                `ENVIRONMENTAL LOADS`,
                `  Current:        ${Math.round(data.F_current_kN)} kN`,
                `  Wind:           ${Math.round(data.F_wind_kN)} kN`,
                `  Wave-drift:     ${Math.round(data.F_wave_kN)} kN`,
                `  TOTAL F_env:    ${Math.round(data.F_env_kN)} kN`,
                ``,
                `MOORING DISTRIBUTION`,
                `  System: ${payload.system}, lines N=${payload.nlines}, effective storm-sector lines n_eff=${data.neff}`,
                `  Line material: ${payload.material}, diameter d=${payload.diameter_mm} mm`,
                `  MBL per line â‰ˆ ${Math.round(data.MBL_kN)} kN`,
                `  EA per line â‰ˆ ${data.EA_GN.toFixed(2)} GN, system stiffness K â‰ˆ ${data.K_sys_kN_per_m.toFixed(1)} kN/m`,
                ``,
                `STATIC VS PEAK (with motions)`,
                `  Static per-line tension:  ${data.T_line_static_kN} kN`,
                `  Dynamic increment, Î”T_dyn: ${data.deltaT_dyn_kN} kN (DAF applied in peak)`,
                `  Peak per-line tension:    ${data.T_line_peak_kN} kN`,
                `  Utilization (static):     ${(data.utilization_static * 100).toFixed(0)} %`,
                `  Utilization (peak):       ${(data.utilization_peak * 100).toFixed(0)} %  â†’  Safety margin â‰ˆ ${data.safetyMargin_peak.toFixed(0)} %`,
                `  Estimated offset:         ${data.offset_m} m  (${data.offset_pctDepth} % of depth)`,
                `  Fatigue (very coarse):    ${data.fatigue}`,
                ``,
                `Vessel input sanity: ${data.vesselNote}`
            ].join("\n");

            document.getElementById('out').textContent = txt;

            // Driver breakdown & recommendation
            const pCur = data.F_env_kN > 0 ? Math.round((data.F_current_kN / data.F_env_kN) * 100) : 0;
            const pWind = data.F_env_kN > 0 ? Math.round((data.F_wind_kN / data.F_env_kN) * 100) : 0;
            const pWave = data.F_env_kN > 0 ? Math.round((data.F_wave_kN / data.F_env_kN) * 100) : 0;
            const pDyn = data.T_line_peak_kN > 0 ? Math.round((data.deltaT_dyn_kN / data.T_line_peak_kN) * 100) : 0;

            const drivers = [
                `Drivers â†’ Env split: current ${pCur}% | wind ${pWind}% | wave ${pWave}%`,
                `Dynamic add: +${data.deltaT_dyn_kN} kN (~${pDyn}% of peak) from motions + DAF`,
                `Sharing: n_eff=${data.neff}, SF=${payload.sf}. Capacity: MBL/lineâ‰ˆ${data.MBL_kN} kN.`
            ].join('\n');
            document.getElementById('rec').textContent = 'â€¢ ' + data.recommendations.join('\nâ€¢ ') + '\n\n' + drivers;
        }

        async function runMooringTests() {
            // ALL TEST CALCULATIONS ARE PROTECTED IN BACKEND - NO FRONTEND LOGIC
            try {
                const basePayload = readMooringInputs();
                const res = await fetch('/.netlify/functions/mooring', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(basePayload)
                });
                const data = await res.json();

                if (!res.ok) {
                    console.error('Test calculation error:', data);
                    document.getElementById('tests').textContent = 'Test failed: ' + (data.error || 'Unknown error');
                    return;
                }

                // Display test results from server only
                const testResults = data.tests.map(test =>
                    `${test.name}: ${test.pass ? 'PASS' : 'FAIL'}`
                );

                document.getElementById('tests').textContent = [
                    'Server-side validation tests:',
                    '',
                    ...testResults,
                    '',
                    'All tests validate core mooring calculation logic.',
                    'Calculations performed server-side for security.'
                ].join('\n');

            } catch (error) {
                console.error('Test network error:', error);
                document.getElementById('tests').textContent = 'Failed to run tests: Server connection required. No test calculations available in frontend.';
            }
        }

        // What-if utilities with server-side calculation ONLY
        async function updateWhatIf() {
            // ALL WHAT-IF CALCULATIONS ARE PROTECTED IN BACKEND - NO FRONTEND FORMULAS
            try {
                const base = readMooringInputs();
                const w_d = parseFloat(document.getElementById('wi_diam').value);
                const w_n = parseInt(document.getElementById('wi_lines').value, 10);
                const w_sf = parseFloat(document.getElementById('wi_sf').value);

                const payload = { ...base, diameter_mm: w_d, nlines: w_n, sf: w_sf };
                const res = await fetch('/.netlify/functions/mooring', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const data = await res.json();

                if (!res.ok) {
                    document.getElementById('wi_out').textContent = 'What-if calculation failed - server required';
                    return;
                }

                const pDyn = data.T_line_peak_kN > 0 ? Math.round((data.deltaT_dyn_kN / data.T_line_peak_kN) * 100) : 0;
                const txt = [
                    `Whatâ€‘if: d=${w_d} mm, N=${w_n}, SF=${w_sf.toFixed(2)}`,
                    `  Peak per-line: ${data.T_line_peak_kN} kN  |  Util_peak: ${(data.utilization_peak * 100).toFixed(0)} %`,
                    `  Î”T_dyn: +${data.deltaT_dyn_kN} kN (~${pDyn}% of peak). Offset: ${data.offset_m} m`,
                    `  Rec: ${data.recommendations[0]}`
                ].join('\n');
                document.getElementById('wi_out').textContent = txt;

            } catch (error) {
                document.getElementById('wi_out').textContent = 'What-if: Server connection required. No calculations available in frontend.';
            }
        }

        function applyWhatIf() {
            const d = document.getElementById('wi_diam').value;
            const n = document.getElementById('wi_lines').value;
            const s = document.getElementById('wi_sf').value;
            document.getElementById('diam').value = d;
            document.getElementById('nlines').value = n;
            document.getElementById('sf').value = s;
            onCalculateMooring();
        }

        function resetWhatIf() {
            const inp = readMooringInputs();
            const sd = document.getElementById('wi_diam');
            const sn = document.getElementById('wi_lines');
            const ss = document.getElementById('wi_sf');
            if (sd) sd.value = inp.diameter_mm;
            if (sn) sn.value = inp.nlines;
            if (ss) ss.value = inp.sf;
            updateWhatIf();
        }

        // Initialize chart
        const ctx = document.getElementById('offloadingChart').getContext('2d');
        const chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Full Operation', '1 Pump Failure', '2 Pump Failure'],
                datasets: [{ label: 'Offloading Time (hr) for 180K mÂ³', data: [0, 0, 0] }]
            },
            options: { responsive: true, maintainAspectRatio: false }
        });

        function getInputs() {
            return {
                target: parseFloat(document.getElementById('target').value),
                availability: parseFloat(document.getElementById('availability').value),
                tankSize: parseFloat(document.getElementById('tankSize').value),
                numTanks: parseFloat(document.getElementById('numTanks').value),
                lngDensity: parseFloat(document.getElementById('lngDensity').value),
                offloadingRate: parseFloat(document.getElementById('offloadingRate').value),
                pumpsPerTank: parseFloat(document.getElementById('pumpsPerTank').value)
            };
        }

        async function runCalc() {
            // Check authentication first
            if (!requireAuthentication()) {
                return;
            }

            // ALL CALCULATIONS ARE PROTECTED IN BACKEND - NO FRONTEND FORMULAS EXPOSED
            console.log('ðŸš€ Attempting FLNG calculation...');

            // Validate inputs first
            const payload = getInputs();
            console.log('ðŸ“„ FLNG payload:', payload);

            // Check for invalid inputs
            const invalidInputs = Object.entries(payload).filter(([key, value]) =>
                isNaN(value) || !isFinite(value) || value <= 0
            );

            if (invalidInputs.length > 0) {
                console.error('âŒ Invalid inputs detected:', invalidInputs);
                alert(`Invalid inputs detected: ${invalidInputs.map(([k]) => k).join(', ')}. Please check your values.`);
                return;
            }

            try {
                console.log('ðŸŒ Sending request to /.netlify/functions/calc');
                const res = await fetch('/.netlify/functions/calc', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                console.log('ðŸ“Š FLNG response status:', res.status);
                const data = await res.json();
                console.log('ðŸ“Š FLNG response data:', data);

                if (!res.ok) {
                    console.error('âŒ Calc error', data);
                    alert(data.error || 'Calculation failed');
                    return;
                }

                console.log('âœ… Calculation successful, updating display...');
                displayCalcResults(data);

            } catch (error) {
                console.error('âŒ FLNG Network error:', error);
                console.log('Error details:', {
                    message: error.message,
                    stack: error.stack,
                    name: error.name
                });

                // Show user-friendly error message
                alert('Failed to connect to calculation service. Please check your internet connection and try again.');

                // Show message instead of local calculations - NO FORMULAS EXPOSED
                const elements = {
                    'annualDays': 'Connection Error',
                    'annualProduction': 'Connection Error',
                    'lngVolume': 'Connection Error',
                    'inventoryTurns': 'Connection Error',
                    'tankPumpRate': 'Connection Error',
                    'pumpRate': 'Connection Error',
                    'pumpRateDay': 'Connection Error',
                    'feedGasFlowrate': 'Connection Error',
                    'feedGasFlowratemmscfd': 'Connection Error',
                    'lngProductionRate': 'Connection Error',
                    'lngProductionRateKg': 'Connection Error'
                };

                Object.entries(elements).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.textContent = value;
                        element.style.color = '#ff6b6b';
                    }
                });

                // Clear table - NO CALCULATION FALLBACK
                const tbody = document.querySelector('.results-table tbody') ||
                    document.querySelector('#offloadingTableBody');
                if (tbody) {
                    tbody.innerHTML = `
                        <tr><td>180,000</td><td style="color: #ff6b6b;">Connection Error</td><td style="color: #ff6b6b;">Connection Error</td><td style="color: #ff6b6b;">Connection Error</td></tr>
                        <tr><td>225,000</td><td style="color: #ff6b6b;">Connection Error</td><td style="color: #ff6b6b;">Connection Error</td><td style="color: #ff6b6b;">Connection Error</td></tr>
                        <tr><td>265,000</td><td style="color: #ff6b6b;">Connection Error</td><td style="color: #ff6b6b;">Connection Error</td><td style="color: #ff6b6b;">Connection Error</td></tr>
                    `;
                }
            }
        }

        function debugOffloadingTable() {
            console.log('ðŸ”=== OFFLOADING TABLE DEBUG ===');

            // Check if we can find the table elements
            const selectors = [
                '.results-table tbody',
                '#offloadingTableBody',
                'table.results-table tbody',
                'tbody'
            ];

            console.log('ðŸ” Searching for table elements...');
            selectors.forEach((selector, index) => {
                const element = document.querySelector(selector);
                console.log(`${index + 1}. ${selector}:`, element);
                if (element) {
                    console.log('   - HTML:', element.innerHTML.substring(0, 200) + '...');
                    console.log('   - Parent:', element.parentElement);
                }
            });

            // Check current input values
            console.log('ðŸ” Current input values:');
            const inputs = getInputs();
            Object.entries(inputs).forEach(([key, value]) => {
                console.log(`   ${key}: ${value} (${typeof value})`);
            });

            // Test the calculation endpoint directly
            console.log('ðŸ” Testing calculation endpoint...');
            testCalcEndpoint();

            // Show debug info to user
            alert('Debug info logged to console. Open browser developer tools (F12) to see details.');
        }

        async function testCalcEndpoint() {
            try {
                const payload = {
                    target: 2.7,
                    availability: 0.92,
                    tankSize: 225000,
                    numTanks: 5,
                    lngDensity: 443,
                    offloadingRate: 12000,
                    pumpsPerTank: 2
                };

                console.log('ðŸ” Test payload:', payload);

                const response = await fetch('/.netlify/functions/calc', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                console.log('ðŸ” Test response status:', response.status);
                const data = await response.json();
                console.log('ðŸ” Test response data:', data);

                if (data.table && Array.isArray(data.table)) {
                    console.log('ðŸ” Table data structure:');
                    data.table.forEach((row, index) => {
                        console.log(`   Row ${index + 1}:`, row);
                    });
                }

            } catch (error) {
                console.error('ðŸ” Test endpoint failed:', error);
            }
        }

        function verifyTableAndFix() {
            console.log('ðŸ” Quick table verification...');

            // Find the offloading table
            const tables = document.querySelectorAll('table');
            let targetTable = null;

            for (let table of tables) {
                const headers = table.querySelectorAll('th');
                const hasCarrierHeader = Array.from(headers).some(th =>
                    th.textContent.toLowerCase().includes('carrier')
                );
                if (hasCarrierHeader) {
                    targetTable = table;
                    break;
                }
            }

            if (targetTable) {
                const tbody = targetTable.querySelector('tbody');
                if (tbody) {
                    const cells = tbody.querySelectorAll('td');
                    const hasPlaceholders = Array.from(cells).some(cell => {
                        const text = cell.textContent.toLowerCase();
                        return text.includes('calculating') ||
                            text.includes('loading') ||
                            text.includes('â€”') ||
                            text.trim() === '';
                    });

                    if (hasPlaceholders) {
                        console.log('âš ï¸ Table needs fixing, triggering debug mode...');
                        // Simply trigger the existing debug functionality
                        const debugBtn = document.getElementById('debugBtn');
                        if (debugBtn) {
                            debugBtn.click();
                        }
                    } else {
                        console.log('âœ… Table is working properly');
                    }
                }
            }
        }

        async function emergencyTableUpdate() {
            console.log('ðŸŽ† EMERGENCY TABLE UPDATE ACTIVATED');

            try {
                // Use current input values or defaults
                const payload = getInputs();
                console.log('ðŸ”„ Emergency payload:', payload);

                const response = await fetch('/.netlify/functions/calc', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('ðŸ“ˆ Emergency data received:', data);

                if (data.table && Array.isArray(data.table) && data.table.length === 3) {
                    // Find the table by searching all tables for carrier size header
                    const tables = document.querySelectorAll('table');
                    let targetTable = null;

                    for (let table of tables) {
                        const headers = table.querySelectorAll('th');
                        const hasCarrierHeader = Array.from(headers).some(th =>
                            th.textContent.toLowerCase().includes('carrier')
                        );
                        if (hasCarrierHeader) {
                            targetTable = table;
                            break;
                        }
                    }

                    if (targetTable) {
                        const tbody = targetTable.querySelector('tbody');
                        if (tbody) {
                            console.log('ðŸŽ¯ Found target table, forcing update...');

                            // Clear and rebuild
                            tbody.innerHTML = '';

                            data.table.forEach((row, index) => {
                                const tr = document.createElement('tr');
                                tr.innerHTML = `
                                    <td>${row.size.toLocaleString()}</td>
                                    <td style="color: #FFD700; font-weight: bold;">${row.full.toFixed(1)}</td>
                                    <td style="color: #FFD700; font-weight: bold;">${row.fail1.toFixed(1)}</td>
                                    <td style="color: #FFD700; font-weight: bold;">${row.fail2.toFixed(1)}</td>
                                `;
                                tbody.appendChild(tr);
                            });

                            console.log('âœ… Emergency update completed successfully!');

                            // Show success message
                            const notification = document.createElement('div');
                            notification.innerHTML = 'âœ… Table updated successfully!';
                            notification.style.cssText = `
                                position: fixed; top: 20px; right: 20px; z-index: 9999;
                                background: #28a745; color: white; padding: 15px 20px;
                                border-radius: 5px; font-weight: bold;
                            `;
                            document.body.appendChild(notification);
                            setTimeout(() => notification.remove(), 3000);

                        } else {
                            console.error('âŒ No tbody found in target table');
                        }
                    } else {
                        console.error('âŒ No table with carrier size header found');
                    }
                } else {
                    console.error('âŒ Invalid table data in emergency update');
                }

            } catch (error) {
                console.error('âŒ Emergency update failed:', error);
            }
        }

        function displayCalcResults(data) {
            // Update numbers
            const elements = {
                'annualDays': data.annualDays,
                'annualProduction': data.annualProduction.toLocaleString(),
                'lngVolume': data.lngVolume.toLocaleString(),
                'inventoryTurns': data.inventoryTurns,
                'tankPumpRate': data.tankPumpRate.toLocaleString(),
                'pumpRate': data.pumpRate.toLocaleString(),
                'pumpRateDay': data.pumpRateDay.toLocaleString(),
                'feedGasFlowrate': data.feedGasFlowrate.toLocaleString(),
                'feedGasFlowratemmscfd': data.feedGasFlowratemmscfd.toLocaleString(),
                'lngProductionRate': data.lngProductionRate.toLocaleString(),
                'lngProductionRateKg': data.lngProductionRateKg.toLocaleString()
            };

            // Update each element safely
            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                }
            });

            // Chart - update safely
            if (typeof chart !== 'undefined' && chart && data.chartData) {
                try {
                    chart.data.datasets[0].data = data.chartData;
                    chart.update();
                } catch (error) {
                    console.error('Chart update error:', error);
                }
            }

            // Table rows - EMERGENCY FIX: Multiple strategies to update table
            console.log('ðŸ”„ Updating table with data:', data.table);
            if (data.table && Array.isArray(data.table) && data.table.length === 3) {
                // Strategy 1: Try original selector
                let tbody = document.querySelector('.results-table tbody');

                // Strategy 2: Try by ID
                if (!tbody) {
                    tbody = document.querySelector('#offloadingTableBody');
                }

                // Strategy 3: Try all tables and find the one with "Carrier Size" header
                if (!tbody) {
                    const tables = document.querySelectorAll('table');
                    for (let table of tables) {
                        const headers = table.querySelectorAll('th');
                        const hasCarrierSize = Array.from(headers).some(th =>
                            th.textContent.includes('Carrier Size') ||
                            th.textContent.includes('CARRIER SIZE')
                        );
                        if (hasCarrierSize) {
                            tbody = table.querySelector('tbody');
                            break;
                        }
                    }
                }

                // Strategy 4: Last resort - find any tbody in offloading section
                if (!tbody) {
                    const offloadingSection = document.getElementById('offloading') ||
                        document.querySelector('.offloading') ||
                        document.querySelector('[id*="offload"]');
                    if (offloadingSection) {
                        tbody = offloadingSection.querySelector('tbody');
                    }
                }

                if (tbody) {
                    console.log('âœ… Found table body element, clearing and updating...');

                    // Clear existing content
                    tbody.innerHTML = '';

                    // Create new rows with calculated data
                    data.table.forEach((rowData, index) => {
                        const row = document.createElement('tr');
                        const cells = [
                            rowData.size.toLocaleString(),
                            rowData.full.toFixed(1),
                            rowData.fail1.toFixed(1),
                            rowData.fail2.toFixed(1)
                        ];

                        row.innerHTML = cells.map((cell, cellIndex) =>
                            `<td style="${cellIndex > 0 ? 'color: var(--gold); font-weight: 600;' : ''}">${cell}</td>`
                        ).join('');

                        tbody.appendChild(row);
                        console.log(`âž• Added row ${index + 1}: Size=${rowData.size}, Full=${rowData.full}, Fail1=${rowData.fail1}, Fail2=${rowData.fail2}`);
                    });

                    console.log('ðŸŽ‰ Table successfully updated with calculated values!');

                    // Additional verification
                    setTimeout(() => {
                        const updatedRows = tbody.querySelectorAll('tr');
                        console.log(`âœ”ï¸ Verification: Table now has ${updatedRows.length} rows`);
                        updatedRows.forEach((row, i) => {
                            const cells = row.querySelectorAll('td');
                            console.log(`   Row ${i + 1}: ${Array.from(cells).map(c => c.textContent).join(' | ')}`);
                        });
                    }, 100);

                } else {
                    console.error('âŒ CRITICAL: No table body found with any strategy!');
                    console.log('All tables on page:', document.querySelectorAll('table'));
                    console.log('All tbody elements:', document.querySelectorAll('tbody'));

                    // Emergency fallback: Create alert with data
                    const tableData = data.table.map(row =>
                        `${row.size.toLocaleString()}: ${row.full}h | ${row.fail1}h | ${row.fail2}h`
                    ).join('\n');
                    console.log('Table data that should be displayed:\n' + tableData);
                }
            } else {
                console.error('âŒ Invalid table data received:', {
                    hasTable: !!data.table,
                    isArray: Array.isArray(data.table),
                    length: data.table ? data.table.length : 'N/A',
                    data: data.table
                });
            }
        }

        // Outseta Authentication Utilities
        const OUTSETA_URLS = {
            register: 'https://murphycurves.outseta.com/auth?widgetMode=register#o-anonymous',
            login: 'https://murphycurves.outseta.com/auth?widgetMode=login#o-anonymous',
            profile: 'https://murphycurves.outseta.com/profile#o-authenticated',
            logout: window.location.origin + '/#o-logout-link'
        };

        // Check if user just completed registration
        // IMPORTANT: This should ONLY return true if user JUST completed registration (within last few minutes)
        // NOT for users who just haven't logged in yet
        function checkRegistrationCompletion() {
            try {
                // IMPORTANT: If user is already authenticated, they don't need registration messages
                if (isUserAuthenticated()) {
                    // Clear any registration flags since user is logged in
                    sessionStorage.removeItem('outseta_registration_complete');
                    sessionStorage.removeItem('outseta_registration_initiated');
                    return false;
                }

                // STRICT CHECK: Only show registration message if user JUST completed registration
                // Check URL parameters for registration completion indicators (most reliable)
                const urlParams = new URLSearchParams(window.location.search);
                const hash = window.location.hash;

                // Check for Outseta registration completion indicators in URL
                const hasRegistrationParam = urlParams.has('registered') ||
                    urlParams.has('registration_complete') ||
                    hash.includes('o-registered') ||
                    hash.includes('registration-complete');

                // If URL has registration parameters, user just completed registration
                if (hasRegistrationParam) {
                    console.log('âœ… Registration completion detected in URL');
                    return true;
                }

                // Check sessionStorage for recent registration completion (within last 2 minutes ONLY)
                const recentRegistration = sessionStorage.getItem('outseta_registration_complete');
                if (recentRegistration) {
                    const registrationTime = parseInt(recentRegistration);
                    const timeSinceRegistration = Date.now() - registrationTime;
                    // Only consider it "recent" if within last 2 minutes (strict)
                    const isVeryRecent = timeSinceRegistration < 2 * 60 * 1000; // 2 minutes

                    if (isVeryRecent) {
                        console.log('âœ… Registration completion detected (very recent, within 2 minutes)');
                        return true;
                    } else {
                        // Registration was completed but too long ago - clear flag
                        sessionStorage.removeItem('outseta_registration_complete');
                        console.log('âš ï¸ Registration flag cleared (too old)');
                    }
                }

                // DO NOT check registrationInitiated flag here - that's for tracking, not completion
                // Only show registration message if user ACTUALLY completed registration, not just clicked register

                return false;
            } catch (error) {
                console.error('Error checking registration completion:', error);
                return false;
            }
        }

        // Mark registration as complete
        function markRegistrationComplete() {
            try {
                sessionStorage.setItem('outseta_registration_complete', Date.now().toString());
                // Clear URL parameters after marking
                if (window.location.search.includes('registered') || window.location.hash.includes('o-registered')) {
                    const url = new URL(window.location);
                    url.searchParams.delete('registered');
                    url.searchParams.delete('registration_complete');
                    url.hash = url.hash.replace(/o-registered|registration-complete/g, '');
                    window.history.replaceState({}, '', url);
                }
            } catch (error) {
                console.error('Error marking registration complete:', error);
            }
        }

        // Check if user is authenticated via Outseta
        function isUserAuthenticated() {
            try {
                // Method 1: Check for access_token in URL (Outseta redirects with this)
                const urlParams = new URLSearchParams(window.location.search);
                const hash = window.location.hash;
                if (urlParams.has('access_token') || hash.includes('access_token')) {
                    // User has access token in URL - they're authenticated
                    console.log('âœ… User authenticated via access_token in URL');
                    return true;
                }

                // Method 2: Try Outseta API (check if method exists first)
                if (typeof window.Outseta !== 'undefined' && window.Outseta && window.Outseta.auth) {
                    // Check if isAuthenticated method exists before calling
                    if (typeof window.Outseta.auth.isAuthenticated === 'function') {
                        try {
                            const isAuth = window.Outseta.auth.isAuthenticated();
                            if (isAuth) {
                                console.log('âœ… User authenticated via Outseta API');
                                return true;
                            }
                        } catch (apiError) {
                            console.warn('Outseta API isAuthenticated() error:', apiError);
                            // Continue to fallback methods
                        }
                    } else {
                        // API method doesn't exist - check for user object instead
                        if (window.Outseta.auth.user) {
                            console.log('âœ… User authenticated (user object found)');
                            return true;
                        }
                    }
                }

                // Method 3: Check localStorage/sessionStorage for Outseta tokens
                if (typeof localStorage !== 'undefined') {
                    // Check for various Outseta token formats
                    const tokens = [
                        localStorage.getItem('outseta_session'),
                        localStorage.getItem('o_auth_token'),
                        localStorage.getItem('outseta_access_token'),
                        localStorage.getItem('access_token'),
                        sessionStorage.getItem('outseta_session'),
                        sessionStorage.getItem('o_auth_token'),
                        sessionStorage.getItem('outseta_access_token'),
                        sessionStorage.getItem('access_token')
                    ];

                    for (const token of tokens) {
                        if (token && token !== 'null' && token !== 'undefined') {
                            console.log('âœ… User authenticated via stored token');
                            return true;
                        }
                    }
                }

                // Method 4: Check for Outseta user data in storage
                if (typeof localStorage !== 'undefined') {
                    const userData = localStorage.getItem('outseta_user') ||
                        sessionStorage.getItem('outseta_user') ||
                        localStorage.getItem('user') ||
                        sessionStorage.getItem('user');
                    if (userData && userData !== 'null' && userData !== 'undefined') {
                        try {
                            const user = typeof userData === 'string' ? JSON.parse(userData) : userData;
                            if (user && (user.email || user.Email || user.id || user.Id)) {
                                console.log('âœ… User authenticated via user data in storage');
                                return true;
                            }
                        } catch (e) {
                            // Not valid JSON, continue
                        }
                    }
                }

                return false;
            } catch (error) {
                console.error('Error checking authentication:', error);
                return false;
            }
        }

        // Fetch user data from Outseta API using access token
        async function fetchUserFromAPI(accessToken) {
            try {
                // Try to fetch user data from Outseta API
                // Outseta API endpoint format may vary - trying common endpoints
                const apiBase = 'https://murphycurves.outseta.com/api/v1';
                const endpoints = [
                    `${apiBase}/profile`,
                    `${apiBase}/account`,
                    `${apiBase}/user`,
                    `https://api.outseta.com/api/v1/account`
                ];

                for (const endpoint of endpoints) {
                    try {
                        const response = await fetch(endpoint, {
                            method: 'GET',
                            headers: {
                                'Authorization': `Bearer ${accessToken}`,
                                'Content-Type': 'application/json'
                            }
                        });

                        if (response.ok) {
                            const user = await response.json();
                            if (user) {
                                // Store user data in storage
                                const userInfo = {
                                    email: user.Email || user.email || null,
                                    firstName: user.FirstName || user.firstName || null,
                                    lastName: user.LastName || user.lastName || null,
                                    fullName: ((user.FirstName || user.firstName || '') + ' ' + (user.LastName || user.lastName || '')).trim() || null
                                };
                                localStorage.setItem('outseta_user', JSON.stringify(userInfo));
                                sessionStorage.setItem('outseta_user', JSON.stringify(userInfo));
                                console.log('âœ… User data fetched from Outseta API:', userInfo);
                                return userInfo;
                            }
                        }
                    } catch (e) {
                        // Try next endpoint
                        console.warn('API endpoint failed:', endpoint, e);
                        continue;
                    }
                }
            } catch (error) {
                console.warn('Failed to fetch user from API:', error);
            }
            return null;
        }

        // Get current user info from Outseta
        function getUserInfo() {
            try {
                // Method 0: Check stored access token and fetch from API if needed
                const storedAccessToken = sessionStorage.getItem('outseta_access_token') || localStorage.getItem('outseta_access_token');
                const storedUser = localStorage.getItem('outseta_user') || sessionStorage.getItem('outseta_user');

                // If we have token but no user data, try to fetch from API
                if (storedAccessToken && !storedUser) {
                    fetchUserFromAPI(storedAccessToken).then(userInfo => {
                        if (userInfo) {
                            // Update UI when user data is fetched
                            updateAuthUI();
                        }
                    });
                }

                // Method 1: Try Outseta API (check if method exists first)
                if (typeof window.Outseta !== 'undefined' && window.Outseta && window.Outseta.auth) {
                    // Try getUser method if it exists
                    if (typeof window.Outseta.auth.getUser === 'function') {
                        try {
                            const user = window.Outseta.auth.getUser();
                            if (user) {
                                return {
                                    email: user.Email || user.email || null,
                                    firstName: user.FirstName || user.firstName || null,
                                    lastName: user.LastName || user.lastName || null,
                                    fullName: ((user.FirstName || user.firstName || '') + ' ' + (user.LastName || user.lastName || '')).trim() || null
                                };
                            }
                        } catch (apiError) {
                            console.warn('Outseta API getUser() error:', apiError);
                            // Continue to fallback methods
                        }
                    }

                    // Try accessing user object directly
                    if (window.Outseta.auth.user) {
                        const user = window.Outseta.auth.user;
                        const userInfo = {
                            email: user.Email || user.email || null,
                            firstName: user.FirstName || user.firstName || null,
                            lastName: user.LastName || user.lastName || null,
                            fullName: ((user.FirstName || user.firstName || '') + ' ' + (user.LastName || user.lastName || '')).trim() || null
                        };
                        // Store for future use
                        localStorage.setItem('outseta_user', JSON.stringify(userInfo));
                        sessionStorage.setItem('outseta_user', JSON.stringify(userInfo));
                        return userInfo;
                    }

                    // Try currentUser property
                    if (window.Outseta.auth.currentUser) {
                        const user = window.Outseta.auth.currentUser;
                        const userInfo = {
                            email: user.Email || user.email || null,
                            firstName: user.FirstName || user.firstName || null,
                            lastName: user.LastName || user.lastName || null,
                            fullName: ((user.FirstName || user.firstName || '') + ' ' + (user.LastName || user.lastName || '')).trim() || null
                        };
                        // Store for future use
                        localStorage.setItem('outseta_user', JSON.stringify(userInfo));
                        sessionStorage.setItem('outseta_user', JSON.stringify(userInfo));
                        return userInfo;
                    }
                }

                // Method 2: Check stored access token and fetch from API if no user data (already checked in Method 0)
                // This is handled above in Method 0

                // Method 3: Check for user data in storage
                const storageKeys = [
                    'outseta_user',
                    'user',
                    'outseta_current_user',
                    'current_user'
                ];

                for (const key of storageKeys) {
                    const userData = localStorage.getItem(key) || sessionStorage.getItem(key);
                    if (userData && userData !== 'null' && userData !== 'undefined') {
                        try {
                            const user = typeof userData === 'string' ? JSON.parse(userData) : userData;
                            if (user && (user.email || user.Email || user.id || user.Id)) {
                                return {
                                    email: user.Email || user.email || null,
                                    firstName: user.FirstName || user.firstName || user.name?.split(' ')[0] || null,
                                    lastName: user.LastName || user.lastName || (user.name?.split(' ').slice(1).join(' ') || null),
                                    fullName: user.name || ((user.FirstName || user.firstName || '') + ' ' + (user.LastName || user.lastName || '')).trim() || null
                                };
                            }
                        } catch (e) {
                            // Not valid JSON, continue
                            console.warn('Failed to parse user data from storage:', key, e);
                        }
                    }
                }

                // Method 4: Extract from access_token in URL if present (and decode JWT)
                const urlParams = new URLSearchParams(window.location.search);
                const accessToken = urlParams.get('access_token');
                if (accessToken) {
                    // If we have access token, try to decode user info from JWT
                    try {
                        // JWT tokens have 3 parts separated by dots
                        const parts = accessToken.split('.');
                        if (parts.length === 3) {
                            // Decode payload (second part)
                            const payload = JSON.parse(atob(parts[1]));
                            if (payload.email || payload.sub || payload.name) {
                                return {
                                    email: payload.email || payload.sub || null,
                                    firstName: payload.given_name || payload.firstName || payload.name?.split(' ')[0] || null,
                                    lastName: payload.family_name || payload.lastName || (payload.name?.split(' ').slice(1).join(' ') || null),
                                    fullName: payload.name || null
                                };
                            }
                        }
                    } catch (e) {
                        console.warn('Failed to decode access_token:', e);
                    }
                }

                return null;
            } catch (error) {
                console.error('Error getting user info:', error);
                return null;
            }
        }

        // Require authentication before calculations
        function requireAuthentication(actionName = 'access this website') {
            if (!isUserAuthenticated()) {
                // Check if user just completed registration
                if (checkRegistrationCompletion()) {
                    alert(`âœ… Registration Complete!\n\nðŸ“§ Please check your email (including spam folder) for:\n\nâ€¢ Password setup instructions, OR\nâ€¢ Temporary password from enqury@murphycurves.com\n\nOnce you have set up your password, click "Login" to access murphycurves.com.\n\nYour 3-day trial will start after you log in.`);
                    // Use Outseta API to open login widget
                    openOutsetaAuthWidget('login');
                    return false;
                } else {
                    // Use confirm dialog to let user choose login or register
                    const userChoice = confirm(`ðŸ”’ Member Access Required\n\nPlease authenticate to access murphycurves.com.\n\nClick OK to LOGIN (if you already registered)\nClick Cancel to REGISTER (if you're new)\n\nYour 3-day trial starts after registration.`);

                    if (userChoice) {
                        // User clicked OK - open LOGIN widget
                        openOutsetaAuthWidget('login');
                    } else {
                        // User clicked Cancel - open REGISTER widget
                        openOutsetaAuthWidget('register');
                    }
                    return false;
                }
            }
            return true;
        }

        // Helper function to open Outseta auth widget with proper API support
        function openOutsetaAuthWidget(mode) {
            // Set registration initiated flag when registering
            if (mode === 'register') {
                sessionStorage.setItem('outseta_registration_initiated', Date.now().toString());
            }

            console.log('Opening Outseta auth widget:', mode);

            // Method 1: Try Outseta API first (preferred method - opens widget modal)
            if (typeof window.Outseta !== 'undefined' && window.Outseta.auth) {
                try {
                    if (mode === 'login' && typeof window.Outseta.auth.showLogin === 'function') {
                        window.Outseta.auth.showLogin();
                        console.log('âœ… Opened login widget via Outseta API (showLogin)');
                        return;
                    } else if (mode === 'register' && typeof window.Outseta.auth.showSignup === 'function') {
                        window.Outseta.auth.showSignup();
                        console.log('âœ… Opened registration widget via Outseta API (showSignup)');
                        return;
                    }
                } catch (error) {
                    console.warn('Outseta API call failed, trying data attributes:', error);
                }
            }

            // Method 2: Use Outseta data attributes (data-o-signup-link or data-o-login-link)
            // This is the recommended method according to Outseta documentation
            try {
                const tempLink = document.createElement('a');

                // Use Outseta's standard data attributes
                if (mode === 'register') {
                    tempLink.setAttribute('data-o-signup-link', '');
                    tempLink.href = '#'; // Outseta will handle the URL
                } else if (mode === 'login') {
                    tempLink.setAttribute('data-o-login-link', '');
                    tempLink.href = '#'; // Outseta will handle the URL
                }

                // Make link visible to Outseta but hidden from user
                tempLink.style.position = 'absolute';
                tempLink.style.left = '-9999px';
                tempLink.style.top = '-9999px';
                tempLink.style.opacity = '0';
                tempLink.style.pointerEvents = 'auto';
                document.body.appendChild(tempLink);

                // Force a reflow to ensure element is in DOM
                void tempLink.offsetHeight;

                // Wait for Outseta to process the element, then trigger click
                setTimeout(() => {
                    // Try clicking the link - Outseta should intercept this
                    try {
                        tempLink.click();
                        console.log('âœ… Clicked link with Outseta data attribute:', mode);
                    } catch (e) {
                        console.warn('Click failed, trying event dispatch:', e);
                        // Alternative: dispatch a click event
                        const clickEvent = new MouseEvent('click', {
                            view: window,
                            bubbles: true,
                            cancelable: true,
                            buttons: 1
                        });
                        tempLink.dispatchEvent(clickEvent);
                    }

                    // Clean up after a delay
                    setTimeout(() => {
                        if (document.body.contains(tempLink)) {
                            document.body.removeChild(tempLink);
                        }
                    }, 2000);
                }, 200);
                return;
            } catch (error) {
                console.warn('Data attribute method failed, trying URL method:', error);
            }

            // Method 3: Fallback - Use URL with widgetMode parameter
            try {
                const url = mode === 'login' ? OUTSETA_URLS.login : OUTSETA_URLS.register;
                const tempLink = document.createElement('a');
                tempLink.href = url;
                tempLink.setAttribute('data-outseta-auth', mode);

                // Make link visible to Outseta but hidden from user
                tempLink.style.position = 'absolute';
                tempLink.style.left = '-9999px';
                tempLink.style.top = '-9999px';
                tempLink.style.opacity = '0';
                tempLink.style.pointerEvents = 'auto';
                document.body.appendChild(tempLink);

                void tempLink.offsetHeight;

                setTimeout(() => {
                    try {
                        tempLink.click();
                        console.log('âœ… Clicked link with URL:', url);
                    } catch (e) {
                        const clickEvent = new MouseEvent('click', {
                            view: window,
                            bubbles: true,
                            cancelable: true,
                            buttons: 1
                        });
                        tempLink.dispatchEvent(clickEvent);
                    }

                    setTimeout(() => {
                        if (document.body.contains(tempLink)) {
                            document.body.removeChild(tempLink);
                        }
                    }, 2000);
                }, 200);
            } catch (error) {
                console.error('All methods failed to open Outseta auth widget:', error);
                // Last resort: show message to user
                alert(`Please click the ${mode === 'login' ? 'Login' : 'Register'} button in the header to ${mode === 'login' ? 'log in' : 'register'}.`);
            }
        }

        // Extract and store access token from URL if present
        function extractAccessTokenFromURL() {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const accessToken = urlParams.get('access_token');

                if (accessToken) {
                    // Store token in sessionStorage for future use
                    sessionStorage.setItem('outseta_access_token', accessToken);
                    localStorage.setItem('outseta_access_token', accessToken);

                    console.log('âœ… Access token extracted from URL and stored');

                    // Try to fetch user data from API using the token
                    fetchUserFromAPI(accessToken).then(userInfo => {
                        if (userInfo) {
                            console.log('âœ… User data fetched and stored:', userInfo);
                        }
                    });

                    // Clean up URL (remove access_token parameter)
                    try {
                        urlParams.delete('access_token');
                        const newURL = window.location.pathname +
                            (urlParams.toString() ? '?' + urlParams.toString() : '') +
                            window.location.hash.replace(/[?&]access_token=[^&]*/, '');
                        window.history.replaceState({}, '', newURL);
                        console.log('âœ… URL cleaned (access_token removed from URL)');
                    } catch (e) {
                        console.warn('Failed to clean URL:', e);
                    }

                    // Clear registration flags since user has access token (authenticated)
                    sessionStorage.removeItem('outseta_registration_complete');
                    sessionStorage.removeItem('outseta_registration_initiated');

                    // Update UI to show user info (with delay to allow API fetch)
                    setTimeout(() => {
                        updateAuthUI();
                    }, 1000);

                    return true;
                }
                return false;
            } catch (error) {
                console.error('Error extracting access token from URL:', error);
                return false;
            }
        }

        // Initialize Outseta authentication check after page load
        function initializeOutsetaAuth() {
            // First, check for access token in URL (user just logged in)
            if (extractAccessTokenFromURL()) {
                console.log('âœ… User authenticated via access_token - flags cleared');
            }

            // Check for registration completion on page load
            if (checkRegistrationCompletion()) {
                markRegistrationComplete();
                console.log('âœ… Registration completion detected');
            }

            // Wait for Outseta to load
            const checkOutseta = setInterval(() => {
                if (typeof window.Outseta !== 'undefined') {
                    clearInterval(checkOutseta);

                    // Update UI based on authentication status
                    updateAuthUI();

                    // Periodically check authentication status (in case Outseta loads slowly)
                    let authCheckCount = 0;
                    const authCheckInterval = setInterval(() => {
                        authCheckCount++;
                        if (authCheckCount > 20) { // Stop after 10 seconds (20 * 500ms)
                            clearInterval(authCheckInterval);
                        }
                        // Re-check authentication and update UI
                        if (isUserAuthenticated()) {
                            updateAuthUI();
                        }
                    }, 500);

                    // Listen for authentication state changes
                    if (window.Outseta.auth && window.Outseta.auth.onStateChange) {
                        window.Outseta.auth.onStateChange(() => {
                            // Clear registration flags immediately when user authenticates
                            if (isUserAuthenticated()) {
                                sessionStorage.removeItem('outseta_registration_complete');
                                sessionStorage.removeItem('outseta_registration_initiated');
                                console.log('âœ… User authenticated - registration flags cleared');
                            }
                            // Update UI (will show user name if authenticated)
                            updateAuthUI();
                        });
                    }

                    // Listen for registration events
                    if (window.Outseta.auth && window.Outseta.auth.onRegistration) {
                        window.Outseta.auth.onRegistration(() => {
                            markRegistrationComplete();
                            console.log('âœ… Registration event detected via Outseta');
                        });
                    }

                    // Listen for window messages from Outseta iframe
                    window.addEventListener('message', (event) => {
                        // Only process messages from Outseta domain
                        if (event.origin.includes('outseta.com')) {
                            try {
                                const data = typeof event.data === 'string' ? JSON.parse(event.data) : event.data;

                                // Check for login events
                                if (data && (data.type === 'outseta:auth:login' ||
                                    data.event === 'auth:login' ||
                                    data.action === 'login')) {
                                    // User just logged in - clear flags and update UI
                                    sessionStorage.removeItem('outseta_registration_complete');
                                    sessionStorage.removeItem('outseta_registration_initiated');
                                    setTimeout(() => updateAuthUI(), 500);
                                    console.log('âœ… Login detected - registration flags cleared');
                                }

                                // Check for registration completion events
                                if (data && (data.type === 'outseta:registration:complete' ||
                                    data.event === 'registration:complete' ||
                                    data.action === 'registration_complete')) {
                                    markRegistrationComplete();
                                    console.log('âœ… Registration completion detected via message event');
                                }
                            } catch (e) {
                                // Not a JSON message, ignore
                            }
                        }
                    });
                }
            }, 100);

            // Stop checking after 10 seconds
            setTimeout(() => clearInterval(checkOutseta), 10000);
        }

        // Logout function - clears all Outseta session data
        function logoutUser() {
            try {
                console.log('ðŸšª Logging out user...');

                // Try Outseta API logout if available
                if (typeof window.Outseta !== 'undefined' && window.Outseta && window.Outseta.auth) {
                    try {
                        if (typeof window.Outseta.auth.logout === 'function') {
                            window.Outseta.auth.logout();
                            console.log('âœ… Logged out via Outseta API');
                        }
                    } catch (e) {
                        console.warn('Outseta API logout failed:', e);
                    }
                }

                // Clear all Outseta-related data from storage
                const keysToRemove = [
                    'outseta_session',
                    'o_auth_token',
                    'outseta_access_token',
                    'access_token',
                    'outseta_user',
                    'user',
                    'outseta_current_user',
                    'current_user',
                    'outseta_registration_complete',
                    'outseta_registration_initiated'
                ];

                // Clear from localStorage
                keysToRemove.forEach(key => {
                    try {
                        localStorage.removeItem(key);
                        sessionStorage.removeItem(key);
                    } catch (e) {
                        console.warn('Failed to remove key:', key, e);
                    }
                });

                console.log('âœ… All Outseta data cleared from storage');

                // Redirect to home page to ensure clean state
                window.location.href = window.location.origin + window.location.pathname;
            } catch (error) {
                console.error('Error during logout:', error);
                // Force redirect even if error occurs
                window.location.href = window.location.origin + window.location.pathname;
            }
        }

        // Update UI elements based on authentication status
        function updateAuthUI() {
            const isAuth = isUserAuthenticated();
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const logoutBtn = document.getElementById('logoutBtn');

            if (isAuth) {
                // User is authenticated - show user info and clear registration flags
                sessionStorage.removeItem('outseta_registration_complete');
                sessionStorage.removeItem('outseta_registration_initiated');

                // Get user info from Outseta
                const userInfo = getUserInfo();
                let displayText = 'Profile';

                if (userInfo) {
                    // Try to show user's name or email
                    if (userInfo.fullName && userInfo.fullName.trim()) {
                        displayText = userInfo.fullName.trim();
                    } else if (userInfo.firstName) {
                        displayText = userInfo.firstName;
                    } else if (userInfo.email) {
                        // Show first part of email (before @)
                        displayText = userInfo.email.split('@')[0];
                    } else {
                        displayText = 'Profile';
                    }
                }

                // Update login button to show user name
                if (loginBtn) {
                    loginBtn.textContent = displayText;
                    loginBtn.title = userInfo && userInfo.email ? userInfo.email : 'View Profile';
                }

                // Hide register button
                if (registerBtn) {
                    registerBtn.style.display = 'none'; // Hide register button when logged in
                }

                // Show logout button
                if (logoutBtn) {
                    logoutBtn.style.display = ''; // Show logout button when logged in
                    logoutBtn.title = 'Logout from murphycurves.com';
                }
            } else {
                // User is not authenticated
                if (loginBtn) {
                    loginBtn.textContent = 'Login';
                    loginBtn.title = 'Login to access calculations';
                }

                if (registerBtn) {
                    registerBtn.textContent = 'Register';
                    registerBtn.style.display = ''; // Show register button
                }

                // Hide logout button
                if (logoutBtn) {
                    logoutBtn.style.display = 'none'; // Hide logout button when not logged in
                }
            }
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize Outseta authentication
            initializeOutsetaAuth();

            // Initialize tab system FIRST
            initializeTabSystem();

            // Initialize disclaimer system
            initializeDisclaimerSystem();

            // Initialize pump sizing system
            initializePumpSystem();

            // Initialize FLNG electrical system
            initializeFLNGElectricalSystem();

            // Initialize FLNG process sizing system
            initializeFLNGProcessSystem();

            // Link LOGIN and REGISTER buttons to Outseta
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const heroRegisterBtn = document.getElementById('heroRegisterBtn');

            // Helper function to open Outseta auth pop-up
            function openOutsetaAuth(mode) {
                let url = '';
                if (mode === 'login') {
                    url = OUTSETA_URLS.login;
                } else if (mode === 'register') {
                    url = OUTSETA_URLS.register;
                    // Set a flag to track that user initiated registration
                    // This helps detect registration completion even if URL params aren't present
                    sessionStorage.setItem('outseta_registration_initiated', Date.now().toString());
                } else if (mode === 'profile') {
                    url = OUTSETA_URLS.profile;
                }

                console.log('Opening Outseta auth:', mode, url);

                // Try Outseta API first if available
                if (typeof window.Outseta !== 'undefined') {
                    try {
                        if (mode === 'login' && window.Outseta.auth && typeof window.Outseta.auth.showLogin === 'function') {
                            window.Outseta.auth.showLogin();
                            return;
                        } else if (mode === 'register' && window.Outseta.auth && typeof window.Outseta.auth.showSignup === 'function') {
                            window.Outseta.auth.showSignup();
                            return;
                        } else if (mode === 'profile' && window.Outseta.auth && typeof window.Outseta.auth.showProfile === 'function') {
                            window.Outseta.auth.showProfile();
                            return;
                        }
                    } catch (error) {
                        console.warn('Outseta API call failed, using fallback:', error);
                    }
                }

                // Fallback: Create a temporary anchor element and click it
                // This allows Outseta to intercept the click and show the pop-up
                try {
                    const tempLink = document.createElement('a');
                    tempLink.href = url;
                    tempLink.setAttribute('data-outseta-auth', mode);
                    // Keep it in the DOM but hidden so Outseta can see it
                    tempLink.style.position = 'absolute';
                    tempLink.style.left = '-9999px';
                    tempLink.style.top = '-9999px';
                    tempLink.style.opacity = '0';
                    tempLink.style.pointerEvents = 'none';
                    document.body.appendChild(tempLink);

                    // Force a reflow to ensure element is in DOM
                    void tempLink.offsetHeight;

                    // Use a small delay to ensure Outseta script is ready
                    setTimeout(() => {
                        // Dispatch a native click event that Outseta can intercept
                        const clickEvent = new MouseEvent('click', {
                            view: window,
                            bubbles: true,
                            cancelable: true,
                            buttons: 1
                        });
                        tempLink.dispatchEvent(clickEvent);

                        // Also try the native click method
                        if (document.activeElement !== tempLink) {
                            tempLink.click();
                        }

                        // Clean up after a delay
                        setTimeout(() => {
                            if (document.body.contains(tempLink)) {
                                document.body.removeChild(tempLink);
                            }
                        }, 500);
                    }, 100);
                } catch (error) {
                    console.error('Failed to open Outseta pop-up:', error);
                    // Last resort: direct navigation
                    window.location.href = url;
                }
            }

            // Setup button handlers - convert to anchor behavior for Outseta
            function setupAuthButton(button, isAuth, authMode) {
                if (!button) return;

                // Convert button to anchor-like behavior for Outseta
                button.style.cursor = 'pointer';
                button.setAttribute('role', 'link');

                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();

                    const mode = isAuth ? 'profile' : authMode;
                    openOutsetaAuth(mode);
                });

                // Also add mousedown handler as fallback
                button.addEventListener('mousedown', (e) => {
                    // Prevent default to avoid any button default behavior
                    e.preventDefault();
                });
            }

            if (loginBtn) {
                // If authenticated, button should open profile widget, not login
                const authMode = isUserAuthenticated() ? 'profile' : 'login';
                setupAuthButton(loginBtn, isUserAuthenticated(), authMode);
            }

            if (registerBtn) {
                setupAuthButton(registerBtn, isUserAuthenticated(), 'register');
            }

            // Setup logout button
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();

                    // Confirm logout
                    const confirmLogout = confirm('Are you sure you want to logout?');
                    if (confirmLogout) {
                        logoutUser();
                    }
                });
            }

            if (heroRegisterBtn) {
                setupAuthButton(heroRegisterBtn, false, 'register');
            }

            // Mooring analysis event listeners
            const btnCalc = document.getElementById('btnCalc');
            if (btnCalc) btnCalc.addEventListener('click', (e) => {
                e.preventDefault();
                // Check disclaimer acknowledgment for calculations section
                const acknowledgeCheckbox = document.getElementById('acknowledgeDisclaimer');
                if (acknowledgeCheckbox && !acknowledgeCheckbox.checked) {
                    alert('âš ï¸ Please acknowledge the disclaimer in the Offloading section before running calculations.');
                    return;
                }
                onCalculateMooring();
            });

            const btnTests = document.getElementById('btnTests');
            if (btnTests) btnTests.addEventListener('click', (e) => {
                e.preventDefault();
                // Check disclaimer acknowledgment for calculations section
                const acknowledgeCheckbox = document.getElementById('acknowledgeDisclaimer');
                if (acknowledgeCheckbox && !acknowledgeCheckbox.checked) {
                    alert('âš ï¸ Please acknowledge the disclaimer in the Offloading section before running calculations.');
                    return;
                }
                runMooringTests();
            });

            const btnApplyWI = document.getElementById('btnApplyWI');
            const btnResetWI = document.getElementById('btnResetWI');
            if (btnApplyWI) btnApplyWI.addEventListener('click', (e) => { e.preventDefault(); applyWhatIf(); });
            if (btnResetWI) btnResetWI.addEventListener('click', (e) => { e.preventDefault(); resetWhatIf(); });

            // Slider listeners for what-if panel
            ['wi_diam', 'wi_lines', 'wi_sf'].forEach(id => {
                const el = document.getElementById(id); if (el) el.addEventListener('input', updateWhatIf);
            });

            // Offloading calculation listeners
            const calculateBtn = document.getElementById('calculateBtn');
            const debugBtn = document.getElementById('debugBtn');

            if (calculateBtn) calculateBtn.addEventListener('click', () => {
                // Check disclaimer acknowledgment
                const acknowledgeCheckbox = document.getElementById('acknowledgeDisclaimer');
                if (!acknowledgeCheckbox || !acknowledgeCheckbox.checked) {
                    alert('âš ï¸ Please acknowledge the disclaimer before running calculations.');
                    return;
                }

                console.log('ðŸ“Š Manual calculation triggered');
                runCalc();
                // Add automatic table verification after calculation
                setTimeout(() => {
                    verifyTableAndFix();
                }, 1000);
            });
            if (debugBtn) debugBtn.addEventListener('click', () => {
                // Check disclaimer acknowledgment
                const acknowledgeCheckbox = document.getElementById('acknowledgeDisclaimer');
                if (!acknowledgeCheckbox || !acknowledgeCheckbox.checked) {
                    alert('âš ï¸ Please acknowledge the disclaimer before running calculations.');
                    return;
                }

                console.log('ðŸ” Debug mode activated');
                debugOffloadingTable();
                // Also try emergency update
                setTimeout(() => {
                    emergencyTableUpdate();
                }, 1000);
            });

            // Trigger initial server-side calculations with error handling
            try {
                console.log('Initializing calculations...');
                onCalculateMooring();
                resetWhatIf();

                // Run FLNG calculation after ensuring UI is fully ready
                setTimeout(() => {
                    console.log('ðŸš€ Triggering initial FLNG calculation...');
                    runCalc();
                }, 1000);
            } catch (error) {
                console.error('Initial calculation error:', error);
                // Set fallback values indicating server requirement
                const outEl = document.getElementById('out');
                const recEl = document.getElementById('rec');
                const wiOutEl = document.getElementById('wi_out');
                const testsEl = document.getElementById('tests');

                if (outEl) outEl.textContent = 'Mooring calculations require server connection.';
                if (recEl) recEl.textContent = 'Recommendations require server connection.';
                if (wiOutEl) wiOutEl.textContent = 'What-if analysis requires server connection.';
                if (testsEl) testsEl.textContent = 'Tests require server connection.';
            }
        });

        // Tab and Sub-tab Management System
        let currentMainTab = '';
        const tabContentMapping = {
            'mechanical': {
                name: 'Mechanical Analysis',
                subtabs: {
                    '1': { title: 'AI Elec Motor Centrifugal Compressor Analyzer (TBE & TCs)' },
                    '2': { title: 'GT Rating Estimator' },
                    '3': { title: 'Mechanical Integrity' },
                    '4': { title: 'Centrifugal pump' },
                    '5': { title: 'Maintenance Planning' }
                }
            },
            'process': {
                name: 'Process Analysis',
                subtabs: {
                    '1': { title: 'FLNG Process Sizing Trend Analysis' },
                    '2': { title: 'AI Process Simulation' },
                    '3': { title: 'Heat Exchanger Design' },
                    '4': { title: 'Process Optimization' },
                    '5': { title: 'Process Safety Analysis' }
                }
            },
            'piping': {
                name: 'Piping Analysis',
                subtabs: {
                    '1': { title: 'AI Piping Analysis' },
                    '2': { title: 'Cryogenic Piping Design' },
                    '3': { title: 'Flow Analysis' },
                    '4': { title: 'Piping Layout Optimization' },
                    '5': { title: 'Support Design' }
                }
            },
            'structural': {
                name: 'Structural Analysis',
                subtabs: {
                    '1': { title: 'AI Structural Analysis' },
                    '2': { title: 'Turret & Mooring Analysis' },
                    '3': { title: 'Topside Structure Design' },
                    '4': { title: 'Foundation & Support Systems' },
                    '5': { title: 'Structural Optimization' }
                }
            },
            'power': {
                name: 'Power Analysis',
                subtabs: {
                    '1': { title: 'FLNG Electrical Load Estimator' },
                    '2': { title: 'AI Power Analysis' },
                    '3': { title: 'Distribution System Design' },
                    '4': { title: 'Energy Management' },
                    '5': { title: 'Backup Power Systems' }
                }
            },
            'project': {
                name: 'Project Management',
                subtabs: {
                    '1': { title: 'AI Project Planning & Scheduling' },
                    '2': { title: 'Risk Management' },
                    '3': { title: 'Cost Management' },
                    '4': { title: 'Resource Management' },
                    '5': { title: 'Quality Assurance' }
                }
            }
        };

        // Feature card click handlers
        function initializeTabSystem() {
            const featureCards = document.querySelectorAll('.feature-card[data-tab]');
            featureCards.forEach(card => {
                card.addEventListener('click', () => {
                    const tabId = card.dataset.tab;
                    showSubTabs(tabId);
                });
            });
        }

        function showSubTabs(tabId) {
            currentMainTab = tabId;

            // Hide main content
            document.getElementById('mainContent').classList.add('hidden');

            // Show sub-content section
            document.getElementById('subContent').classList.add('active');

            // Add subtab-mode class to body to hide Engineering Calculations
            document.body.classList.add('subtab-mode');

            // Show and update main tab title
            const mainTabTitle = document.getElementById('mainTabTitle');
            const tabInfo = tabContentMapping[tabId];
            if (tabInfo && mainTabTitle) {
                const titleH2 = mainTabTitle.querySelector('h2');
                const titleP = mainTabTitle.querySelector('p');
                if (titleH2) titleH2.textContent = tabInfo.name;
                if (titleP) {
                    // Add description for each main tab
                    const descriptions = {
                        'mechanical': 'Advanced mechanical system analysis including rotating equipment, vibration, and mechanical integrity assessments.',
                        'process': 'Comprehensive process flow analysis, optimization tools, and performance evaluation for LNG operations.',
                        'piping': 'Detailed piping system design, stress analysis, and flow calculations for cryogenic applications.',
                        'structural': 'Comprehensive structural analysis for hull, turret, and mooring systems under various load cases.',
                        'power': 'Integrated electrical load analysis, power generation optimization, and energy management systems.',
                        'project': 'Comprehensive project planning, scheduling, resource management, and progress tracking tools.'
                    };
                    titleP.textContent = descriptions[tabId] || 'Professional engineering analysis tools.';
                }
                mainTabTitle.style.display = 'block';
            }

            // Clear and populate sub-tabs for the selected main tab
            const subTabsContainer = document.getElementById('subTabs');
            subTabsContainer.innerHTML = '';

            // Generate specific sub-tabs for the selected main tab
            if (tabInfo) {
                Object.keys(tabInfo.subtabs).forEach(subtabKey => {
                    const subtabInfo = tabInfo.subtabs[subtabKey];
                    const subTabElement = document.createElement('div');
                    subTabElement.className = 'sub-tab';
                    subTabElement.dataset.subtab = subtabKey;
                    subTabElement.dataset.main = tabId;
                    subTabElement.textContent = subtabInfo.title;
                    subTabElement.addEventListener('click', () => {
                        showSubPage(tabId, subtabKey);
                    });
                    subTabsContainer.appendChild(subTabElement);
                });
            }

            // Show sub-tabs
            subTabsContainer.style.display = 'flex';

            // Hide all sub-pages
            const subPages = document.querySelectorAll('.sub-page');
            subPages.forEach(page => page.style.display = 'none');

            // Update page title to show current main tab
            if (tabInfo) {
                document.title = `${tabInfo.name} | Murphy's Curves FLNG Engineering Suite`;
            }
        }

        function showSubPage(mainTab, subtabId) {
            // Remove active class from all sub-tabs
            const subTabs = document.querySelectorAll('.sub-tab');
            subTabs.forEach(tab => tab.classList.remove('active'));

            // Add active class to clicked sub-tab
            const activeTab = document.querySelector(`[data-subtab="${subtabId}"][data-main="${mainTab}"]`);
            if (activeTab) activeTab.classList.add('active');

            // Hide all sub-pages
            const subPages = document.querySelectorAll('.sub-page');
            subPages.forEach(page => page.style.display = 'none');

            // Show selected sub-page
            const targetPage = document.getElementById(`${mainTab}-${subtabId}`);
            if (targetPage) {
                targetPage.style.display = 'block';

                // Initialize GT Rating if showing mechanical-2
                if (mainTab === 'mechanical' && subtabId === '2') {
                    setTimeout(() => {
                        initializeGTRating();
                    }, 100);
                }
            }

            // Hide sub-tabs when viewing individual page
            document.getElementById('subTabs').style.display = 'none';
        }

        function returnToMain() {
            // Reset page title
            document.title = "Murphy's Curves | FLNG Engineering Suite";

            // Hide sub-content
            document.getElementById('subContent').classList.remove('active');

            // Show main content
            document.getElementById('mainContent').classList.remove('hidden');

            // Remove subtab-mode class to show Engineering Calculations again
            document.body.classList.remove('subtab-mode');

            // Hide main tab title
            const mainTabTitle = document.getElementById('mainTabTitle');
            if (mainTabTitle) {
                mainTabTitle.style.display = 'none';
            }

            // Reset sub-tab states
            const subTabs = document.querySelectorAll('.sub-tab');
            subTabs.forEach(tab => tab.classList.remove('active'));

            // Hide all sub-pages
            const subPages = document.querySelectorAll('.sub-page');
            subPages.forEach(page => page.style.display = 'none');

            // Hide sub-tabs
            document.getElementById('subTabs').style.display = 'none';

            // Reset current tab
            currentMainTab = '';
        }

        // Make returnToMain available globally
        window.returnToMain = returnToMain;

        // Disclaimer System Implementation
        function initializeDisclaimerSystem() {
            // Get disclaimer elements
            const disclaimerBtn = document.getElementById('disclaimerBtn');
            const disclaimerModal = document.getElementById('disclaimerModal');
            const disclaimerModalClose = document.getElementById('disclaimerModalClose');
            const disclaimerModalOk = document.getElementById('disclaimerModalOk');
            const acknowledgeCheckbox = document.getElementById('acknowledgeDisclaimer');

            // Get calculation elements that need to be disabled/enabled
            const calculateBtn = document.getElementById('calculateBtn');
            const debugBtn = document.getElementById('debugBtn');
            const btnCalc = document.getElementById('btnCalc');
            const btnTests = document.getElementById('btnTests');
            const offloadingContainer = document.querySelector('.offloading-container');
            const mooringCards = document.querySelectorAll('.mooring-card');

            // Check if user has already acknowledged disclaimer
            const hasAcknowledged = localStorage.getItem('murphyCurvesDisclaimerAcknowledged') === 'true';

            // Initialize checkbox state
            if (acknowledgeCheckbox) {
                acknowledgeCheckbox.checked = hasAcknowledged;
                updateCalculationAccess();
            }

            // Disclaimer button click handler
            if (disclaimerBtn) {
                disclaimerBtn.addEventListener('click', () => {
                    if (disclaimerModal) {
                        disclaimerModal.style.display = 'block';
                        document.body.style.overflow = 'hidden'; // Prevent background scrolling
                    }
                });
            }

            // Header disclaimer link button click handler  
            const disclaimerLinkBtn = document.getElementById('disclaimerLinkBtn');
            if (disclaimerLinkBtn) {
                disclaimerLinkBtn.addEventListener('click', () => {
                    if (disclaimerModal) {
                        disclaimerModal.style.display = 'block';
                        document.body.style.overflow = 'hidden'; // Prevent background scrolling
                    }
                });
            }

            // Modal close handlers
            function closeDisclaimerModal() {
                if (disclaimerModal) {
                    disclaimerModal.style.display = 'none';
                    document.body.style.overflow = 'auto'; // Restore scrolling
                }
            }

            if (disclaimerModalClose) {
                disclaimerModalClose.addEventListener('click', closeDisclaimerModal);
            }

            if (disclaimerModalOk) {
                disclaimerModalOk.addEventListener('click', closeDisclaimerModal);
            }

            // Close modal when clicking outside
            if (disclaimerModal) {
                disclaimerModal.addEventListener('click', (e) => {
                    if (e.target === disclaimerModal) {
                        closeDisclaimerModal();
                    }
                });
            }

            // Acknowledge checkbox handler
            if (acknowledgeCheckbox) {
                acknowledgeCheckbox.addEventListener('change', (e) => {
                    const isChecked = e.target.checked;

                    // Save acknowledgment state
                    localStorage.setItem('murphyCurvesDisclaimerAcknowledged', isChecked.toString());

                    // Update calculation access
                    updateCalculationAccess();

                    // Show confirmation message
                    if (isChecked) {
                        showNotification('âœ… Disclaimer acknowledged. Calculations enabled.', 'success');
                    } else {
                        showNotification('âš ï¸ Disclaimer acknowledgment removed. Calculations disabled.', 'warning');
                    }
                });
            }

            function updateCalculationAccess() {
                const isAcknowledged = acknowledgeCheckbox ? acknowledgeCheckbox.checked : false;

                // Enable/disable offloading calculations
                if (calculateBtn) {
                    calculateBtn.disabled = !isAcknowledged;
                }
                if (debugBtn) {
                    debugBtn.disabled = !isAcknowledged;
                }

                // Enable/disable mooring calculations
                if (btnCalc) {
                    btnCalc.disabled = !isAcknowledged;
                }
                if (btnTests) {
                    btnTests.disabled = !isAcknowledged;
                }

                // Add/remove disabled class from containers
                if (offloadingContainer) {
                    if (isAcknowledged) {
                        offloadingContainer.classList.remove('calculation-disabled');
                    } else {
                        offloadingContainer.classList.add('calculation-disabled');
                    }
                }

                // Disable mooring calculation cards
                mooringCards.forEach(card => {
                    if (isAcknowledged) {
                        card.classList.remove('calculation-disabled');
                    } else {
                        card.classList.add('calculation-disabled');
                    }
                });
            }

            function showNotification(message, type) {
                const notification = document.createElement('div');
                notification.innerHTML = message;
                notification.style.cssText = `
                    position: fixed; top: 20px; right: 20px; z-index: 9999;
                    background: ${type === 'success' ? '#28a745' : '#ffc107'};
                    color: ${type === 'success' ? 'white' : '#212529'};
                    padding: 15px 20px; border-radius: 5px; font-weight: bold;
                    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                    max-width: 300px; word-wrap: break-word;
                `;
                document.body.appendChild(notification);
                setTimeout(() => notification.remove(), 4000);
            }

            // Initial setup
            updateCalculationAccess();
        }

        // --- PUMP SIZING SYSTEM ---
        let pumpPerformanceChart = null;
        let pumpViscousChart = null;

        function initializePumpSystem() {
            console.log('ðŸ”§ Initializing Pump Sizing System');

            // Tab functionality
            const pumpTabs = document.querySelectorAll('.pump-tab');
            const pumpTabContents = document.querySelectorAll('.pump-tab-content');

            pumpTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');

                    pumpTabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    pumpTabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === `pump-${tabId}`) {
                            content.classList.add('active');
                        }
                    });

                    // Update charts when switching tabs
                    if (tabId === 'performance-curve') {
                        setTimeout(() => updatePumpPerformanceChart(), 100);
                    } else if (tabId === 'viscous-correction') {
                        setTimeout(() => updatePumpViscousChart(), 100);
                    }
                });
            });

            // Calculate button
            const calculateBtn = document.getElementById('pump-calculate-btn');
            if (calculateBtn) {
                calculateBtn.addEventListener('click', calculatePumpPerformance);
            }
        }

        async function calculatePumpPerformance() {
            console.log('ðŸ”„ Starting pump performance calculation');

            // Check authentication first
            if (!requireAuthentication()) {
                return;
            }

            // Check disclaimer acknowledgment
            const acknowledgeCheckbox = document.getElementById('acknowledgeDisclaimer');
            if (!acknowledgeCheckbox || !acknowledgeCheckbox.checked) {
                alert('âš ï¸ Please acknowledge the disclaimer before running pump calculations.');
                return;
            }

            const calculateBtn = document.getElementById('pump-calculate-btn');
            if (calculateBtn) {
                calculateBtn.disabled = true;
                calculateBtn.textContent = 'Calculating...';
            }

            try {
                // Collect input data
                const inputData = {
                    n: parseFloat(document.getElementById('pump-n').value),
                    q: parseFloat(document.getElementById('pump-q').value),
                    tdhm: parseFloat(document.getElementById('pump-tdhm').value),
                    npsha: parseFloat(document.getElementById('pump-npsha').value),
                    suctype: parseFloat(document.getElementById('pump-suctype').value),
                    sg: parseFloat(document.getElementById('pump-sg').value),
                    num_impellers: parseFloat(document.getElementById('pump-num_impellers').value),
                    viscosity: parseFloat(document.getElementById('pump-viscosity').value)
                };

                console.log('ðŸ“¤ Sending pump data to server:', inputData);

                // Call backend API
                const response = await fetch('/.netlify/functions/pump', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(inputData)
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }

                const result = await response.json();
                console.log('ðŸ“¥ Received pump calculation results:', result);

                // Update output displays
                updatePumpOutputs(result);

                // Update charts if visible
                setTimeout(() => {
                    updatePumpPerformanceChart();
                    updatePumpViscousChart();
                }, 100);

            } catch (error) {
                console.error('âŒ Pump calculation error:', error);
                showPumpError(error.message);
            } finally {
                if (calculateBtn) {
                    calculateBtn.disabled = false;
                    calculateBtn.textContent = 'Calculate Pump Performance';
                }
            }
        }

        function updatePumpOutputs(result) {
            console.log('ðŸ“Š Updating pump output displays');

            // Update basic outputs
            document.getElementById('pump-efficiency').textContent = result.efficiency;
            document.getElementById('pump-uns').textContent = result.uns;
            document.getElementById('pump-ns').textContent = result.ns;
            document.getElementById('pump-unss').textContent = result.unss;
            document.getElementById('pump-nss').textContent = result.nss;
            document.getElementById('pump-phi').textContent = result.phi;
            document.getElementById('pump-angvel').textContent = result.angvel;
            document.getElementById('pump-tipspeed').textContent = result.tipspeed;
            document.getElementById('pump-impdia').textContent = result.impdia;
            document.getElementById('pump-headstage').textContent = result.headstage;
            document.getElementById('pump-hydpower').textContent = result.hydpower;
            document.getElementById('pump-reynolds').textContent = result.reynolds;
            document.getElementById('pump-nstatus').innerHTML = `${result.nstatus} <span class="status-indicator">${result.statusText}</span>`;

            // Update viscous correction factors
            document.getElementById('pump-cq').textContent = result.cq;
            document.getElementById('pump-ch').textContent = result.ch;
            document.getElementById('pump-ce').textContent = result.ce;

            // Update warnings
            updatePumpWarnings(result.warnings);

            // Update new pump performance section
            updateNewPumpPerformance(result.newPumpPerformance);

            // Store result globally for charts
            window.pumpResult = result;
        }

        function updatePumpWarnings(warnings) {
            const container = document.getElementById('pump-warnings-container');
            container.innerHTML = '';

            if (warnings.length === 0) {
                container.innerHTML = '<div class="warning-item no-warnings">No warnings - all parameters within normal ranges</div>';
            } else {
                warnings.forEach(warning => {
                    const warningElement = document.createElement('div');
                    warningElement.className = `warning-item ${warning.critical ? 'critical' : ''}`;
                    warningElement.textContent = warning.text;
                    container.appendChild(warningElement);
                });
            }
        }

        function updateNewPumpPerformance(newPumpPerformance) {
            const section = document.getElementById('pump-new-performance-section');

            if (newPumpPerformance) {
                document.getElementById('pump-np-flow').textContent = newPumpPerformance.flow;
                document.getElementById('pump-np-head').textContent = newPumpPerformance.head;
                document.getElementById('pump-np-ns').textContent = newPumpPerformance.ns;
                document.getElementById('pump-np-impdia').textContent = newPumpPerformance.impdia;
                document.getElementById('pump-np-npsh').textContent = newPumpPerformance.npsh;
                document.getElementById('pump-np-speed').textContent = newPumpPerformance.speed;
                document.getElementById('pump-np-efficiency').textContent = newPumpPerformance.efficiency;
                document.getElementById('pump-np-hydpower').textContent = newPumpPerformance.hydpower;
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        }

        function updatePumpPerformanceChart() {
            if (!window.pumpResult || !window.pumpResult.performanceData) {
                console.log('No pump performance data available for chart');
                return;
            }

            const canvas = document.getElementById('pump-performanceChart');
            if (!canvas) return;

            const data = window.pumpResult.performanceData;
            const Q = parseFloat(document.getElementById('pump-q').value);
            const TDHm = parseFloat(document.getElementById('pump-tdhm').value);

            if (pumpPerformanceChart) {
                pumpPerformanceChart.destroy();
            }

            const ctx = canvas.getContext('2d');
            pumpPerformanceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Head (m)',
                            data: data.flowPoints.map((q, i) => ({ x: q, y: data.headPoints[i] })),
                            borderColor: 'rgba(88, 166, 255, 1)',
                            backgroundColor: 'rgba(88, 166, 255, 0.2)',
                            yAxisID: 'y',
                            tension: 0.1,
                            borderWidth: 2
                        },
                        {
                            label: 'Efficiency (%)',
                            data: data.flowPoints.map((q, i) => ({ x: q, y: data.efficiencyPoints[i] })),
                            borderColor: 'rgba(128, 255, 128, 1)',
                            backgroundColor: 'rgba(128, 255, 128, 0.2)',
                            yAxisID: 'y1',
                            tension: 0.1,
                            borderWidth: 2
                        },
                        {
                            label: 'Power (kW)',
                            data: data.flowPoints.map((q, i) => ({ x: q, y: data.powerPoints[i] })),
                            borderColor: 'rgba(255, 128, 128, 1)',
                            backgroundColor: 'rgba(255, 128, 128, 0.2)',
                            yAxisID: 'y2',
                            tension: 0.1,
                            borderWidth: 2
                        },
                        {
                            label: 'NPSHr (m)',
                            data: data.flowPoints.map((q, i) => ({ x: q, y: data.npshPoints[i] })),
                            borderColor: 'rgba(255, 255, 128, 1)',
                            backgroundColor: 'rgba(255, 255, 128, 0.2)',
                            yAxisID: 'y3',
                            tension: 0.1,
                            borderWidth: 2
                        },
                        {
                            label: 'Operating Point',
                            data: [{ x: Q, y: TDHm }],
                            backgroundColor: 'rgba(255, 215, 0, 0.8)',
                            borderColor: 'rgba(255, 165, 0, 1)',
                            pointRadius: 8,
                            pointHoverRadius: 10,
                            showLine: false,
                            yAxisID: 'y'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            title: {
                                display: true,
                                text: 'Flow Rate (mÂ³/hr)',
                                color: '#8b949e'
                            },
                            grid: { color: 'rgba(139, 148, 158, 0.1)' },
                            ticks: { color: '#c9d1d9' }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'Head (m)',
                                color: '#58a6ff'
                            },
                            grid: { color: 'rgba(88, 166, 255, 0.1)' },
                            ticks: { color: '#c9d1d9' }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Efficiency (%)',
                                color: '#80ff80'
                            },
                            grid: { drawOnChartArea: false },
                            ticks: { color: '#c9d1d9' }
                        },
                        y2: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'Power (kW)',
                                color: '#ff8080'
                            },
                            grid: { drawOnChartArea: false },
                            ticks: { color: '#c9d1d9' }
                        },
                        y3: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'NPSHr (m)',
                                color: '#ffff80'
                            },
                            grid: { drawOnChartArea: false },
                            ticks: { color: '#c9d1d9' }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: `Performance Curve (${window.pumpResult.nstatus})`,
                            color: '#c9d1d9'
                        },
                        legend: {
                            labels: { color: '#c9d1d9' }
                        }
                    }
                }
            });

            // Update performance table
            updatePumpPerformanceTable();
        }

        function updatePumpPerformanceTable() {
            if (!window.pumpResult || !window.pumpResult.performanceData) return;

            const table = document.getElementById('pump-performanceTable');
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = '';

            const data = window.pumpResult.performanceData;
            const Q = parseFloat(document.getElementById('pump-q').value);

            data.flowPoints.forEach((flow, i) => {
                const row = document.createElement('tr');
                const flowPercentage = (flow / Q) * 100;

                row.innerHTML = `
                    <td>${flow.toFixed(1)}</td>
                    <td>${data.headPoints[i].toFixed(1)}</td>
                    <td>${data.efficiencyPoints[i].toFixed(1)}</td>
                    <td>${data.npshPoints[i].toFixed(2)}</td>
                    <td>${data.powerPoints[i].toFixed(1)}</td>
                `;

                if (flowPercentage.toFixed(0) === '100') {
                    row.style.backgroundColor = 'rgba(255, 215, 0, 0.2)';
                    row.style.fontWeight = 'bold';
                }

                tbody.appendChild(row);
            });
        }

        function updatePumpViscousChart() {
            const canvas = document.getElementById('pump-viscousChart');
            if (!canvas) return;

            if (pumpViscousChart) {
                pumpViscousChart.destroy();
            }

            // Generate viscous correction data
            const reValues = [10, 100, 1000, 10000, 100000, 1000000, 10000000];
            const cqValues = reValues.map(() => 1.0); // CQ always 1
            const chValues = reValues.map(re => {
                const ch_a = 1.004, ch_b = 1.391, ch_c = 0.394, ch_d = 0.233;
                return ch_a - ch_b * Math.exp(-ch_c * Math.pow(re, ch_d));
            });
            const ceValues = reValues.map(re => {
                const ce_a = 1.016, ce_b = 2.848, ce_c = 0.369, ce_d = 0.204;
                return ce_a - ce_b * Math.exp(-ce_c * Math.pow(re, ce_d));
            });

            const ctx = canvas.getContext('2d');
            pumpViscousChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: reValues,
                    datasets: [
                        {
                            label: 'CQ (Flow Correction)',
                            data: cqValues,
                            borderColor: 'rgba(88, 166, 255, 1)',
                            backgroundColor: 'rgba(88, 166, 255, 0.2)',
                            tension: 0.3
                        },
                        {
                            label: 'CH (Head Correction)',
                            data: chValues,
                            borderColor: 'rgba(128, 255, 128, 1)',
                            backgroundColor: 'rgba(128, 255, 128, 0.2)',
                            tension: 0.3
                        },
                        {
                            label: 'CE (Efficiency Correction)',
                            data: ceValues,
                            borderColor: 'rgba(255, 128, 128, 1)',
                            backgroundColor: 'rgba(255, 128, 128, 0.2)',
                            tension: 0.3
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'logarithmic',
                            title: {
                                display: true,
                                text: 'Reynolds Number (Log Scale)',
                                color: '#8b949e'
                            },
                            ticks: { color: '#c9d1d9' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Correction Factor',
                                color: '#8b949e'
                            },
                            min: 0,
                            max: 1.2,
                            ticks: { color: '#c9d1d9' }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Viscous Correction Factors',
                            color: '#c9d1d9'
                        },
                        legend: {
                            labels: { color: '#c9d1d9' }
                        }
                    }
                }
            });

            // Update viscous corrected table
            updatePumpViscousCorrectedTable();
        }

        function updatePumpViscousCorrectedTable() {
            if (!window.pumpResult || !window.pumpResult.performanceData) return;

            const table = document.getElementById('pump-viscousCorrectedTable');
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = '';

            const data = window.pumpResult.performanceData;
            const { ch, ce } = window.pumpResult;
            const sg = parseFloat(document.getElementById('pump-sg').value);
            const Q = parseFloat(document.getElementById('pump-q').value);

            data.flowPoints.forEach((flow, i) => {
                const correctedHead = data.headPoints[i] / ch;
                const correctedEfficiency = Math.max(0, Math.min(100, data.efficiencyPoints[i] * ce));
                const correctedPower = flow === 0
                    ? data.powerPoints[i] * 0.9
                    : (flow * correctedHead * sg) / (367.63 * (correctedEfficiency / 100 || 0.01));

                const row = document.createElement('tr');
                const flowPercentage = (flow / Q) * 100;

                row.innerHTML = `
                    <td>${flow.toFixed(1)}</td>
                    <td>${correctedHead.toFixed(1)}</td>
                    <td>${correctedEfficiency.toFixed(1)}</td>
                    <td>${Math.max(0, correctedPower).toFixed(1)}</td>
                `;

                if (flowPercentage.toFixed(0) === '100') {
                    row.style.backgroundColor = 'rgba(255, 215, 0, 0.2)';
                    row.style.fontWeight = 'bold';
                }

                tbody.appendChild(row);
            });
        }

        function showPumpError(message) {
            const warningsContainer = document.getElementById('pump-warnings-container');
            warningsContainer.innerHTML = `
                <div class="warning-item critical">
                    âŒ Calculation Error: ${message}
                    <br>Please check your input values and try again.
                </div>
            `;
        }

        // --- FLNG ELECTRICAL ESTIMATOR SYSTEM ---
        let flngTrendChart = null;

        function initializeFLNGElectricalSystem() {
            console.log('âš¡ Initializing FLNG Electrical Load Estimator');

            // Calculate button
            const calculateBtn = document.getElementById('flng-calculate-btn');
            if (calculateBtn) {
                calculateBtn.addEventListener('click', calculateFLNGElectrical);
            }

            // Input change handlers for real-time updates
            const inputs = [
                'flng-mtpa', 'flng-pf', 'flng-scenario', 'flng-driver',
                'flng-growth', 'flng-reserve', 'flng-nplus1', 'flng-plotMetric',
                'flng-mtpaMin', 'flng-mtpaMax', 'flng-unitA', 'flng-unitB',
                'flng-unitC', 'flng-unitD', 'flng-unitE'
            ];

            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', calculateFLNGElectrical);
                }
            });

            // Initialize chart
            setTimeout(() => initializeFLNGChart(), 100);

            // Initial calculation
            calculateFLNGElectrical();
        }

        function initializeFLNGChart() {
            const canvas = document.getElementById('flng-trend');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            flngTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Aux-Only â€” Normal',
                            data: [],
                            borderWidth: 2,
                            tension: 0.25,
                            borderColor: '#5ac8fa',
                            pointRadius: 0,
                            fill: false
                        },
                        {
                            label: 'Aux-Only â€” Normal+Offloading',
                            data: [],
                            borderWidth: 2,
                            tension: 0.25,
                            borderColor: '#a3ffb0',
                            pointRadius: 0,
                            fill: false
                        },
                        {
                            label: 'E-Drive â€” Normal',
                            data: [],
                            borderWidth: 2,
                            tension: 0.25,
                            borderColor: '#ffd166',
                            pointRadius: 0,
                            fill: false
                        },
                        {
                            label: 'E-Drive â€” Normal+Offloading',
                            data: [],
                            borderWidth: 2,
                            tension: 0.25,
                            borderColor: '#ff6b6b',
                            pointRadius: 0,
                            fill: false
                        },
                        {
                            label: 'Your Design Point',
                            data: [],
                            type: 'scatter',
                            borderWidth: 0,
                            pointRadius: 5,
                            pointBackgroundColor: '#cccccc',
                            showLine: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    parsing: false,
                    scales: {
                        x: {
                            type: 'linear',
                            title: {
                                display: true,
                                text: 'Plant Capacity (MTPA)',
                                color: '#cfd9e6'
                            },
                            grid: { color: 'rgba(255,255,255,0.08)' },
                            ticks: { color: '#cfd9e6' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Estimated Electrical Load (kW)',
                                color: '#cfd9e6'
                            },
                            grid: { color: 'rgba(255,255,255,0.08)' },
                            ticks: { color: '#cfd9e6' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#cfd9e6' }
                        }
                    }
                }
            });
        }

        async function calculateFLNGElectrical() {
            console.log('âš¡ Starting FLNG electrical calculation');

            // Check authentication first
            if (!requireAuthentication()) {
                return;
            }

            // Check disclaimer acknowledgment
            const acknowledgeCheckbox = document.getElementById('acknowledgeDisclaimer');
            if (!acknowledgeCheckbox || !acknowledgeCheckbox.checked) {
                // Don't show alert for automatic calculations, just disable features
                updateFLNGDisplays(null);
                return;
            }

            const calculateBtn = document.getElementById('flng-calculate-btn');
            if (calculateBtn) {
                calculateBtn.disabled = true;
                calculateBtn.textContent = 'Calculating...';
            }

            try {
                // Collect input data
                const inputData = {
                    mtpa: parseFloat(document.getElementById('flng-mtpa').value) || 2.4,
                    pf: parseFloat(document.getElementById('flng-pf').value) || 0.895,
                    scenario: document.getElementById('flng-scenario').value,
                    driver: document.getElementById('flng-driver').value,
                    growth: parseFloat(document.getElementById('flng-growth').value) || 15,
                    reserve: parseFloat(document.getElementById('flng-reserve').value) || 10,
                    nplus1: document.getElementById('flng-nplus1').checked,
                    plotMetric: document.getElementById('flng-plotMetric').value,
                    mtpaMin: parseFloat(document.getElementById('flng-mtpaMin').value) || 1.0,
                    mtpaMax: parseFloat(document.getElementById('flng-mtpaMax').value) || 3.0,
                    unitA: parseFloat(document.getElementById('flng-unitA').value) || 19007,
                    unitB: parseFloat(document.getElementById('flng-unitB').value) || 18211,
                    unitC: parseFloat(document.getElementById('flng-unitC').value) || 35104,
                    unitD: parseFloat(document.getElementById('flng-unitD').value) || 34873,
                    unitE: parseFloat(document.getElementById('flng-unitE').value) || 31671
                };

                console.log('ðŸ“¤ Sending FLNG electrical data to server:', inputData);

                // Call backend API
                const response = await fetch('/.netlify/functions/electrical', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(inputData)
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }

                const result = await response.json();
                console.log('ðŸ“¥ Received FLNG electrical calculation results:', result);

                // Update displays
                updateFLNGDisplays(result);

            } catch (error) {
                console.error('âŒ FLNG electrical calculation error:', error);
                showFLNGError(error.message);
            } finally {
                if (calculateBtn) {
                    calculateBtn.disabled = false;
                    calculateBtn.textContent = 'Calculate Electrical Load';
                }
            }
        }

        function updateFLNGDisplays(result) {
            console.log('ðŸ“Š Updating FLNG electrical displays');

            if (!result) {
                // Clear displays when no result
                document.getElementById('flng-kWbase').textContent = 'â€“';
                document.getElementById('flng-kVAreq').textContent = 'â€“';
                document.getElementById('flng-pfmarg').textContent = 'â€“';

                // Clear coefficients
                document.getElementById('flng-coefANa').textContent = 'â€“';
                document.getElementById('flng-coefANb').textContent = 'â€“';
                document.getElementById('flng-coefAOa').textContent = 'â€“';
                document.getElementById('flng-coefAOb').textContent = 'â€“';
                document.getElementById('flng-coefEN').textContent = 'â€“';
                document.getElementById('flng-coefEO').textContent = 'â€“';

                // Clear generator data
                ['A', 'B', 'C', 'D', 'E'].forEach(option => {
                    document.getElementById(`flng-${option}_unit`).textContent = 'â€“';
                    document.getElementById(`flng-${option}_run`).textContent = 'â€“';
                    document.getElementById(`flng-${option}_total`).textContent = 'â€“';
                    document.getElementById(`flng-${option}_load`).textContent = 'â€“';
                });
                return;
            }

            // Update KPIs
            document.getElementById('flng-kWbase').textContent = result.kW_base.toLocaleString(undefined, { maximumFractionDigits: 1 });
            document.getElementById('flng-kVAreq').textContent = result.kVA_req.toLocaleString(undefined, { maximumFractionDigits: 1 });
            document.getElementById('flng-pfmarg').textContent = result.pfmarg;

            // Update coefficients
            document.getElementById('flng-coefANa').textContent = result.coefficients.a_norm.toLocaleString(undefined, { maximumFractionDigits: 1 });
            document.getElementById('flng-coefANb').textContent = result.coefficients.b_norm.toLocaleString(undefined, { maximumFractionDigits: 1 });
            document.getElementById('flng-coefAOa').textContent = result.coefficients.a_off.toLocaleString(undefined, { maximumFractionDigits: 1 });
            document.getElementById('flng-coefAOb').textContent = result.coefficients.b_off.toLocaleString(undefined, { maximumFractionDigits: 1 });
            document.getElementById('flng-coefEN').textContent = result.coefficients.e_norm.toLocaleString();
            document.getElementById('flng-coefEO').textContent = result.coefficients.e_off.toLocaleString();

            // Update generator data
            ['A', 'B', 'C', 'D', 'E'].forEach(option => {
                const gen = result.generators[option];
                document.getElementById(`flng-${option}_unit`).textContent = gen.unit.toLocaleString();
                document.getElementById(`flng-${option}_run`).textContent = gen.running;
                document.getElementById(`flng-${option}_total`).textContent = gen.total;
                document.getElementById(`flng-${option}_load`).textContent = gen.loading + '%';
            });

            // Update chart
            updateFLNGChart(result.chartData);
        }

        function updateFLNGChart(chartData) {
            if (!flngTrendChart || !chartData) return;

            // Update chart data
            flngTrendChart.data.datasets[0].data = chartData.auxNorm;
            flngTrendChart.data.datasets[1].data = chartData.auxOff;
            flngTrendChart.data.datasets[2].data = chartData.eNorm;
            flngTrendChart.data.datasets[3].data = chartData.eOff;
            flngTrendChart.data.datasets[4].data = [chartData.designPoint];

            // Update Y-axis label
            flngTrendChart.options.scales.y.title.text = chartData.yAxisLabel;

            // Update chart
            flngTrendChart.update();
        }

        function showFLNGError(message) {
            console.error('FLNG Error:', message);
            // Show error in KPIs section
            document.getElementById('flng-kWbase').textContent = 'Error';
            document.getElementById('flng-kVAreq').textContent = 'Error';
            document.getElementById('flng-pfmarg').textContent = 'Error';
        }

        // --- FLNG PROCESS SIZING SYSTEM ---
        let flngProcessChart = null;

        function initializeFLNGProcessSystem() {
            console.log('ðŸ­ Initializing FLNG Process Sizing System');

            // Calculate button
            const calculateBtn = document.getElementById('flng-process-calculate-btn');
            if (calculateBtn) {
                calculateBtn.addEventListener('click', calculateFLNGProcess);
            }

            // Input change handlers for capacity slider
            const capSlider = document.getElementById('flng-cap');
            if (capSlider) {
                capSlider.addEventListener('input', () => {
                    document.getElementById('flng-capVal').textContent = Number(capSlider.value).toFixed(1);
                });
            }

            // Basis change handler
            const basisSelect = document.getElementById('flng-basis');
            if (basisSelect) {
                basisSelect.addEventListener('change', loadFLNGBasis);
            }

            // BOG scenario change handler
            const bogScenarioSelect = document.getElementById('flng-bog_scn');
            if (bogScenarioSelect) {
                bogScenarioSelect.addEventListener('change', updateBOGValue);
            }

            // Composition change handlers
            const compInputs = ['flng-x_CH4', 'flng-x_C2', 'flng-x_C3', 'flng-x_C4', 'flng-x_C5p', 'flng-x_N2', 'flng-x_CO2'];
            compInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updateFLNGCompTotal);
                }
            });

            // Initialize chart
            setTimeout(() => initializeFLNGProcessChart(), 100);

            // Initialize display
            updateFLNGCompTotal();
            document.getElementById('flng-capVal').textContent = Number(document.getElementById('flng-cap').value).toFixed(1);
        }

        function loadFLNGBasis() {
            const basis = document.getElementById('flng-basis').value;
            const defaults = {
                onefive: { P1_FG_bara: 38.84, T1_FG_C: 31.05, P2_FG_bara: 85.67, P1_BOG_bara: 1.1185, T1_BOG_C: -130.0, P2_BOG_bara: 56.16 },
                twofour: { P1_FG_bara: 39.42, T1_FG_C: 41.00, P2_FG_bara: 85.67, P1_BOG_bara: 1.1185, T1_BOG_C: -130.0, P2_BOG_bara: 40.00 }
            };

            if (basis === 'onefive' || basis === 'twofour') {
                const d = (basis === 'onefive') ? defaults.onefive : defaults.twofour;
                document.getElementById('flng-P1_FG').value = d.P1_FG_bara.toFixed(2);
                document.getElementById('flng-T1_FG').value = d.T1_FG_C.toFixed(2);
                document.getElementById('flng-P2_FG').value = d.P2_FG_bara.toFixed(2);
                document.getElementById('flng-P1_BOG').value = d.P1_BOG_bara.toFixed(4);
                document.getElementById('flng-T1_BOG').value = d.T1_BOG_C.toFixed(1);
                document.getElementById('flng-P2_BOG').value = d.P2_BOG_bara.toFixed(2);
            }
        }

        function updateBOGValue() {
            const scenario = document.getElementById('flng-bog_scn').value;
            const bogValues = {
                base: 0.12,
                hot: 0.3,
                loading: 1.5,
                holding: 9.0
            };

            if (bogValues[scenario] !== undefined) {
                document.getElementById('flng-f_BOG').value = bogValues[scenario];
            }
        }

        function updateFLNGCompTotal() {
            const inputs = ['flng-x_CH4', 'flng-x_C2', 'flng-x_C3', 'flng-x_C4', 'flng-x_C5p', 'flng-x_N2', 'flng-x_CO2'];
            let total = 0;
            inputs.forEach(id => {
                const value = parseFloat(document.getElementById(id).value) || 0;
                total += value;
            });

            const totalElement = document.getElementById('flng-comp_total');
            if (totalElement) {
                totalElement.textContent = total.toFixed(2);
                totalElement.style.color = (total > 100.01) ? '#ef4444' : '#e7eaf0';
            }
        }

        function initializeFLNGProcessChart() {
            const canvas = document.getElementById('flng-process-trend');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            flngProcessChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [
                        {
                            label: 'Refrig MW_e',
                            data: [],
                            borderColor: 'rgba(88, 166, 255, 1)',
                            backgroundColor: 'rgba(88, 166, 255, 0.2)',
                            tension: 0.1,
                            borderWidth: 2
                        },
                        {
                            label: 'FG comp MW_e',
                            data: [],
                            borderColor: 'rgba(128, 255, 128, 1)',
                            backgroundColor: 'rgba(128, 255, 128, 0.2)',
                            tension: 0.1,
                            borderWidth: 2
                        },
                        {
                            label: 'BOG comp MW_e',
                            data: [],
                            borderColor: 'rgba(255, 128, 128, 1)',
                            backgroundColor: 'rgba(255, 128, 128, 0.2)',
                            tension: 0.1,
                            borderWidth: 2
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            title: {
                                display: true,
                                text: 'Capacity (MTPA)',
                                color: '#cfd9e6'
                            },
                            grid: { color: 'rgba(255,255,255,0.08)' },
                            ticks: { color: '#cfd9e6' }
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Power (MW)',
                                color: '#cfd9e6'
                            },
                            grid: { color: 'rgba(255,255,255,0.08)' },
                            ticks: { color: '#cfd9e6' }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: { color: '#cfd9e6' }
                        }
                    }
                }
            });
        }

        async function calculateFLNGProcess() {
            console.log('ðŸ­ Starting FLNG process sizing calculation');

            // Check disclaimer acknowledgment
            const acknowledgeCheckbox = document.getElementById('acknowledgeDisclaimer');
            if (!acknowledgeCheckbox || !acknowledgeCheckbox.checked) {
                alert('âš ï¸ Please acknowledge the disclaimer before running FLNG process calculations.');
                return;
            }

            const calculateBtn = document.getElementById('flng-process-calculate-btn');
            if (calculateBtn) {
                calculateBtn.disabled = true;
                calculateBtn.textContent = 'Calculating...';
            }

            try {
                // Collect input data
                const inputData = {
                    MTPA: parseFloat(document.getElementById('flng-cap').value),
                    AVAIL: parseFloat(document.getElementById('flng-AVAIL').value),
                    OP_FRAC: parseFloat(document.getElementById('flng-OP_FRAC').value),
                    T_AIR: parseFloat(document.getElementById('flng-T_AIR').value),
                    T_SW: parseFloat(document.getElementById('flng-T_SW').value),
                    Y_L: document.getElementById('flng-Y_L').value ? parseFloat(document.getElementById('flng-Y_L').value) : null,
                    f_BOG: parseFloat(document.getElementById('flng-f_BOG').value),
                    scheme: document.getElementById('flng-scheme').value,
                    r_MR_SMR: parseFloat(document.getElementById('flng-r_MR_SMR').value),
                    r_MR_C3MR: parseFloat(document.getElementById('flng-r_MR_C3MR').value),
                    r_C3: parseFloat(document.getElementById('flng-r_C3').value),
                    SP_LNG_SMR: parseFloat(document.getElementById('flng-SP_LNG_SMR').value),
                    SP_LNG_C3MR: parseFloat(document.getElementById('flng-SP_LNG_C3MR').value),
                    M_flow: parseFloat(document.getElementById('flng-M_flow').value),
                    M_power: parseFloat(document.getElementById('flng-M_power').value),
                    P1_MR_LP: parseFloat(document.getElementById('flng-P1_MR_LP').value),
                    P2_MR_LP: parseFloat(document.getElementById('flng-P2_MR_LP').value),
                    P1_MR_HP: parseFloat(document.getElementById('flng-P1_MR_HP').value),
                    P2_MR_HP: parseFloat(document.getElementById('flng-P2_MR_HP').value),
                    P1_C3_LP: parseFloat(document.getElementById('flng-P1_C3_LP').value),
                    P2_C3_LP: parseFloat(document.getElementById('flng-P2_C3_LP').value),
                    P1_C3_HP: parseFloat(document.getElementById('flng-P1_C3_HP').value),
                    P2_C3_HP: parseFloat(document.getElementById('flng-P2_C3_HP').value),
                    P1_FG: parseFloat(document.getElementById('flng-P1_FG').value),
                    T1_FG: parseFloat(document.getElementById('flng-T1_FG').value),
                    P2_FG: parseFloat(document.getElementById('flng-P2_FG').value),
                    P1_BOG: parseFloat(document.getElementById('flng-P1_BOG').value),
                    T1_BOG: parseFloat(document.getElementById('flng-T1_BOG').value),
                    P2_BOG: parseFloat(document.getElementById('flng-P2_BOG').value),
                    etaP_FG: parseFloat(document.getElementById('flng-etaP_FG').value) || 0.86,
                    etaP_BOG: parseFloat(document.getElementById('flng-etaP_BOG').value) || 0.75,
                    H_stage: parseFloat(document.getElementById('flng-H_stage').value) || 200,
                    composition: {
                        CH4: parseFloat(document.getElementById('flng-x_CH4').value),
                        C2: parseFloat(document.getElementById('flng-x_C2').value),
                        C3: parseFloat(document.getElementById('flng-x_C3').value),
                        C4: parseFloat(document.getElementById('flng-x_C4').value),
                        C5p: parseFloat(document.getElementById('flng-x_C5p').value),
                        N2: parseFloat(document.getElementById('flng-x_N2').value),
                        CO2: parseFloat(document.getElementById('flng-x_CO2').value)
                    },
                    CW_m3h_per_MWth: parseFloat(document.getElementById('flng-CW_m3h_per_MWth').value) || 60,
                    HO_kW_per_tph: parseFloat(document.getElementById('flng-HO_kW_per_tph').value) || 15,
                    IA_Nm3h_per_MWe: parseFloat(document.getElementById('flng-IA_Nm3h_per_MWe').value) || 8,
                    N2_Nm3h_per_tph: parseFloat(document.getElementById('flng-N2_Nm3h_per_tph').value) || 2,
                    Flare_pct: parseFloat(document.getElementById('flng-Flare_pct').value) || 0.10,
                    R_C3_LPG: parseFloat(document.getElementById('flng-R_C3_LPG').value) || 85,
                    R_C4_LPG: parseFloat(document.getElementById('flng-R_C4_LPG').value) || 95,
                    R_C5_COND: parseFloat(document.getElementById('flng-R_C5_COND').value) || 95,
                    prop_basis: document.getElementById('flng-prop_basis').value || 'auto'
                };

                console.log('ðŸ“¤ Sending FLNG process data to server:', inputData);

                // Call backend API
                const response = await fetch('/.netlify/functions/flng-sizing', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(inputData)
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }

                const result = await response.json();
                console.log('ðŸ“¥ Received FLNG process calculation results:', result);

                // Update displays
                updateFLNGProcessDisplays(result);

            } catch (error) {
                console.error('âŒ FLNG process calculation error:', error);
                showFLNGProcessError(error.message);
            } finally {
                if (calculateBtn) {
                    calculateBtn.disabled = false;
                    calculateBtn.textContent = 'Calculate Process Sizing';
                }
            }
        }

        function updateFLNGProcessDisplays(result) {
            console.log('ðŸ“Š Updating FLNG process displays');

            if (!result || !result.formatted) {
                showFLNGProcessError('Invalid result data received');
                return;
            }

            // Update gas properties display
            if (result.gasProperties && result.gasProperties.formatted) {
                document.getElementById('flng-show_props').value = result.gasProperties.formatted;
            }

            // Update production values
            document.getElementById('flng-v_lng').textContent = result.formatted.lng;
            document.getElementById('flng-v_fg').textContent = result.formatted.fg;
            document.getElementById('flng-v_lpg').textContent = result.formatted.lpg;
            document.getElementById('flng-v_cond').textContent = result.formatted.cond;
            document.getElementById('flng-v_bog').textContent = result.formatted.bog;
            document.getElementById('flng-v_q').textContent = result.formatted.q;
            document.getElementById('flng-v_pref').textContent = result.formatted.pref;
            document.getElementById('flng-v_split').textContent = result.formatted.split;

            // Update driver powers
            document.getElementById('flng-v_pfg').textContent = result.formatted.pfg;
            document.getElementById('flng-v_pbog').textContent = result.formatted.pbog;

            // Update configurations
            document.getElementById('flng-v_conf_mr').textContent = result.configurations.mr;
            document.getElementById('flng-v_conf_c3').textContent = result.configurations.c3;
            document.getElementById('flng-v_conf_fg').textContent = result.configurations.fg;
            document.getElementById('flng-v_conf_bog').textContent = result.configurations.bog;
            document.getElementById('flng-v_conf_mche').textContent = result.configurations.mche;

            // Update utilities
            document.getElementById('flng-v_cw').textContent = result.utilities.cw;
            document.getElementById('flng-v_ho').textContent = result.utilities.ho;
            document.getElementById('flng-v_ia_mr').textContent = result.utilities.ia_mr;
            document.getElementById('flng-v_ia_fg').textContent = result.utilities.ia_fg;
            document.getElementById('flng-v_ia_bog').textContent = result.utilities.ia_bog;
            document.getElementById('flng-v_n2').textContent = result.utilities.n2;
            document.getElementById('flng-v_flare').textContent = result.utilities.flare;

            // Update chart
            updateFLNGProcessChart(result.trends);
        }

        function updateFLNGProcessChart(trendData) {
            if (!flngProcessChart || !trendData) return;

            // Map data for Chart.js
            const refrigData = trendData.capacity.map((cap, i) => ({ x: cap, y: trendData.refrig_power[i] }));
            const fgData = trendData.capacity.map((cap, i) => ({ x: cap, y: trendData.fg_power[i] }));
            const bogData = trendData.capacity.map((cap, i) => ({ x: cap, y: trendData.bog_power[i] }));

            // Update chart data
            flngProcessChart.data.datasets[0].data = refrigData;
            flngProcessChart.data.datasets[1].data = fgData;
            flngProcessChart.data.datasets[2].data = bogData;

            // Update chart
            flngProcessChart.update();
        }

        function showFLNGProcessError(message) {
            console.error('FLNG Process Error:', message);

            // Clear all displays
            const resultElements = [
                'flng-v_lng', 'flng-v_fg', 'flng-v_lpg', 'flng-v_cond', 'flng-v_bog',
                'flng-v_q', 'flng-v_pref', 'flng-v_split', 'flng-v_pfg', 'flng-v_pbog',
                'flng-v_conf_mr', 'flng-v_conf_c3', 'flng-v_conf_fg', 'flng-v_conf_bog', 'flng-v_conf_mche',
                'flng-v_cw', 'flng-v_ho', 'flng-v_ia_mr', 'flng-v_ia_fg', 'flng-v_ia_bog', 'flng-v_n2', 'flng-v_flare'
            ];

            resultElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = 'Error';
                }
            });
        }

        // ============================================
        // GT RATING ESTIMATOR FUNCTIONALITY
        // ============================================
        let gtPowerChart;
        let gtCurrentModel = "LM6000PF";
        let gtCustomG = -438.9;
        let gtCustomH = 49064;
        let gtWhruAdjustment = 0;
        let gtGearboxAdjustment = 0;

        // IMPORTANT: GT Models and formulas REMOVED from frontend for IP protection
        // All formula parameters (a, b values) are ONLY stored in backend (netlify/functions/gt-rating.js)
        // No calculation formulas are exposed in frontend code
        let gtCachedResults = null; // Cache backend calculation results

        // REMOVED: calculateGTY() function - calculations now done on backend
        // All calculations are performed server-side via /.netlify/functions/gt-rating API

        // Calculate GT Power using backend API (formulas hidden - IP protected)
        async function calculateGTPower() {
            // Check authentication first
            if (!requireAuthentication()) {
                return;
            }

            const x = parseFloat(document.getElementById('gt-tempInput').value);
            if (isNaN(x)) {
                document.getElementById('gt-result').textContent = "Invalid input";
                document.getElementById('gt-maxKW').textContent = "Max: --";
                document.getElementById('gt-minKW').textContent = "Min: --";
                updateGTMarginPercentages();
                return;
            }

            // ALL CALCULATIONS ARE PROTECTED IN BACKEND - NO FRONTEND FORMULAS
            console.log('ðŸš€ Attempting GT Rating calculation via backend API...');

            try {
                // Get input values (user inputs only - no formulas)
                const model = gtCurrentModel || "LM6000PF";
                const customG = parseFloat(document.getElementById('gt-customG')?.value) || -438.9;
                const customH = parseFloat(document.getElementById('gt-customH')?.value) || 49064;
                const whruAdjustment = gtWhruAdjustment || 0;
                const gearboxAdjustment = gtGearboxAdjustment || 0;
                const xMin = parseFloat(document.getElementById('gt-xMin')?.value) || 0;
                const xMax = parseFloat(document.getElementById('gt-xMax')?.value) || 43;
                const margin10Value = parseFloat(document.getElementById('gt-margin10Value')?.value) || 10;
                const fouling5Value = parseFloat(document.getElementById('gt-fouling5Value')?.value) || 5;

                // Prepare payload for backend API
                const payload = {
                    model: model,
                    customG: customG,
                    customH: customH,
                    ambientTemp: x,
                    whruAdjustment: whruAdjustment,
                    gearboxAdjustment: gearboxAdjustment,
                    xMin: xMin,
                    xMax: xMax,
                    margin10Value: margin10Value,
                    fouling5Value: fouling5Value
                };

                console.log('ðŸ“„ GT Rating payload (no formulas):', payload);

                // Call backend API - all calculations done server-side
                const res = await fetch('/.netlify/functions/gt-rating', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!res.ok) {
                    throw new Error(`Backend error: ${res.status}`);
                }

                const data = await res.json();

                if (!data.success) {
                    throw new Error(data.error || 'Calculation failed');
                }

                console.log('âœ… GT Rating calculation successful (formulas hidden in backend):', data.results);

                // Cache results for margin calculations and chart updates
                gtCachedResults = data;

                // Update UI with results from backend
                const results = data.results;
                document.getElementById('gt-result').textContent = `KW: ${results.calculatedKW.toFixed(2)}`;
                document.getElementById('gt-maxKW').textContent = `Max: ${results.maxKW.toFixed(2)}`;
                document.getElementById('gt-minKW').textContent = `Min: ${results.minKW.toFixed(2)}`;

                // Update margin percentages using backend results
                updateGTMarginPercentages(data);

                // Update chart with backend data
                if (gtPowerChart) {
                    gtPowerChart.destroy();
                }
                createGTChart();

            } catch (error) {
                console.error('âŒ GT Rating calculation error:', error);
                document.getElementById('gt-result').textContent = "Calculation failed";
                document.getElementById('gt-maxKW').textContent = "Max: --";
                document.getElementById('gt-minKW').textContent = "Min: --";
                alert(`GT Rating calculation failed: ${error.message}\n\nPlease try again or contact support.`);
            }
        }

        // Generate GT Curve Data from backend (formulas hidden - IP protected)
        async function generateGTCurveData() {
            // Return cached curve data from backend if available
            if (gtCachedResults && gtCachedResults.curveData) {
                return gtCachedResults.curveData;
            }

            // If no cached data, fetch from backend API
            try {
                const model = gtCurrentModel || "LM6000PF";
                const customG = parseFloat(document.getElementById('gt-customG')?.value) || -438.9;
                const customH = parseFloat(document.getElementById('gt-customH')?.value) || 49064;
                const whruAdjustment = gtWhruAdjustment || 0;
                const gearboxAdjustment = gtGearboxAdjustment || 0;
                const xMin = parseFloat(document.getElementById('gt-xMin')?.value) || 0;
                const xMax = parseFloat(document.getElementById('gt-xMax')?.value) || 43;

                const payload = {
                    model: model,
                    customG: customG,
                    customH: customH,
                    ambientTemp: 25, // Default temp for curve generation
                    whruAdjustment: whruAdjustment,
                    gearboxAdjustment: gearboxAdjustment,
                    xMin: xMin,
                    xMax: xMax,
                    margin10Value: 10,
                    fouling5Value: 5
                };

                const res = await fetch('/.netlify/functions/gt-rating', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (res.ok) {
                    const data = await res.json();
                    if (data.success && data.curveData) {
                        gtCachedResults = data;
                        return data.curveData;
                    }
                }
            } catch (error) {
                console.error('Error generating curve data from backend:', error);
            }

            return [];
        }

        // Generate GT Margin Line Data from backend (formulas hidden - IP protected)
        async function generateGTMarginLineData(marginPercent) {
            // Return cached margin data from backend if available
            if (gtCachedResults) {
                if (Math.abs(marginPercent - 10) < 0.1 && gtCachedResults.margin10Data) {
                    return gtCachedResults.margin10Data;
                }
                if (Math.abs(marginPercent - 5) < 0.1 && gtCachedResults.fouling5Data) {
                    return gtCachedResults.fouling5Data;
                }
            }

            // If no cached data, return empty array (will be populated by calculateGTPower)
            return [];
        }

        function updateGTAdjustments() {
            gtWhruAdjustment = parseFloat(document.getElementById('gt-whruSlider').value);
            gtGearboxAdjustment = parseFloat(document.getElementById('gt-gearboxSlider').value);
            document.getElementById('gt-whruValue').textContent = `${gtWhruAdjustment.toFixed(1)}%`;
            document.getElementById('gt-gearboxValue').textContent = `${gtGearboxAdjustment.toFixed(1)}%`;
            calculateGTPower();
            if (gtPowerChart) {
                gtPowerChart.destroy();
                createGTChart();
            }
        }

        // Update GT Margin Percentages using backend results (formulas hidden - IP protected)
        function updateGTMarginPercentages(backendData = null) {
            const x = parseFloat(document.getElementById('gt-tempInput')?.value);
            if (isNaN(x)) {
                ['gt-normalMargin', 'gt-ratedMargin', 'gt-pointAMargin', 'gt-pointBMargin', 'gt-pointCMargin'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = "--%";
                });
                return;
            }

            // Use backend calculation results if available (formulas hidden)
            const data = backendData || gtCachedResults;
            if (data && data.results) {
                const adjustedY = data.results.calculatedKW;
                const calculateMargin = (pointY) => {
                    if (adjustedY === 0) return 0;
                    return ((adjustedY - pointY) / adjustedY) * 100;
                };

                const margins = {
                    'gt-normalMargin': calculateMargin(parseFloat(document.getElementById('gt-normalY')?.value) || 0),
                    'gt-ratedMargin': calculateMargin(parseFloat(document.getElementById('gt-ratedY')?.value) || 0),
                    'gt-pointAMargin': calculateMargin(parseFloat(document.getElementById('gt-pointAY')?.value) || 0),
                    'gt-pointBMargin': calculateMargin(parseFloat(document.getElementById('gt-pointBY')?.value) || 0),
                    'gt-pointCMargin': calculateMargin(parseFloat(document.getElementById('gt-pointCY')?.value) || 0)
                };

                Object.keys(margins).forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = `${margins[id].toFixed(2)}%`;
                });
            } else {
                // No backend data available - show placeholders (formulas hidden)
                ['gt-normalMargin', 'gt-ratedMargin', 'gt-pointAMargin', 'gt-pointBMargin', 'gt-pointCMargin'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.textContent = "--%";
                });
            }
        }

        // Create GT Chart using backend data (formulas hidden - IP protected)
        async function createGTChart() {
            const canvas = document.getElementById('gtPowerChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');

            // Get curve data from backend (formulas hidden)
            const curveData = await generateGTCurveData();
            const margin10Value = parseFloat(document.getElementById('gt-margin10Value')?.value) || 10;
            const fouling5Value = parseFloat(document.getElementById('gt-fouling5Value')?.value) || 5;
            const margin10Label = document.getElementById('gt-margin10Label')?.value || '10% Margin';
            const fouling5Label = document.getElementById('gt-fouling5Label')?.value || '5% Fouling';

            const normalX = parseFloat(document.getElementById('gt-normalX')?.value) || 0;
            const normalY = parseFloat(document.getElementById('gt-normalY')?.value) || 0;
            const normalName = document.getElementById('gt-normalName')?.value || 'Normal';
            const ratedX = parseFloat(document.getElementById('gt-ratedX')?.value) || 0;
            const ratedY = parseFloat(document.getElementById('gt-ratedY')?.value) || 0;
            const ratedName = document.getElementById('gt-ratedName')?.value || 'Rated';
            const pointAX = parseFloat(document.getElementById('gt-pointAX')?.value) || 0;
            const pointAY = parseFloat(document.getElementById('gt-pointAY')?.value) || 0;
            const pointAName = document.getElementById('gt-pointAName')?.value || 'A';
            const pointBX = parseFloat(document.getElementById('gt-pointBX')?.value) || 0;
            const pointBY = parseFloat(document.getElementById('gt-pointBY')?.value) || 0;
            const pointBName = document.getElementById('gt-pointBName')?.value || 'B';
            const pointCX = parseFloat(document.getElementById('gt-pointCX')?.value) || 0;
            const pointCY = parseFloat(document.getElementById('gt-pointCY')?.value) || 0;
            const pointCName = document.getElementById('gt-pointCName')?.value || 'C';

            const datasets = [
                {
                    label: `${gtCurrentModel} Base Curve`,
                    data: curveData,
                    borderColor: '#ff4500',
                    backgroundColor: 'rgba(255, 69, 0, 0.1)',
                    pointRadius: 2,
                    borderWidth: 2,
                    fill: false,
                    tension: 0.1
                },
                {
                    label: margin10Label,
                    data: await generateGTMarginLineData(margin10Value),
                    borderColor: '#4caf50',
                    pointRadius: 0,
                    borderWidth: 2,
                    fill: false,
                    tension: 0.1
                },
                {
                    label: fouling5Label,
                    data: await generateGTMarginLineData(fouling5Value),
                    borderColor: '#ff9800',
                    pointRadius: 0,
                    borderWidth: 2,
                    fill: false,
                    tension: 0.1
                }
            ];

            if (normalX !== 0 && normalY !== 0) {
                datasets.push({
                    label: '',
                    data: [{ x: normalX, y: normalY }],
                    pointStyle: 'star',
                    pointBackgroundColor: '#007bff',
                    pointBorderColor: '#007bff',
                    pointRadius: 10,
                    pointBorderWidth: 2,
                    showLine: false
                });
            }
            if (ratedX !== 0 && ratedY !== 0) {
                datasets.push({
                    label: '',
                    data: [{ x: ratedX, y: ratedY }],
                    pointStyle: 'rectRot',
                    pointBackgroundColor: '#ffcc00',
                    pointBorderColor: '#ffcc00',
                    pointRadius: 10,
                    pointBorderWidth: 2,
                    showLine: false
                });
            }
            if (pointAX !== 0 && pointAY !== 0) {
                datasets.push({
                    label: '',
                    data: [{ x: pointAX, y: pointAY }],
                    pointStyle: 'triangle',
                    pointBackgroundColor: '#4caf50',
                    pointBorderColor: '#4caf50',
                    pointRadius: 10,
                    pointBorderWidth: 2,
                    showLine: false
                });
            }
            if (pointBX !== 0 && pointBY !== 0) {
                datasets.push({
                    label: '',
                    data: [{ x: pointBX, y: pointBY }],
                    pointStyle: 'cross',
                    pointBackgroundColor: '#ff9800',
                    pointBorderColor: '#ff9800',
                    pointRadius: 10,
                    pointBorderWidth: 2,
                    showLine: false
                });
            }
            if (pointCX !== 0 && pointCY !== 0) {
                datasets.push({
                    label: '',
                    data: [{ x: pointCX, y: pointCY }],
                    pointStyle: 'dash',
                    pointBackgroundColor: '#9c27b0',
                    pointBorderColor: '#9c27b0',
                    pointRadius: 10,
                    pointBorderWidth: 2,
                    showLine: false
                });
            }

            const xInterval = parseFloat(document.getElementById('gt-xInterval')?.value) || 5;
            const yInterval = parseFloat(document.getElementById('gt-yInterval')?.value) || 2000;

            // Build annotations object using cached backend results (formulas hidden)
            // Find Y values from curve data instead of calculating
            const findYValue = (xVal) => {
                const point = curveData.find(p => Math.abs(p.x - xVal) < 0.25);
                return point ? point.y : (curveData.length > 0 ? curveData[0].y : 0);
            };

            const modelYAt2 = findYValue(2);
            const margin10YAt10 = findYValue(10) * (1 - margin10Value / 100);
            const fouling5YAt15 = findYValue(15) * (1 - fouling5Value / 100);

            const annotations = {
                modelLabel: {
                    type: 'label',
                    xValue: 2,
                    yValue: modelYAt2,
                    content: [gtCurrentModel],
                    font: { size: 12, weight: 'bold' },
                    color: '#ff4500',
                    backgroundColor: 'rgba(255, 69, 0, 0.2)',
                    padding: 6,
                    borderRadius: 4,
                    position: 'start',
                    yAdjust: -10,
                    xAdjust: 5
                },
                margin10Label: {
                    type: 'label',
                    xValue: 10,
                    yValue: margin10YAt10,
                    content: [margin10Label],
                    font: { size: 10, weight: 'bold' },
                    color: '#4caf50',
                    backgroundColor: 'rgba(76, 175, 80, 0.2)',
                    padding: 4,
                    borderRadius: 3,
                    position: 'bottom',
                    yAdjust: 15,
                    xAdjust: 10
                },
                fouling5Label: {
                    type: 'label',
                    xValue: 15,
                    yValue: fouling5YAt15,
                    content: [fouling5Label],
                    font: { size: 10, weight: 'bold' },
                    color: '#ff9800',
                    backgroundColor: 'rgba(255, 152, 0, 0.2)',
                    padding: 4,
                    borderRadius: 3,
                    position: 'top',
                    yAdjust: -15,
                    xAdjust: 10
                }
            };

            // Add operating point labels conditionally
            if (normalX !== 0 && normalY !== 0) {
                annotations.normalLabel = {
                    type: 'label',
                    xValue: normalX,
                    yValue: normalY,
                    content: [normalName],
                    font: { size: 10, weight: 'bold' },
                    color: '#007bff',
                    backgroundColor: 'rgba(0, 123, 255, 0.2)',
                    padding: 4,
                    borderRadius: 3,
                    position: 'top',
                    yAdjust: -15,
                    xAdjust: 10,
                    callout: {
                        display: true,
                        borderColor: '#007bff',
                        borderWidth: 2
                    }
                };
            }
            if (ratedX !== 0 && ratedY !== 0) {
                annotations.ratedLabel = {
                    type: 'label',
                    xValue: ratedX,
                    yValue: ratedY,
                    content: [ratedName],
                    font: { size: 10, weight: 'bold' },
                    color: '#ffcc00',
                    backgroundColor: 'rgba(255, 204, 0, 0.2)',
                    padding: 4,
                    borderRadius: 3,
                    position: 'top',
                    yAdjust: -15,
                    xAdjust: 10,
                    callout: {
                        display: true,
                        borderColor: '#ffcc00',
                        borderWidth: 2
                    }
                };
            }
            if (pointAX !== 0 && pointAY !== 0) {
                annotations.pointALabel = {
                    type: 'label',
                    xValue: pointAX,
                    yValue: pointAY,
                    content: [pointAName],
                    font: { size: 10, weight: 'bold' },
                    color: '#4caf50',
                    backgroundColor: 'rgba(76, 175, 80, 0.2)',
                    padding: 4,
                    borderRadius: 3,
                    position: 'top',
                    yAdjust: -15,
                    xAdjust: 10,
                    callout: {
                        display: true,
                        borderColor: '#4caf50',
                        borderWidth: 2
                    }
                };
            }
            if (pointBX !== 0 && pointBY !== 0) {
                annotations.pointBLabel = {
                    type: 'label',
                    xValue: pointBX,
                    yValue: pointBY,
                    content: [pointBName],
                    font: { size: 10, weight: 'bold' },
                    color: '#ff9800',
                    backgroundColor: 'rgba(255, 152, 0, 0.2)',
                    padding: 4,
                    borderRadius: 3,
                    position: 'top',
                    yAdjust: -15,
                    xAdjust: 10,
                    callout: {
                        display: true,
                        borderColor: '#ff9800',
                        borderWidth: 2
                    }
                };
            }
            if (pointCX !== 0 && pointCY !== 0) {
                annotations.pointCLabel = {
                    type: 'label',
                    xValue: pointCX,
                    yValue: pointCY,
                    content: [pointCName],
                    font: { size: 10, weight: 'bold' },
                    color: '#9c27b0',
                    backgroundColor: 'rgba(156, 39, 176, 0.2)',
                    padding: 4,
                    borderRadius: 3,
                    position: 'top',
                    yAdjust: -15,
                    xAdjust: 10,
                    callout: {
                        display: true,
                        borderColor: '#9c27b0',
                        borderWidth: 2
                    }
                };
            }

            gtPowerChart = new Chart(ctx, {
                type: 'line',
                data: { datasets: datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                color: '#ffffff',
                                font: { size: 11 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function (context) {
                                    return `Ambient: ${context.raw.x}Â°C | Power: ${context.raw.y.toFixed(0)} KW`;
                                }
                            }
                        },
                        annotation: {
                            annotations: annotations
                        }
                    },
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'AMBIENT TEMPERATURE DEG.C',
                                color: '#ffffff',
                                font: { size: 12, weight: 'bold' }
                            },
                            min: parseFloat(document.getElementById('gt-xMin')?.value) || 0,
                            max: parseFloat(document.getElementById('gt-xMax')?.value) || 43,
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: {
                                color: '#ffffff',
                                stepSize: xInterval,
                                font: { size: 11 }
                            },
                            type: 'linear'
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'GT POWER, KW',
                                color: '#ffffff',
                                font: { size: 12, weight: 'bold' }
                            },
                            min: parseFloat(document.getElementById('gt-yMin')?.value) || 30000,
                            max: parseFloat(document.getElementById('gt-yMax')?.value) || 49000,
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: {
                                color: '#ffffff',
                                stepSize: yInterval,
                                font: { size: 11 }
                            }
                        }
                    },
                    animation: { duration: 500 }
                }
            });
        }

        function toggleGTSection(sectionId) {
            const section = document.getElementById(sectionId);
            const toggleBtn = section?.querySelector('.gt-toggle-btn');
            if (section && toggleBtn) {
                if (section.style.maxHeight === '0px' || section.style.display === 'none') {
                    section.style.maxHeight = 'none';
                    section.style.display = 'block';
                    section.style.opacity = '1';
                    toggleBtn.textContent = 'â–¼ Hide';
                } else {
                    section.style.maxHeight = '0px';
                    section.style.display = 'none';
                    section.style.opacity = '0';
                    toggleBtn.textContent = 'â–² Show';
                }
            }
        }

        function updateGTModel() {
            gtCurrentModel = document.getElementById('gt-gtModelSelector').value;
            const customInputs = document.getElementById('gt-customInputs');
            const chartTitle = document.getElementById('gt-chartTitle');
            if (gtCurrentModel === "Custom") {
                if (customInputs) customInputs.style.display = 'flex';
                if (chartTitle) chartTitle.textContent = `Custom GAS TURBINE SITE RATED POWER Vs AMBIENT TEMP`;
            } else {
                if (customInputs) customInputs.style.display = 'none';
                if (chartTitle) chartTitle.textContent = `${gtCurrentModel} GAS TURBINE SITE RATED POWER Vs AMBIENT TEMP`;
            }
            if (gtPowerChart) {
                gtPowerChart.destroy();
            }
            createGTChart();
            calculateGTPower();
        }

        function updateGTCustomModel() {
            gtCustomG = parseFloat(document.getElementById('gt-customG').value) || -438.9;
            gtCustomH = parseFloat(document.getElementById('gt-customH').value) || 49064;
            if (gtPowerChart) {
                gtPowerChart.destroy();
            }
            createGTChart();
            calculateGTPower();
        }

        function updateGTOperatingPoints() {
            if (gtPowerChart) {
                gtPowerChart.destroy();
            }
            createGTChart();
            updateGTMarginPercentages();
        }

        function updateGTLines() {
            if (gtPowerChart) {
                gtPowerChart.destroy();
            }
            createGTChart();
        }

        function updateGTScale() {
            if (gtPowerChart) {
                gtPowerChart.destroy();
            }
            createGTChart();
        }

        function unhideAllGTSections() {
            const sections = ['gt-mainCalculatorSection'];
            // Since sections in the loadGTRatingUI don't have collapse/expand functionality,
            // this function is more of a placeholder to match the original design
            // All sections are already visible by default in the new implementation
        }

        function initializeGTRating() {
            // Check if disclaimer has been acknowledged
            const hasAcknowledged = localStorage.getItem('murphyCurvesDisclaimerAcknowledged') === 'true';

            if (!hasAcknowledged) {
                // Show disclaimer warning
                const container = document.getElementById('gt-rating-content');
                if (container) {
                    container.innerHTML = `
                        <div style="background: rgba(255, 193, 7, 0.2); border: 2px solid #ffc107; border-radius: 8px; padding: 30px; margin: 20px auto; max-width: 600px; text-align: center;">
                            <div style="font-size: 48px; margin-bottom: 20px;">âš ï¸</div>
                            <h2 style="color: #ffc107; margin-bottom: 15px;">Disclaimer Required</h2>
                            <p style="color: var(--light); font-size: 16px; line-height: 1.6; margin-bottom: 20px;">
                                You must accept the disclaimer before using the GT Rating Estimator.
                            </p>
                            <button onclick="showDisclaimerModal()" class="btn btn-primary" style="padding: 12px 30px; font-size: 16px;">
                                ðŸ“‹ View & Accept Disclaimer
                            </button>
                            <p style="color: var(--muted); font-size: 14px; margin-top: 15px;">
                                After accepting the disclaimer, please reload this page.
                            </p>
                        </div>
                    `;
                }
                return;
            }

            // Load GT Rating UI if disclaimer accepted
            loadGTRatingUI();
            createGTChart();
            calculateGTPower();
        }

        function showDisclaimerModal() {
            const disclaimerModal = document.getElementById('disclaimerModal');
            if (disclaimerModal) {
                disclaimerModal.style.display = 'block';
                document.body.style.overflow = 'hidden';
            }
        }

        function loadGTRatingUI() {
            const container = document.getElementById('gt-rating-content');
            if (!container) return;

            container.innerHTML = `
                <!-- Main Calculator -->
                <div class="gt-section" id="gt-mainCalculatorSection" style="background: rgba(12, 45, 72, 0.6); border: 1px solid rgba(46, 139, 192, 0.3); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <span style="font-weight: bold; color: var(--gold); font-size: 1.1rem;">ðŸ“Œ MAIN CALCULATOR</span>
                    </div>
                    <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap; align-items: center;">
                        <label for="gt-tempInput">Ambient Temperature (Â°C): </label>
                        <input type="number" id="gt-tempInput" value="25" min="0" max="43" step="0.1" style="padding: 8px; border-radius: 4px; border: 1px solid rgba(46, 139, 192, 0.3); background: rgba(5, 25, 35, 0.7); color: var(--light); width: 100px; text-align: center;">
                        <button onclick="calculateGTPower()" class="btn btn-primary">Calculate KW</button>
                        <div id="gt-result" style="font-weight: bold; font-size: 16px; color: var(--gold);">KW: --</div>
                        <span id="gt-maxKW" style="color: #ff4500; font-weight: bold;">Max: --</span>
                        <span id="gt-minKW" style="color: #4caf50; font-weight: bold;">Min: --</span>
                    </div>
                    <div style="display: flex; justify-content: flex-start; gap: 20px; flex-wrap: wrap; margin-top: 15px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 12px; color: var(--muted);">WHRU Adjustment:</span>
                            <input type="range" id="gt-whruSlider" min="0" max="2" value="0" step="0.1" oninput="updateGTAdjustments()" style="width: 150px;">
                            <span id="gt-whruValue" style="font-size: 12px; color: var(--gold);">0.0%</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 12px; color: var(--muted);">Gearbox Adjustment:</span>
                            <input type="range" id="gt-gearboxSlider" min="-2" max="0" value="0" step="0.1" oninput="updateGTAdjustments()" style="width: 150px;">
                            <span id="gt-gearboxValue" style="font-size: 12px; color: var(--gold);">0.0%</span>
                        </div>
                    </div>
                    <div style="font-size: 12px; color: var(--highlight); margin-top: 15px; padding: 10px; background: rgba(5, 25, 35, 0.7); border-radius: 4px; line-height: 1.6;">
                        <strong>Remarks:</strong><br>
                        a) GT operating humidity range 80%-90%.<br>
                        b) As there is varied of LHV subjected to project fuel gas, the range of calculated KW should be in range of max and min KW as shown.<br>
                        c) Titan GT's KW is equipped with GB + Generator.<br>
                        d) Add 1-2% of power on top of calculated KW if WHRU is not installed right after the exhaust of GT.<br>
                        e) Deduct 1-2% of power from calculated KW if gearbox is installed (i.e., for GTG application).
                    </div>
                </div>

                <!-- GT Model Selector -->
                <div style="background: rgba(12, 45, 72, 0.6); border: 1px solid rgba(46, 139, 192, 0.3); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <span style="font-weight: bold; color: var(--gold); font-size: 1.1rem;">âš™ï¸ GT MODEL SELECTOR</span>
                    </div>
                    <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                        <label>GT Model:</label>
                        <select id="gt-gtModelSelector" onchange="updateGTModel()" style="padding: 8px; border-radius: 4px; border: 1px solid rgba(46, 139, 192, 0.3); background: rgba(5, 25, 35, 0.7); color: var(--light);">
                            <option value="LM6000PF">LM6000PF</option>
                            <option value="LM6000PF+">LM6000PF+</option>
                            <option value="LM9000">LM9000</option>
                            <option value="SGT-750">SGT-750</option>
                            <option value="Titan 350">Titan 350</option>
                            <option value="Titan 250">Titan 250</option>
                            <option value="PGT 25+">PGT 25+</option>
                            <option value="Custom">Custom</option>
                        </select>
                    </div>
                    <div id="gt-customInputs" style="display: none; justify-content: center; gap: 15px; margin-top: 15px;">
                        <label>G (slope):</label>
                        <input type="number" id="gt-customG" value="-438.9" step="0.01" style="padding: 8px; border-radius: 4px; border: 1px solid rgba(46, 139, 192, 0.3); background: rgba(5, 25, 35, 0.7); color: var(--light); width: 100px;">
                        <label>H (intercept):</label>
                        <input type="number" id="gt-customH" value="49064" step="1" style="padding: 8px; border-radius: 4px; border: 1px solid rgba(46, 139, 192, 0.3); background: rgba(5, 25, 35, 0.7); color: var(--light); width: 100px;">
                        <button onclick="updateGTCustomModel()" class="btn btn-primary">Apply Custom</button>
                    </div>
                </div>

                <!-- Operating Points -->
                <div style="background: rgba(12, 45, 72, 0.6); border: 1px solid rgba(46, 139, 192, 0.3); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <span style="font-weight: bold; color: var(--gold); font-size: 1.1rem;">ðŸ“ OPERATING POINTS</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                        <div style="padding: 10px; background: rgba(5, 25, 35, 0.5); border-radius: 4px;">
                            <label style="color: #007bff; font-weight: bold;">Normal (X,Y):</label><br>
                            <input type="number" id="gt-normalX" value="30" min="0" max="43" step="0.1" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 80px; margin: 5px;">
                            <input type="number" id="gt-normalY" value="33000" min="30000" max="49000" step="100" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 100px; margin: 5px;">
                            <span id="gt-normalMargin" style="font-size: 11px; color: var(--gold); padding: 4px;">--%</span><br>
                            <input type="text" id="gt-normalName" value="Normal" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); margin-top: 5px; width: 90%;">
                        </div>
                        <div style="padding: 10px; background: rgba(5, 25, 35, 0.5); border-radius: 4px;">
                            <label style="color: #ffcc00; font-weight: bold;">Rated (X,Y):</label><br>
                            <input type="number" id="gt-ratedX" value="27" min="0" max="43" step="0.1" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 80px; margin: 5px;">
                            <input type="number" id="gt-ratedY" value="35640" min="30000" max="49000" step="100" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 100px; margin: 5px;">
                            <span id="gt-ratedMargin" style="font-size: 11px; color: var(--gold); padding: 4px;">--%</span><br>
                            <input type="text" id="gt-ratedName" value="Rated" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); margin-top: 5px; width: 90%;">
                        </div>
                        <div style="padding: 10px; background: rgba(5, 25, 35, 0.5); border-radius: 4px;">
                            <label style="color: #4caf50; font-weight: bold;">Point A (X,Y):</label><br>
                            <input type="number" id="gt-pointAX" value="20" min="0" max="43" step="0.1" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 80px; margin: 5px;">
                            <input type="number" id="gt-pointAY" value="38000" min="30000" max="49000" step="100" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 100px; margin: 5px;">
                            <span id="gt-pointAMargin" style="font-size: 11px; color: var(--gold); padding: 4px;">--%</span><br>
                            <input type="text" id="gt-pointAName" value="A" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); margin-top: 5px; width: 90%;">
                        </div>
                        <div style="padding: 10px; background: rgba(5, 25, 35, 0.5); border-radius: 4px;">
                            <label style="color: #ff9800; font-weight: bold;">Point B (X,Y):</label><br>
                            <input type="number" id="gt-pointBX" value="15" min="0" max="43" step="0.1" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 80px; margin: 5px;">
                            <input type="number" id="gt-pointBY" value="42000" min="30000" max="49000" step="100" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 100px; margin: 5px;">
                            <span id="gt-pointBMargin" style="font-size: 11px; color: var(--gold); padding: 4px;">--%</span><br>
                            <input type="text" id="gt-pointBName" value="B" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); margin-top: 5px; width: 90%;">
                        </div>
                        <div style="padding: 10px; background: rgba(5, 25, 35, 0.5); border-radius: 4px;">
                            <label style="color: #9c27b0; font-weight: bold;">Point C (X,Y):</label><br>
                            <input type="number" id="gt-pointCX" value="35" min="0" max="43" step="0.1" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 80px; margin: 5px;">
                            <input type="number" id="gt-pointCY" value="32000" min="30000" max="49000" step="100" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 100px; margin: 5px;">
                            <span id="gt-pointCMargin" style="font-size: 11px; color: var(--gold); padding: 4px;">--%</span><br>
                            <input type="text" id="gt-pointCName" value="C" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); margin-top: 5px; width: 90%;">
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <button onclick="updateGTOperatingPoints()" class="btn btn-primary">Update Points</button>
                    </div>
                </div>

                <!-- Margin & Fouling Lines -->
                <div style="background: rgba(12, 45, 72, 0.6); border: 1px solid rgba(46, 139, 192, 0.3); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <span style="font-weight: bold; color: var(--gold); font-size: 1.1rem;">ðŸ“‰ MARGIN & FOULING LINES</span>
                    </div>
                    <div style="display: flex; justify-content: center; gap: 20px; flex-wrap: wrap;">
                        <div>
                            <label>10% Margin Line:</label>
                            <input type="number" id="gt-margin10Value" value="10" min="0" max="50" step="0.1" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 80px; margin: 5px;">
                            <input type="text" id="gt-margin10Label" value="10% Margin" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 150px; margin: 5px;">
                        </div>
                        <div>
                            <label>5% Fouling Line:</label>
                            <input type="number" id="gt-fouling5Value" value="5" min="0" max="50" step="0.1" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 80px; margin: 5px;">
                            <input type="text" id="gt-fouling5Label" value="5% Fouling" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 150px; margin: 5px;">
                        </div>
                        <button onclick="updateGTLines()" class="btn btn-primary">Update Lines</button>
                    </div>
                </div>

                <!-- Axis Scaling -->
                <div style="background: rgba(12, 45, 72, 0.6); border: 1px solid rgba(46, 139, 192, 0.3); border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <span style="font-weight: bold; color: var(--gold); font-size: 1.1rem;">ðŸ“ AXIS SCALING</span>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <label>X Min:</label>
                            <input type="number" id="gt-xMin" value="0" step="1" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 80px;">
                            <label>X Max:</label>
                            <input type="number" id="gt-xMax" value="43" step="1" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 80px;">
                            <label>X Interval:</label>
                            <input type="number" id="gt-xInterval" value="5" step="1" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 80px;">
                        </div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <label>Y Min:</label>
                            <input type="number" id="gt-yMin" value="30000" step="1000" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 90px;">
                            <label>Y Max:</label>
                            <input type="number" id="gt-yMax" value="49000" step="1000" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 90px;">
                            <label>Y Interval:</label>
                            <input type="number" id="gt-yInterval" value="2000" step="1000" style="padding: 8px; border-radius: 4px; background: rgba(5, 25, 35, 0.7); color: var(--light); width: 90px;">
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 15px;">
                        <button onclick="updateGTScale()" class="btn btn-primary">Apply Scale</button>
                    </div>
                </div>
            `;
        }
    </script>
</body>

</html>